####################################################################################################################################################
### RUN: dataset_seed=0 K=84 test_fraction=0.2 val_fraction=0.1                                                                                  ###
### npz_in=/workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz ###
####################################################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --derive_qdd_from_qd True --col_format wide --trajectory_amount 84 --test_fraction 0.2 --val_fraction 0.1 --seed 0 --lowpass_signals True --lowpass_cutoff_hz 10.0 --lowpass_order 4 --lowpass_qdd False --raw_csv /workspace/shared/data/raw/UR3_Load0_5x10^4_under.csv --out_npz /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz
Saved: /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.json
Trajectories: train=19 val=3 test=5
Exists: True


#####################################
### EXPORT RESIDUALS (best DeLaN) ###
#####################################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz --ckpt /workspace/shared/models/delan/UR3_Load0_5x10^4_under__best5x10L0__K84__seed0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__seed0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.jax --out /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset/delan_UR3_Load0_5x10^4_under_K84_seed0_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/UR3_Load0_5x10^4_under__best5x10L0__K84__seed0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__seed0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.jax
Detected n_dof=6 (seed=2)
2026-01-30 20:34:45.232834: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 19 trajectories
  done 19/19

Exporting split=test: 5 trajectories
  done 5/5

Saved residual trajectory dataset: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json


##############################
### CONFIG: feat=full H=50 ###
##############################

#########################################
### BUILD LSTM WINDOWS H=50 feat=full ###
#########################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 50 --features full' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=50, n_dof=6, feature_dim=24
X_train: (34566, 50, 24)  Y_train: (34566, 6)
X_test : (5255, 50, 24)  Y_test : (5255, 6)
feature_mode=full


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:34:53.372478: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:34:53.398440: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-6m76i_fy because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (34566, 50, 24), Y_train = (34566, 6)
  X_test  = (5255, 50, 24),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:34:54.752588: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:34:54.757721: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:34:54.758758: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:34:54.760504: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:34:54.761530: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:34:54.762391: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:34:54.846822: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:34:54.847713: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:34:54.848515: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:34:54.849301: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8872 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:34:55.888389: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0951 - val_loss: 0.1586
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0493 - val_loss: 0.1625
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0405 - val_loss: 0.1930
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0369 - val_loss: 0.1940
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0329 - val_loss: 0.1952
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0318 - val_loss: 0.1891
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0298 - val_loss: 0.1861
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0299 - val_loss: 0.1912
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0290 - val_loss: 0.2005
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0278 - val_loss: 0.2077
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0277 - val_loss: 0.2053
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0264 - val_loss: 0.2014
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0264 - val_loss: 0.2290
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0260 - val_loss: 0.1845
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0259 - val_loss: 0.2070
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0251 - val_loss: 0.2082
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0252 - val_loss: 0.2088
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0249 - val_loss: 0.2025
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0247 - val_loss: 0.2039
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0242 - val_loss: 0.2085
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0244 - val_loss: 0.2093
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0235 - val_loss: 0.1948
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0238 - val_loss: 0.1784
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0233 - val_loss: 0.1941
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0234 - val_loss: 0.2031
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0231 - val_loss: 0.1869
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.2214
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.2125
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.2056
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0223 - val_loss: 0.2146
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.2091
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.1998
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0219 - val_loss: 0.2092
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0217 - val_loss: 0.1924
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.1816
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.0217 - val_loss: 0.1823
Epoch 37/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.1852
Epoch 38/120
487/487 - 1s - 3ms/step - loss: 0.0214 - val_loss: 0.1889
Epoch 39/120
487/487 - 1s - 3ms/step - loss: 0.0212 - val_loss: 0.1892
Epoch 40/120
487/487 - 1s - 3ms/step - loss: 0.0213 - val_loss: 0.1885
Epoch 41/120
487/487 - 1s - 3ms/step - loss: 0.0210 - val_loss: 0.2001
Epoch 42/120
487/487 - 1s - 3ms/step - loss: 0.0210 - val_loss: 0.1943
Epoch 43/120
487/487 - 1s - 3ms/step - loss: 0.0208 - val_loss: 0.2000
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1738
Per-joint RMSE: 0.1269 0.2466 0.2044 0.1221 0.1947 0.0988
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:35:59.162535: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:35:59.188638: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-8wxwxlm7 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 20:36:00.204471: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:00.209328: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:00.210185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:00.211918: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:00.212704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:00.213443: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:00.291641: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:00.292529: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:00.293283: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:00.294021: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8972 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:36:00.602090: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=3.236858e-02      RMSE=1.799127e-01
  per-joint RMSE: 0.1909 0.2657 0.1761 0.1468 0.1571 0.0995
Combined torque MSE=3.236858e-02     RMSE=1.799127e-01
  per-joint RMSE: 0.1909 0.2657 0.1761 0.1468 0.1571 0.0995
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:36:02.480315: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:36:02.505833: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-y1ni9tu6 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (34566, 50, 24), Y_train = (34566, 6)
  X_test  = (5255, 50, 24),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:36:03.836203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:03.841098: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:03.841963: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:03.843550: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:03.844341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:03.845076: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:03.925717: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:03.926558: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:03.927306: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:36:03.928045: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8956 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:36:04.965680: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0927 - val_loss: 0.1671
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0465 - val_loss: 0.1891
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0391 - val_loss: 0.2024
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0354 - val_loss: 0.1925
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0329 - val_loss: 0.2092
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0321 - val_loss: 0.1947
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0302 - val_loss: 0.1989
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0289 - val_loss: 0.1985
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0286 - val_loss: 0.2088
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0278 - val_loss: 0.1878
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0274 - val_loss: 0.2044
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0273 - val_loss: 0.1814
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0267 - val_loss: 0.2077
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0264 - val_loss: 0.1945
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0256 - val_loss: 0.1836
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0255 - val_loss: 0.1884
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0254 - val_loss: 0.1882
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.1911
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0249 - val_loss: 0.1836
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0245 - val_loss: 0.1940
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0244 - val_loss: 0.2084
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0239 - val_loss: 0.1960
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0237 - val_loss: 0.1800
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0237 - val_loss: 0.1982
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0236 - val_loss: 0.2204
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0231 - val_loss: 0.1813
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0231 - val_loss: 0.1860
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.2122
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0228 - val_loss: 0.2092
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.2006
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0223 - val_loss: 0.2109
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.2167
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.2312
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0218 - val_loss: 0.2429
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.2231
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.0218 - val_loss: 0.2156
Epoch 37/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.2305
Epoch 38/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.2136
Epoch 39/120
487/487 - 1s - 3ms/step - loss: 0.0211 - val_loss: 0.2232
Epoch 40/120
487/487 - 1s - 3ms/step - loss: 0.0213 - val_loss: 0.2367
Epoch 41/120
487/487 - 1s - 3ms/step - loss: 0.0210 - val_loss: 0.2406
Epoch 42/120
487/487 - 1s - 3ms/step - loss: 0.0208 - val_loss: 0.2183
Epoch 43/120
487/487 - 1s - 3ms/step - loss: 0.0208 - val_loss: 0.2359
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1943
Per-joint RMSE: 0.1652 0.3004 0.2054 0.1466 0.1805 0.1123
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:37:07.515738: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:37:07.541586: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-xj984ld0 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 20:37:08.525980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:08.530876: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:08.531758: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:08.533413: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:08.534200: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:08.534937: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:08.615625: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:08.616470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:08.617213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:08.617941: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8974 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:37:08.921284: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=3.321493e-02      RMSE=1.822497e-01
  per-joint RMSE: 0.1501 0.2695 0.2133 0.1437 0.1526 0.1213
Combined torque MSE=3.321493e-02     RMSE=1.822497e-01
  per-joint RMSE: 0.1501 0.2695 0.2133 0.1437 0.1526 0.1213
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=2 H=50 ###
##############################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:37:10.773976: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:37:10.799403: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-zzg5xwu2 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (34566, 50, 24), Y_train = (34566, 6)
  X_test  = (5255, 50, 24),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:37:12.096675: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:12.101557: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:12.102363: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:12.103928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:12.104733: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:12.105494: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:12.187113: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:12.187972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:12.188784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:37:12.189616: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8968 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:37:13.216192: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0960 - val_loss: 0.1556
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0488 - val_loss: 0.1561
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0406 - val_loss: 0.1432
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0358 - val_loss: 0.1738
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0332 - val_loss: 0.1839
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0323 - val_loss: 0.1817
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0304 - val_loss: 0.1923
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0295 - val_loss: 0.2010
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0289 - val_loss: 0.1972
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0274 - val_loss: 0.2026
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0276 - val_loss: 0.1997
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0271 - val_loss: 0.1971
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0261 - val_loss: 0.1971
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0262 - val_loss: 0.2080
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0256 - val_loss: 0.2078
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0255 - val_loss: 0.1979
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0249 - val_loss: 0.2077
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0252 - val_loss: 0.2090
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0249 - val_loss: 0.2063
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0242 - val_loss: 0.1991
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0238 - val_loss: 0.2055
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0236 - val_loss: 0.1861
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0239 - val_loss: 0.1963
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0238 - val_loss: 0.1756
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0233 - val_loss: 0.1995
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0235 - val_loss: 0.1762
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0230 - val_loss: 0.2007
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0227 - val_loss: 0.2118
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0224 - val_loss: 0.1910
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0224 - val_loss: 0.1754
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.1994
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0220 - val_loss: 0.2229
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0220 - val_loss: 0.2064
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0220 - val_loss: 0.2221
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0217 - val_loss: 0.2144
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.0216 - val_loss: 0.2239
Epoch 37/120
487/487 - 1s - 3ms/step - loss: 0.0213 - val_loss: 0.1992
Epoch 38/120
487/487 - 1s - 3ms/step - loss: 0.0212 - val_loss: 0.2301
Epoch 39/120
487/487 - 1s - 3ms/step - loss: 0.0213 - val_loss: 0.1861
Epoch 40/120
487/487 - 1s - 3ms/step - loss: 0.0211 - val_loss: 0.1989
Epoch 41/120
487/487 - 1s - 3ms/step - loss: 0.0217 - val_loss: 0.1927
Epoch 42/120
487/487 - 1s - 3ms/step - loss: 0.0209 - val_loss: 0.1812
Epoch 43/120
487/487 - 1s - 3ms/step - loss: 0.0209 - val_loss: 0.2064
Epoch 44/120
487/487 - 1s - 3ms/step - loss: 0.0205 - val_loss: 0.2032
Epoch 45/120
487/487 - 1s - 3ms/step - loss: 0.0203 - val_loss: 0.2150
Epoch 46/120
487/487 - 1s - 3ms/step - loss: 0.0203 - val_loss: 0.2045
Epoch 47/120
487/487 - 1s - 3ms/step - loss: 0.0203 - val_loss: 0.2161
Epoch 48/120
487/487 - 1s - 3ms/step - loss: 0.0202 - val_loss: 0.1995
Epoch 49/120
487/487 - 1s - 3ms/step - loss: 0.0203 - val_loss: 0.1955
Epoch 50/120
487/487 - 1s - 3ms/step - loss: 0.0200 - val_loss: 0.2039
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1771
Per-joint RMSE: 0.1617 0.2660 0.2031 0.1235 0.1666 0.0846
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=2 H=50 ###
#################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2 --H 50 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:38:26.048964: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:38:26.074963: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-h9lcwgdn because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 20:38:27.072518: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:27.077461: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:27.078271: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:27.079995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:27.080791: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:27.081531: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:27.163897: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:27.164742: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:27.165509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:27.166247: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8974 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:38:27.470854: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=2.762485e-02      RMSE=1.662072e-01
  per-joint RMSE: 0.1489 0.2547 0.1824 0.1412 0.1324 0.0893
Combined torque MSE=2.762485e-02     RMSE=1.662072e-01
  per-joint RMSE: 0.1489 0.2547 0.1824 0.1412 0.1324 0.0893
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


###############################
### CONFIG: feat=full H=100 ###
###############################

##########################################
### BUILD LSTM WINDOWS H=100 feat=full ###
##########################################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 100 --features full' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 100
  feature_mode= full
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=100, n_dof=6, feature_dim=24
X_train: (33616, 100, 24)  Y_train: (33616, 6)
X_test : (5005, 100, 24)  Y_test : (5005, 6)
feature_mode=full


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:38:29.969158: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:38:29.994893: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-uyi84r8t because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 24
 dout = 6
  X_train = (33616, 100, 24), Y_train = (33616, 6)
  X_test  = (5005, 100, 24),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:38:31.564706: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:31.570489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:31.571472: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:31.573679: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:31.575020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:31.576220: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:31.670502: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:31.671401: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:31.672277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:38:31.673087: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8956 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:38:32.798474: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.0952 - val_loss: 0.1492
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0464 - val_loss: 0.1640
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0387 - val_loss: 0.1921
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0352 - val_loss: 0.1742
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0321 - val_loss: 0.1794
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0311 - val_loss: 0.1864
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0299 - val_loss: 0.1917
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0292 - val_loss: 0.1873
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0282 - val_loss: 0.1895
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0272 - val_loss: 0.1616
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0270 - val_loss: 0.1666
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0271 - val_loss: 0.1608
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0263 - val_loss: 0.1490
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0259 - val_loss: 0.1613
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0258 - val_loss: 0.1414
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0252 - val_loss: 0.1418
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0247 - val_loss: 0.1471
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0243 - val_loss: 0.1565
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0241 - val_loss: 0.1541
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0250 - val_loss: 0.1648
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0246 - val_loss: 0.1610
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0236 - val_loss: 0.1454
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0231 - val_loss: 0.1667
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0228 - val_loss: 0.1328
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0231 - val_loss: 0.1468
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0229 - val_loss: 0.1642
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0227 - val_loss: 0.1641
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0220 - val_loss: 0.1756
Epoch 29/120
473/473 - 2s - 5ms/step - loss: 0.0229 - val_loss: 0.1612
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0219 - val_loss: 0.1591
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0215 - val_loss: 0.1703
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0216 - val_loss: 0.1441
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.0214 - val_loss: 0.1563
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.0215 - val_loss: 0.1513
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.1588
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.1632
Epoch 37/120
473/473 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.1553
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0207 - val_loss: 0.1632
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0207 - val_loss: 0.1374
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.0206 - val_loss: 0.1401
Epoch 41/120
473/473 - 2s - 4ms/step - loss: 0.0206 - val_loss: 0.1221
Epoch 42/120
473/473 - 2s - 4ms/step - loss: 0.0204 - val_loss: 0.1533
Epoch 43/120
473/473 - 2s - 4ms/step - loss: 0.0203 - val_loss: 0.1537
Epoch 44/120
473/473 - 2s - 4ms/step - loss: 0.0202 - val_loss: 0.1491
Epoch 45/120
473/473 - 2s - 4ms/step - loss: 0.0199 - val_loss: 0.1541
Epoch 46/120
473/473 - 2s - 4ms/step - loss: 0.0200 - val_loss: 0.1622
Epoch 47/120
473/473 - 2s - 4ms/step - loss: 0.0199 - val_loss: 0.1537
Epoch 48/120
473/473 - 2s - 4ms/step - loss: 0.0200 - val_loss: 0.1529
Epoch 49/120
473/473 - 2s - 4ms/step - loss: 0.0198 - val_loss: 0.1740
Epoch 50/120
473/473 - 2s - 4ms/step - loss: 0.0197 - val_loss: 0.1671
Epoch 51/120
473/473 - 2s - 4ms/step - loss: 0.0195 - val_loss: 0.1642
Epoch 52/120
473/473 - 2s - 4ms/step - loss: 0.0195 - val_loss: 0.1604
Epoch 53/120
473/473 - 2s - 4ms/step - loss: 0.0191 - val_loss: 0.1584
Epoch 54/120
473/473 - 2s - 4ms/step - loss: 0.0193 - val_loss: 0.1595
Epoch 55/120
473/473 - 2s - 4ms/step - loss: 0.0192 - val_loss: 0.1746
Epoch 56/120
473/473 - 2s - 4ms/step - loss: 0.0197 - val_loss: 0.1626
Epoch 57/120
473/473 - 2s - 4ms/step - loss: 0.0189 - val_loss: 0.1656
Epoch 58/120
473/473 - 2s - 4ms/step - loss: 0.0189 - val_loss: 0.1731
Epoch 59/120
473/473 - 2s - 4ms/step - loss: 0.0189 - val_loss: 0.1766
Epoch 60/120
473/473 - 2s - 4ms/step - loss: 0.0189 - val_loss: 0.1738
Epoch 61/120
473/473 - 2s - 4ms/step - loss: 0.0187 - val_loss: 0.1714
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1634
Per-joint RMSE: 0.1372 0.2442 0.1786 0.1260 0.1561 0.0978
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:40:42.626099: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:40:42.652628: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-64tz65zy because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 20:40:43.639048: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:43.644016: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:43.644912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:43.646617: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:43.647411: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:43.648160: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:43.734136: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:43.735072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:43.735920: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:43.736665: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8987 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:40:44.041462: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=2.669292e-02      RMSE=1.633797e-01
  per-joint RMSE: 0.1372 0.2442 0.1786 0.1260 0.1561 0.0978
Combined torque MSE=2.669292e-02     RMSE=1.633797e-01
  per-joint RMSE: 0.1372 0.2442 0.1786 0.1260 0.1561 0.0978
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:40:46.000974: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:40:46.026938: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-wbvfnzv3 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 24
 dout = 6
  X_train = (33616, 100, 24), Y_train = (33616, 6)
  X_test  = (5005, 100, 24),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:40:47.647158: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:47.651963: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:47.652777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:47.654447: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:47.655246: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:47.656080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:47.748926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:47.749822: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:47.750624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:40:47.751417: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8966 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:40:48.910652: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.0959 - val_loss: 0.1249
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0476 - val_loss: 0.1266
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0391 - val_loss: 0.1542
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0360 - val_loss: 0.1673
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0327 - val_loss: 0.1595
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0313 - val_loss: 0.1620
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0298 - val_loss: 0.1750
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0294 - val_loss: 0.1692
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0280 - val_loss: 0.1571
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0279 - val_loss: 0.1833
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0269 - val_loss: 0.1659
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0267 - val_loss: 0.1634
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0266 - val_loss: 0.1513
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0254 - val_loss: 0.1601
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0255 - val_loss: 0.1554
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0250 - val_loss: 0.1545
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0244 - val_loss: 0.1553
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0244 - val_loss: 0.1747
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0244 - val_loss: 0.1663
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.1640
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.1677
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0233 - val_loss: 0.1541
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0233 - val_loss: 0.1586
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0229 - val_loss: 0.1599
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0230 - val_loss: 0.1681
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0228 - val_loss: 0.1521
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.1519
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.1520
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0221 - val_loss: 0.1514
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0220 - val_loss: 0.1537
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.1337
Epoch 32/120
473/473 - 2s - 5ms/step - loss: 0.0216 - val_loss: 0.1368
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.0216 - val_loss: 0.1605
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.0215 - val_loss: 0.1702
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0215 - val_loss: 0.1697
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.1574
Epoch 37/120
473/473 - 2s - 4ms/step - loss: 0.0207 - val_loss: 0.1711
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.1489
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0207 - val_loss: 0.1589
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.0207 - val_loss: 0.1627
Epoch 41/120
473/473 - 2s - 4ms/step - loss: 0.0206 - val_loss: 0.1673
Epoch 42/120
473/473 - 2s - 4ms/step - loss: 0.0205 - val_loss: 0.1586
Epoch 43/120
473/473 - 2s - 4ms/step - loss: 0.0204 - val_loss: 0.1672
Epoch 44/120
473/473 - 2s - 4ms/step - loss: 0.0202 - val_loss: 0.1721
Epoch 45/120
473/473 - 2s - 4ms/step - loss: 0.0202 - val_loss: 0.1850
Epoch 46/120
473/473 - 2s - 4ms/step - loss: 0.0199 - val_loss: 0.1795
Epoch 47/120
473/473 - 2s - 4ms/step - loss: 0.0198 - val_loss: 0.1771
Epoch 48/120
473/473 - 2s - 4ms/step - loss: 0.0201 - val_loss: 0.1659
Epoch 49/120
473/473 - 2s - 4ms/step - loss: 0.0198 - val_loss: 0.1831
Epoch 50/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.1479
Epoch 51/120
473/473 - 2s - 4ms/step - loss: 0.0196 - val_loss: 0.1536
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1772
Per-joint RMSE: 0.1383 0.2981 0.1656 0.1279 0.1713 0.0858
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:42:37.371854: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:42:37.398235: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-st_fv4wv because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 20:42:38.411551: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:38.416478: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:38.417273: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:38.418951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:38.419737: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:38.420467: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:38.502523: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:38.503443: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:38.504196: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:38.504925: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8876 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:42:38.814968: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=3.002094e-02      RMSE=1.732655e-01
  per-joint RMSE: 0.1562 0.2783 0.1821 0.1392 0.1373 0.0832
Combined torque MSE=3.002094e-02     RMSE=1.732655e-01
  per-joint RMSE: 0.1562 0.2783 0.1821 0.1392 0.1373 0.0832
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=2 H=100 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:42:40.797941: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:42:40.824269: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-28cnlfpe because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 24
 dout = 6
  X_train = (33616, 100, 24), Y_train = (33616, 6)
  X_test  = (5005, 100, 24),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:42:42.488937: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:42.494226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:42.495193: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:42.497167: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:42.498120: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:42.499005: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:42.595915: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:42.596817: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:42.597623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:42:42.598413: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8833 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:42:43.762607: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 4s - 7ms/step - loss: 0.0952 - val_loss: 0.1387
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0482 - val_loss: 0.1633
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0388 - val_loss: 0.1696
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0351 - val_loss: 0.1732
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0327 - val_loss: 0.1715
Epoch 6/120
473/473 - 2s - 5ms/step - loss: 0.0316 - val_loss: 0.1496
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0297 - val_loss: 0.1540
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0296 - val_loss: 0.1514
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0280 - val_loss: 0.1513
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0276 - val_loss: 0.1513
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0270 - val_loss: 0.1418
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0263 - val_loss: 0.1372
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0259 - val_loss: 0.1422
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0257 - val_loss: 0.1378
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0255 - val_loss: 0.1473
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0249 - val_loss: 0.1316
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0246 - val_loss: 0.1336
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0254 - val_loss: 0.1671
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0243 - val_loss: 0.1620
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0239 - val_loss: 0.1539
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0237 - val_loss: 0.1618
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0236 - val_loss: 0.1586
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0233 - val_loss: 0.1476
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0231 - val_loss: 0.1440
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0228 - val_loss: 0.1577
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.1609
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.1563
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.1508
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0223 - val_loss: 0.1575
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.1709
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0221 - val_loss: 0.1576
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.1690
Epoch 33/120
473/473 - 2s - 5ms/step - loss: 0.0217 - val_loss: 0.1571
Epoch 34/120
473/473 - 2s - 5ms/step - loss: 0.0214 - val_loss: 0.1712
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.1615
Epoch 36/120
473/473 - 2s - 5ms/step - loss: 0.0213 - val_loss: 0.1528
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1833
Per-joint RMSE: 0.1552 0.2864 0.2027 0.1300 0.1748 0.0828
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=2 H=100 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2 --H 100 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:44:01.488042: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:44:01.516643: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-i7osorsu because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 20:44:02.569546: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:02.575649: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:02.581003: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:02.583784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:02.584758: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:02.585553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:02.675050: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:02.676038: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:02.676990: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:02.677792: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8492 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:44:03.004558: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=3.358700e-02      RMSE=1.832676e-01
  per-joint RMSE: 0.1552 0.2864 0.2027 0.1300 0.1748 0.0828
Combined torque MSE=3.358700e-02     RMSE=1.832676e-01
  per-joint RMSE: 0.1552 0.2864 0.2027 0.1300 0.1748 0.0828
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### CONFIG: feat=full H=150 ###
###############################

##########################################
### BUILD LSTM WINDOWS H=150 feat=full ###
##########################################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 150 --features full' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 150
  feature_mode= full
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=150, n_dof=6, feature_dim=24
X_train: (32666, 150, 24)  Y_train: (32666, 6)
X_test : (4755, 150, 24)  Y_test : (4755, 6)
feature_mode=full


###############################
### TRAIN LSTM seed=0 H=150 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:44:05.673897: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:44:05.698833: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-2j548hk9 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 24
 dout = 6
  X_train = (32666, 150, 24), Y_train = (32666, 6)
  X_test  = (4755, 150, 24),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:44:07.543523: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:07.548784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:07.549720: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:07.551491: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:07.552304: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:07.553070: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:07.649440: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:07.650479: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:07.651483: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:44:07.652436: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8729 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:44:08.852748: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.0973 - val_loss: 0.1701
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.0479 - val_loss: 0.1722
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.0396 - val_loss: 0.1714
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.0366 - val_loss: 0.1838
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.0329 - val_loss: 0.1877
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.0318 - val_loss: 0.1958
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.0305 - val_loss: 0.2113
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.0289 - val_loss: 0.2039
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.0287 - val_loss: 0.1970
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.0279 - val_loss: 0.2100
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.0275 - val_loss: 0.1963
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.0267 - val_loss: 0.1766
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.0263 - val_loss: 0.1829
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.0272 - val_loss: 0.1860
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.0257 - val_loss: 0.1808
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.0251 - val_loss: 0.1837
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.0248 - val_loss: 0.1811
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.0255 - val_loss: 0.1680
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.0250 - val_loss: 0.1862
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.0243 - val_loss: 0.1884
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.0243 - val_loss: 0.1836
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.0236 - val_loss: 0.1824
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.0235 - val_loss: 0.1720
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.0232 - val_loss: 0.1802
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.0231 - val_loss: 0.1748
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.0227 - val_loss: 0.1759
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.0228 - val_loss: 0.1616
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.0230 - val_loss: 0.1895
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.0222 - val_loss: 0.1882
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.0225 - val_loss: 0.1907
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.0221 - val_loss: 0.1889
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.0220 - val_loss: 0.1969
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.0217 - val_loss: 0.1841
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.0231 - val_loss: 0.1726
Epoch 35/120
460/460 - 3s - 6ms/step - loss: 0.0218 - val_loss: 0.1846
Epoch 36/120
460/460 - 3s - 6ms/step - loss: 0.0214 - val_loss: 0.1674
Epoch 37/120
460/460 - 3s - 6ms/step - loss: 0.0211 - val_loss: 0.1783
Epoch 38/120
460/460 - 3s - 6ms/step - loss: 0.0209 - val_loss: 0.1846
Epoch 39/120
460/460 - 3s - 6ms/step - loss: 0.0211 - val_loss: 0.1718
Epoch 40/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.1816
Epoch 41/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.1765
Epoch 42/120
460/460 - 3s - 6ms/step - loss: 0.0208 - val_loss: 0.1789
Epoch 43/120
460/460 - 3s - 6ms/step - loss: 0.0207 - val_loss: 0.1787
Epoch 44/120
460/460 - 3s - 6ms/step - loss: 0.0205 - val_loss: 0.1840
Epoch 45/120
460/460 - 3s - 6ms/step - loss: 0.0217 - val_loss: 0.2020
Epoch 46/120
460/460 - 3s - 6ms/step - loss: 0.0203 - val_loss: 0.1985
Epoch 47/120
460/460 - 3s - 6ms/step - loss: 0.0201 - val_loss: 0.1966
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1693
Per-joint RMSE: 0.1575 0.2518 0.1711 0.1331 0.1781 0.0711
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=150 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2 --H 150 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:46:20.223889: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:46:20.250275: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-l51z8ey8 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 20:46:21.295705: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:21.300580: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:21.301378: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:21.303074: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:21.303863: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:21.304604: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:21.393230: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:21.394175: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:21.395007: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:21.395736: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8802 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:46:21.699381: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=2.866598e-02      RMSE=1.693103e-01
  per-joint RMSE: 0.1575 0.2518 0.1711 0.1331 0.1781 0.0711
Combined torque MSE=2.866597e-02     RMSE=1.693103e-01
  per-joint RMSE: 0.1575 0.2518 0.1711 0.1331 0.1781 0.0711
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


###############################
### TRAIN LSTM seed=1 H=150 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:46:23.704107: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:46:23.730089: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-freyh2qj because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 24
 dout = 6
  X_train = (32666, 150, 24), Y_train = (32666, 6)
  X_test  = (4755, 150, 24),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:46:25.572253: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:25.577332: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:25.578685: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:25.580719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:25.581626: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:25.582372: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:25.667331: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:25.668213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:25.669009: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:46:25.669794: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8817 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:46:26.899813: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.0992 - val_loss: 0.1707
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.0492 - val_loss: 0.2034
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.0401 - val_loss: 0.2049
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.0356 - val_loss: 0.2134
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.0334 - val_loss: 0.2005
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.0318 - val_loss: 0.2028
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.0305 - val_loss: 0.2025
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.0291 - val_loss: 0.2027
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.0286 - val_loss: 0.2213
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.0276 - val_loss: 0.2189
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.0274 - val_loss: 0.2053
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.0273 - val_loss: 0.2266
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.0285 - val_loss: 0.2312
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.0260 - val_loss: 0.2501
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.0256 - val_loss: 0.2270
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.0250 - val_loss: 0.2417
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.0266 - val_loss: 0.2334
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.0247 - val_loss: 0.2255
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.0242 - val_loss: 0.2336
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.0245 - val_loss: 0.2227
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.0240 - val_loss: 0.2305
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.0235 - val_loss: 0.2342
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.0237 - val_loss: 0.2260
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.0235 - val_loss: 0.2277
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.0236 - val_loss: 0.2272
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.0228 - val_loss: 0.2563
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.0227 - val_loss: 0.2372
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.0224 - val_loss: 0.2253
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.0225 - val_loss: 0.2251
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.0224 - val_loss: 0.2470
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.0220 - val_loss: 0.2289
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1734
Per-joint RMSE: 0.1535 0.2669 0.1840 0.1348 0.1621 0.0859
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=150 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2 --H 150 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:47:54.534626: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:47:54.561059: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-b0bg036r because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 20:47:55.605976: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:55.610895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:55.611781: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:55.613578: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:55.614761: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:55.615501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:55.697600: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:55.698536: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:55.699335: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:55.700169: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8827 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:47:56.003391: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=3.225872e-02      RMSE=1.796071e-01
  per-joint RMSE: 0.1827 0.2606 0.1981 0.1366 0.1551 0.1016
Combined torque MSE=3.225872e-02     RMSE=1.796071e-01
  per-joint RMSE: 0.1827 0.2606 0.1981 0.1366 0.1551 0.1016
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


###############################
### TRAIN LSTM seed=2 H=150 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:47:57.988654: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:47:58.014271: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-3_624mmt because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_full__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 24
 dout = 6
  X_train = (32666, 150, 24), Y_train = (32666, 6)
  X_test  = (4755, 150, 24),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:47:59.882076: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:59.887001: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:59.888014: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:59.889713: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:59.890625: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:59.891547: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:59.978378: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:59.979382: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:59.980179: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:47:59.980973: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8819 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:48:01.236051: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.0976 - val_loss: 0.1567
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.0486 - val_loss: 0.1731
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.0404 - val_loss: 0.1836
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.0359 - val_loss: 0.1857
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.0334 - val_loss: 0.1993
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.0314 - val_loss: 0.1977
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.0305 - val_loss: 0.1964
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.0298 - val_loss: 0.1886
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.0288 - val_loss: 0.1853
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.0283 - val_loss: 0.1919
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.0278 - val_loss: 0.1824
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.0271 - val_loss: 0.1737
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.0267 - val_loss: 0.1748
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.0262 - val_loss: 0.1718
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.0254 - val_loss: 0.1718
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.0252 - val_loss: 0.1573
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.0255 - val_loss: 0.1771
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.0272 - val_loss: 0.1696
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.0251 - val_loss: 0.1790
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.0242 - val_loss: 0.1741
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.0241 - val_loss: 0.1746
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.0238 - val_loss: 0.1771
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.0239 - val_loss: 0.1609
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.0232 - val_loss: 0.1633
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.0232 - val_loss: 0.1359
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.0232 - val_loss: 0.1539
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.0232 - val_loss: 0.1459
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.0233 - val_loss: 0.1431
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.0229 - val_loss: 0.1507
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.0228 - val_loss: 0.1445
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.0223 - val_loss: 0.1477
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.0221 - val_loss: 0.1397
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.0222 - val_loss: 0.1503
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.0217 - val_loss: 0.1566
Epoch 35/120
460/460 - 3s - 6ms/step - loss: 0.0216 - val_loss: 0.1502
Epoch 36/120
460/460 - 3s - 6ms/step - loss: 0.0216 - val_loss: 0.1376
Epoch 37/120
460/460 - 3s - 6ms/step - loss: 0.0215 - val_loss: 0.1458
Epoch 38/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.1503
Epoch 39/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.1469
Epoch 40/120
460/460 - 3s - 6ms/step - loss: 0.0211 - val_loss: 0.1356
Epoch 41/120
460/460 - 3s - 6ms/step - loss: 0.0207 - val_loss: 0.1570
Epoch 42/120
460/460 - 3s - 6ms/step - loss: 0.0207 - val_loss: 0.1501
Epoch 43/120
460/460 - 3s - 6ms/step - loss: 0.0205 - val_loss: 0.1548
Epoch 44/120
460/460 - 3s - 6ms/step - loss: 0.0203 - val_loss: 0.1594
Epoch 45/120
460/460 - 3s - 6ms/step - loss: 0.0204 - val_loss: 0.1594
Epoch 46/120
460/460 - 3s - 6ms/step - loss: 0.0202 - val_loss: 0.1480
Epoch 47/120
460/460 - 3s - 6ms/step - loss: 0.0202 - val_loss: 0.1420
Epoch 48/120
460/460 - 3s - 6ms/step - loss: 0.0198 - val_loss: 0.1494
Epoch 49/120
460/460 - 3s - 6ms/step - loss: 0.0202 - val_loss: 0.1554
Epoch 50/120
460/460 - 3s - 6ms/step - loss: 0.0198 - val_loss: 0.1426
Epoch 51/120
460/460 - 3s - 6ms/step - loss: 0.0198 - val_loss: 0.1442
Epoch 52/120
460/460 - 3s - 6ms/step - loss: 0.0197 - val_loss: 0.1607
Epoch 53/120
460/460 - 3s - 6ms/step - loss: 0.0194 - val_loss: 0.1550
Epoch 54/120
460/460 - 3s - 6ms/step - loss: 0.0195 - val_loss: 0.1808
Epoch 55/120
460/460 - 3s - 6ms/step - loss: 0.0194 - val_loss: 0.1651
Epoch 56/120
460/460 - 3s - 6ms/step - loss: 0.0194 - val_loss: 0.1646
Epoch 57/120
460/460 - 3s - 6ms/step - loss: 0.0193 - val_loss: 0.1641
Epoch 58/120
460/460 - 3s - 6ms/step - loss: 0.0192 - val_loss: 0.1651
Epoch 59/120
460/460 - 3s - 6ms/step - loss: 0.0198 - val_loss: 0.1857
Epoch 60/120
460/460 - 3s - 6ms/step - loss: 0.0192 - val_loss: 0.1750
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1864
Per-joint RMSE: 0.1488 0.2984 0.1978 0.1312 0.1709 0.1089
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=2 H=150 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2 --H 150 --split test --features full --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:50:47.726761: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:50:47.752762: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-v17r70ab because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-30 20:50:48.769512: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:48.774449: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:48.775382: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:48.777226: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:48.778152: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:48.779077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:48.862518: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:48.863430: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:48.864225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:48.865025: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8954 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:50:49.179780: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=3.476297e-02      RMSE=1.864483e-01
  per-joint RMSE: 0.1488 0.2984 0.1978 0.1312 0.1709 0.1089
Combined torque MSE=3.476297e-02     RMSE=1.864483e-01
  per-joint RMSE: 0.1488 0.2984 0.1978 0.1312 0.1709 0.1089
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_full__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


###############################
### CONFIG: feat=state H=50 ###
###############################

##########################################
### BUILD LSTM WINDOWS H=50 feat=state ###
##########################################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 50 --features state' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=50, n_dof=6, feature_dim=18
X_train: (34566, 50, 18)  Y_train: (34566, 6)
X_test : (5255, 50, 18)  Y_test : (5255, 6)
feature_mode=state


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:50:51.539493: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:50:51.564486: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-oo1j9ge0 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (34566, 50, 18), Y_train = (34566, 6)
  X_test  = (5255, 50, 18),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:50:52.841203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:52.845743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:52.846679: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:52.848281: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:52.849154: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:52.850030: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:52.927681: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:52.928569: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:52.929362: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:50:52.930152: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8970 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:50:53.955171: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0982 - val_loss: 0.1122
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0503 - val_loss: 0.0842
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0405 - val_loss: 0.0890
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0362 - val_loss: 0.0857
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0347 - val_loss: 0.0860
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0316 - val_loss: 0.0934
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0304 - val_loss: 0.1030
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0311 - val_loss: 0.1239
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0305 - val_loss: 0.1377
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0283 - val_loss: 0.1530
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0278 - val_loss: 0.1551
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0269 - val_loss: 0.1464
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0268 - val_loss: 0.1569
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0267 - val_loss: 0.1575
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0258 - val_loss: 0.1578
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0256 - val_loss: 0.1661
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0252 - val_loss: 0.1565
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.1840
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0247 - val_loss: 0.1647
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0245 - val_loss: 0.1681
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0240 - val_loss: 0.1795
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0241 - val_loss: 0.1689
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0240 - val_loss: 0.1650
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0237 - val_loss: 0.1764
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0236 - val_loss: 0.1679
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0232 - val_loss: 0.1581
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0231 - val_loss: 0.1762
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0228 - val_loss: 0.1625
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0230 - val_loss: 0.1793
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0227 - val_loss: 0.1667
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.1854
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0222 - val_loss: 0.1753
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1733
Per-joint RMSE: 0.1521 0.2872 0.1669 0.1308 0.1520 0.0801
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:51:42.325184: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:51:42.351546: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-sxbddnvh because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 20:51:43.367989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:43.372849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:43.373817: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:43.375459: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:43.376248: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:43.377070: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:43.461127: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:43.462206: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:43.462987: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:43.463771: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8953 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:51:43.767391: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=3.084717e-02      RMSE=1.756336e-01
  per-joint RMSE: 0.1605 0.2955 0.1481 0.1308 0.1576 0.0899
Combined torque MSE=3.084717e-02     RMSE=1.756336e-01
  per-joint RMSE: 0.1605 0.2955 0.1481 0.1308 0.1576 0.0899
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:51:45.678423: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:51:45.704052: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-id6hm6cv because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (34566, 50, 18), Y_train = (34566, 6)
  X_test  = (5255, 50, 18),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:51:46.980038: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:46.984830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:46.985618: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:46.987354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:46.988151: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:46.988887: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:47.073930: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:47.074782: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:47.075538: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:51:47.076276: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8953 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:51:48.102426: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0975 - val_loss: 0.1392
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0491 - val_loss: 0.1751
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0410 - val_loss: 0.1750
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0365 - val_loss: 0.1733
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0332 - val_loss: 0.1888
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0332 - val_loss: 0.1952
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0310 - val_loss: 0.1855
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0301 - val_loss: 0.2013
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0290 - val_loss: 0.2034
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0281 - val_loss: 0.2197
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0274 - val_loss: 0.2270
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0274 - val_loss: 0.2073
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0266 - val_loss: 0.2128
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0265 - val_loss: 0.2007
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0263 - val_loss: 0.2054
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0256 - val_loss: 0.2049
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0253 - val_loss: 0.2258
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0253 - val_loss: 0.2212
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.2012
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0244 - val_loss: 0.2199
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0243 - val_loss: 0.2199
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0241 - val_loss: 0.2261
Epoch 23/120
487/487 - 2s - 3ms/step - loss: 0.0240 - val_loss: 0.2172
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0243 - val_loss: 0.2269
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0236 - val_loss: 0.2218
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0229 - val_loss: 0.2329
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0231 - val_loss: 0.2335
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0230 - val_loss: 0.2308
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0229 - val_loss: 0.2389
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0229 - val_loss: 0.2338
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.2338
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0220 - val_loss: 0.2287
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.2575
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0222 - val_loss: 0.2436
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1697
Per-joint RMSE: 0.1611 0.2878 0.1344 0.1203 0.1564 0.0842
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:52:39.376341: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:52:39.402563: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-j5e38sf2 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 20:52:40.464922: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:40.469773: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:40.470575: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:40.472264: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:40.473134: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:40.473875: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:40.557629: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:40.558566: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:40.559311: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:40.560043: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8860 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:52:40.870608: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=3.605875e-02      RMSE=1.898914e-01
  per-joint RMSE: 0.1619 0.3176 0.1749 0.1541 0.1640 0.0896
Combined torque MSE=3.605875e-02     RMSE=1.898914e-01
  per-joint RMSE: 0.1619 0.3176 0.1749 0.1541 0.1640 0.0896
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=2 H=50 ###
##############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:52:42.765152: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:52:42.791351: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-eso43h9z because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (34566, 50, 18), Y_train = (34566, 6)
  X_test  = (5255, 50, 18),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:52:44.060080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:44.065099: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:44.065972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:44.067640: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:44.068437: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:44.069176: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:44.149415: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:44.150248: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:44.151079: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:52:44.151816: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8880 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:52:45.212574: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0991 - val_loss: 0.2564
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0506 - val_loss: 0.2108
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0405 - val_loss: 0.2066
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0360 - val_loss: 0.1997
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0359 - val_loss: 0.2013
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0331 - val_loss: 0.1761
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0313 - val_loss: 0.1856
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0295 - val_loss: 0.1673
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0293 - val_loss: 0.1876
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0286 - val_loss: 0.1826
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0286 - val_loss: 0.1775
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0269 - val_loss: 0.1810
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0270 - val_loss: 0.2026
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0263 - val_loss: 0.1817
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0264 - val_loss: 0.1633
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0254 - val_loss: 0.1820
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0251 - val_loss: 0.1662
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0249 - val_loss: 0.2080
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0251 - val_loss: 0.1681
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0245 - val_loss: 0.1432
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0244 - val_loss: 0.1638
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.1374
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0240 - val_loss: 0.1533
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0236 - val_loss: 0.1651
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0233 - val_loss: 0.1455
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0232 - val_loss: 0.1465
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0233 - val_loss: 0.1479
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0227 - val_loss: 0.1645
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0228 - val_loss: 0.1734
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.1535
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0224 - val_loss: 0.1516
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0223 - val_loss: 0.1561
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.1470
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0223 - val_loss: 0.1516
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0220 - val_loss: 0.1453
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.0216 - val_loss: 0.1488
Epoch 37/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.1421
Epoch 38/120
487/487 - 1s - 3ms/step - loss: 0.0213 - val_loss: 0.1475
Epoch 39/120
487/487 - 1s - 3ms/step - loss: 0.0213 - val_loss: 0.1376
Epoch 40/120
487/487 - 1s - 3ms/step - loss: 0.0214 - val_loss: 0.1533
Epoch 41/120
487/487 - 1s - 3ms/step - loss: 0.0217 - val_loss: 0.1604
Epoch 42/120
487/487 - 1s - 3ms/step - loss: 0.0235 - val_loss: 0.1510
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1862
Per-joint RMSE: 0.1826 0.3109 0.1423 0.1485 0.1655 0.0904
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=2 H=50 ###
#################################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:53:47.812690: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:53:47.839263: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-vdo1xph5 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 20:53:48.872784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:48.877769: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:48.878571: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:48.880317: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:48.881108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:48.881917: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:48.967325: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:48.968155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:48.968896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:48.969707: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8928 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:53:49.274451: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=3.465208e-02      RMSE=1.861507e-01
  per-joint RMSE: 0.1826 0.3109 0.1423 0.1485 0.1655 0.0904
Combined torque MSE=3.465208e-02     RMSE=1.861507e-01
  per-joint RMSE: 0.1826 0.3109 0.1423 0.1485 0.1655 0.0904
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


################################
### CONFIG: feat=state H=100 ###
################################

###########################################
### BUILD LSTM WINDOWS H=100 feat=state ###
###########################################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 100 --features state' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 100
  feature_mode= state
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=100, n_dof=6, feature_dim=18
X_train: (33616, 100, 18)  Y_train: (33616, 6)
X_test : (5005, 100, 18)  Y_test : (5005, 6)
feature_mode=state


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:53:51.772730: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:53:51.800065: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-ykrmz2og because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (33616, 100, 18), Y_train = (33616, 6)
  X_test  = (5005, 100, 18),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:53:53.341453: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:53.346521: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:53.347535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:53.349285: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:53.350196: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:53.351047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:53.451951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:53.452859: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:53.453741: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:53:53.454524: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8781 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:53:54.509257: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.0991 - val_loss: 0.2017
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0499 - val_loss: 0.1812
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0408 - val_loss: 0.1883
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0366 - val_loss: 0.1757
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0339 - val_loss: 0.1581
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0318 - val_loss: 0.1729
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0305 - val_loss: 0.1689
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0307 - val_loss: 0.1661
Epoch 9/120
473/473 - 2s - 5ms/step - loss: 0.0286 - val_loss: 0.1546
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0282 - val_loss: 0.1488
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0275 - val_loss: 0.1688
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0271 - val_loss: 0.1525
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0266 - val_loss: 0.1559
Epoch 14/120
473/473 - 2s - 5ms/step - loss: 0.0259 - val_loss: 0.1753
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0262 - val_loss: 0.1780
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0254 - val_loss: 0.1798
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0252 - val_loss: 0.1637
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0246 - val_loss: 0.1885
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0247 - val_loss: 0.1931
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0246 - val_loss: 0.1849
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0242 - val_loss: 0.1776
Epoch 22/120
473/473 - 2s - 5ms/step - loss: 0.0238 - val_loss: 0.1760
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0234 - val_loss: 0.1825
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.1788
Epoch 25/120
473/473 - 2s - 5ms/step - loss: 0.0232 - val_loss: 0.1775
Epoch 26/120
473/473 - 2s - 5ms/step - loss: 0.0230 - val_loss: 0.1939
Epoch 27/120
473/473 - 2s - 5ms/step - loss: 0.0231 - val_loss: 0.1829
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0227 - val_loss: 0.1902
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.1852
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.2078
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.2061
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0219 - val_loss: 0.1830
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1755
Per-joint RMSE: 0.1336 0.2856 0.1902 0.1159 0.1623 0.0972
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:55:04.138036: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:55:04.166075: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-v89yl0h8 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 20:55:05.194189: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:05.199428: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:05.200330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:05.202069: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:05.202775: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:05.203525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:05.285065: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:05.286033: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:05.286784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:05.287514: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8872 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:55:05.589016: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=3.186155e-02      RMSE=1.784981e-01
  per-joint RMSE: 0.1316 0.2926 0.1925 0.1190 0.1644 0.0998
Combined torque MSE=3.186155e-02     RMSE=1.784981e-01
  per-joint RMSE: 0.1316 0.2926 0.1925 0.1190 0.1644 0.0998
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:55:07.521031: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:55:07.546574: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-zhcw2ye7 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (33616, 100, 18), Y_train = (33616, 6)
  X_test  = (5005, 100, 18),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:55:09.047519: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:09.052426: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:09.053228: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:09.054904: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:09.055687: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:09.056430: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:09.142704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:09.143604: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:09.144345: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:55:09.145080: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8900 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:55:10.210090: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.1003 - val_loss: 0.1421
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0497 - val_loss: 0.1212
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0408 - val_loss: 0.1340
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0368 - val_loss: 0.1338
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0336 - val_loss: 0.1382
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0318 - val_loss: 0.1267
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0307 - val_loss: 0.1464
Epoch 8/120
473/473 - 2s - 5ms/step - loss: 0.0295 - val_loss: 0.1118
Epoch 9/120
473/473 - 2s - 5ms/step - loss: 0.0289 - val_loss: 0.1280
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0280 - val_loss: 0.1176
Epoch 11/120
473/473 - 2s - 5ms/step - loss: 0.0277 - val_loss: 0.1201
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0266 - val_loss: 0.1165
Epoch 13/120
473/473 - 2s - 5ms/step - loss: 0.0263 - val_loss: 0.1124
Epoch 14/120
473/473 - 2s - 5ms/step - loss: 0.0264 - val_loss: 0.1060
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0257 - val_loss: 0.1080
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0252 - val_loss: 0.1066
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0250 - val_loss: 0.1215
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0246 - val_loss: 0.1258
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0244 - val_loss: 0.1212
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0241 - val_loss: 0.1165
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0240 - val_loss: 0.1148
Epoch 22/120
473/473 - 2s - 5ms/step - loss: 0.0236 - val_loss: 0.1230
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0234 - val_loss: 0.1191
Epoch 24/120
473/473 - 2s - 5ms/step - loss: 0.0236 - val_loss: 0.1101
Epoch 25/120
473/473 - 2s - 5ms/step - loss: 0.0229 - val_loss: 0.1197
Epoch 26/120
473/473 - 2s - 5ms/step - loss: 0.0228 - val_loss: 0.1226
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.1255
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.1371
Epoch 29/120
473/473 - 2s - 5ms/step - loss: 0.0223 - val_loss: 0.1262
Epoch 30/120
473/473 - 2s - 5ms/step - loss: 0.0221 - val_loss: 0.1323
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0220 - val_loss: 0.1455
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0219 - val_loss: 0.1402
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.0217 - val_loss: 0.1319
Epoch 34/120
473/473 - 2s - 5ms/step - loss: 0.0216 - val_loss: 0.1486
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1757
Per-joint RMSE: 0.1521 0.2879 0.1657 0.1257 0.1704 0.0836
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:56:24.936249: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:56:24.962675: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-uzh__1r7 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 20:56:25.963241: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:25.968207: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:25.969015: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:25.970850: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:25.971636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:25.972380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:26.053210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:26.054127: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:26.054870: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:26.055603: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8913 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:56:26.360056: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=3.088308e-02      RMSE=1.757358e-01
  per-joint RMSE: 0.1521 0.2879 0.1657 0.1257 0.1704 0.0836
Combined torque MSE=3.088308e-02     RMSE=1.757358e-01
  per-joint RMSE: 0.1521 0.2879 0.1657 0.1257 0.1704 0.0836
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=2 H=100 ###
###############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:56:28.283707: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:56:28.310982: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-7pwi0zzy because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (33616, 100, 18), Y_train = (33616, 6)
  X_test  = (5005, 100, 18),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:56:29.956525: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:29.961745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:29.962622: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:29.964574: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:29.965390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:29.966118: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:30.054118: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:30.055006: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:30.055812: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:56:30.056597: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8869 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:56:31.176373: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.1012 - val_loss: 0.1681
Epoch 2/120
473/473 - 2s - 5ms/step - loss: 0.0504 - val_loss: 0.1758
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0412 - val_loss: 0.1822
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0362 - val_loss: 0.2206
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0337 - val_loss: 0.1811
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0319 - val_loss: 0.1835
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0309 - val_loss: 0.1699
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0297 - val_loss: 0.1716
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0288 - val_loss: 0.1741
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0281 - val_loss: 0.1753
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0274 - val_loss: 0.1720
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0265 - val_loss: 0.1754
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0267 - val_loss: 0.1672
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0259 - val_loss: 0.1653
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0255 - val_loss: 0.1589
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0257 - val_loss: 0.1839
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0251 - val_loss: 0.1759
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0244 - val_loss: 0.1844
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0245 - val_loss: 0.1701
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0240 - val_loss: 0.1631
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0243 - val_loss: 0.1630
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.1704
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0234 - val_loss: 0.1801
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0232 - val_loss: 0.1844
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0230 - val_loss: 0.1597
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.1638
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0225 - val_loss: 0.1732
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0227 - val_loss: 0.1925
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0227 - val_loss: 0.1909
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.1674
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.1732
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0220 - val_loss: 0.1619
Epoch 33/120
473/473 - 2s - 5ms/step - loss: 0.0216 - val_loss: 0.1714
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.0216 - val_loss: 0.1795
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0219 - val_loss: 0.1804
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1748
Per-joint RMSE: 0.1266 0.3055 0.1748 0.1117 0.1530 0.0868
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=2 H=100 ###
##################################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:57:46.229395: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:57:46.255617: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-v1zd2dgm because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 20:57:47.257817: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:47.262701: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:47.263509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:47.265256: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:47.266061: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:47.266799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:47.350948: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:47.351874: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:47.352627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:47.353517: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8898 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:57:47.673406: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=3.054978e-02      RMSE=1.747850e-01
  per-joint RMSE: 0.1266 0.3055 0.1748 0.1117 0.1530 0.0868
Combined torque MSE=3.054978e-02     RMSE=1.747850e-01
  per-joint RMSE: 0.1266 0.3055 0.1748 0.1117 0.1530 0.0868
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


################################
### CONFIG: feat=state H=150 ###
################################

###########################################
### BUILD LSTM WINDOWS H=150 feat=state ###
###########################################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 150 --features state' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 150
  feature_mode= state
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=150, n_dof=6, feature_dim=18
X_train: (32666, 150, 18)  Y_train: (32666, 6)
X_test : (4755, 150, 18)  Y_test : (4755, 6)
feature_mode=state


###############################
### TRAIN LSTM seed=0 H=150 ###
###############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:57:50.255316: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:57:50.281195: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-qm0f3gii because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 18
 dout = 6
  X_train = (32666, 150, 18), Y_train = (32666, 6)
  X_test  = (4755, 150, 18),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:57:52.044883: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:52.050437: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:52.051549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:52.053337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:52.054370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:52.055157: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:52.149624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:52.150627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:52.151423: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:57:52.152219: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8899 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:57:53.294545: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.1017 - val_loss: 0.1490
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.0506 - val_loss: 0.1661
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.0415 - val_loss: 0.1630
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.0373 - val_loss: 0.1531
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.0341 - val_loss: 0.1478
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.0325 - val_loss: 0.1551
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.0309 - val_loss: 0.1378
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.0293 - val_loss: 0.1507
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.0299 - val_loss: 0.1478
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.0284 - val_loss: 0.1329
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.0276 - val_loss: 0.1371
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.0269 - val_loss: 0.1298
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.0263 - val_loss: 0.1341
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.0263 - val_loss: 0.1201
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.0259 - val_loss: 0.1370
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.0258 - val_loss: 0.1303
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.0250 - val_loss: 0.1389
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.0252 - val_loss: 0.1403
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.0246 - val_loss: 0.1364
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.0244 - val_loss: 0.1303
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.0240 - val_loss: 0.1299
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.0246 - val_loss: 0.1364
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.0238 - val_loss: 0.1417
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.0235 - val_loss: 0.1363
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.0231 - val_loss: 0.1327
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.0233 - val_loss: 0.1353
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.0227 - val_loss: 0.1359
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.0226 - val_loss: 0.1423
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.0227 - val_loss: 0.1457
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.0225 - val_loss: 0.1388
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.0223 - val_loss: 0.1360
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.0220 - val_loss: 0.1329
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.0218 - val_loss: 0.1447
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.0218 - val_loss: 0.1433
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1810
Per-joint RMSE: 0.1425 0.3042 0.1740 0.1134 0.1754 0.0992
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=150 ###
##################################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2 --H 150 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:59:28.891690: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:59:28.919074: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-_7fgqm7m because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 20:59:29.929173: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:29.934296: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:29.935160: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:29.936858: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:29.937649: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:29.938390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:30.018558: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:30.019398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:30.020132: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:30.020858: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 20:59:30.325380: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=3.276482e-02      RMSE=1.810105e-01
  per-joint RMSE: 0.1425 0.3042 0.1740 0.1134 0.1754 0.0992
Combined torque MSE=3.276482e-02     RMSE=1.810106e-01
  per-joint RMSE: 0.1425 0.3042 0.1740 0.1134 0.1754 0.0992
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


###############################
### TRAIN LSTM seed=1 H=150 ###
###############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 20:59:32.301558: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 20:59:32.327217: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-pwzd_et5 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 18
 dout = 6
  X_train = (32666, 150, 18), Y_train = (32666, 6)
  X_test  = (4755, 150, 18),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 20:59:34.067963: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:34.072906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:34.073821: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:34.075520: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:34.076433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:34.077291: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:34.162398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:34.163286: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:34.164085: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 20:59:34.164962: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8813 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 20:59:35.347643: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.1011 - val_loss: 0.1570
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.0510 - val_loss: 0.1513
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.0413 - val_loss: 0.1553
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.0366 - val_loss: 0.1460
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.0337 - val_loss: 0.1502
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.0328 - val_loss: 0.1401
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.0308 - val_loss: 0.1510
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.0296 - val_loss: 0.1422
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.0295 - val_loss: 0.1381
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.0283 - val_loss: 0.1404
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.0277 - val_loss: 0.1473
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.0268 - val_loss: 0.1369
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.0265 - val_loss: 0.1481
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.0271 - val_loss: 0.1402
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.0266 - val_loss: 0.1270
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.0255 - val_loss: 0.1342
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.0253 - val_loss: 0.1303
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.0247 - val_loss: 0.1276
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.0251 - val_loss: 0.1250
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.0243 - val_loss: 0.1256
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.0250 - val_loss: 0.1342
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.0243 - val_loss: 0.1288
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.0238 - val_loss: 0.1357
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.0235 - val_loss: 0.1299
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.0236 - val_loss: 0.1375
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.0238 - val_loss: 0.1299
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.0232 - val_loss: 0.1234
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.0232 - val_loss: 0.1259
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.0229 - val_loss: 0.1187
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.0227 - val_loss: 0.1257
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.0232 - val_loss: 0.1282
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.0225 - val_loss: 0.1234
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.0220 - val_loss: 0.1294
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.0219 - val_loss: 0.1240
Epoch 35/120
460/460 - 3s - 6ms/step - loss: 0.0222 - val_loss: 0.1279
Epoch 36/120
460/460 - 3s - 6ms/step - loss: 0.0218 - val_loss: 0.1321
Epoch 37/120
460/460 - 3s - 6ms/step - loss: 0.0217 - val_loss: 0.1454
Epoch 38/120
460/460 - 3s - 6ms/step - loss: 0.0217 - val_loss: 0.1242
Epoch 39/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.1354
Epoch 40/120
460/460 - 3s - 6ms/step - loss: 0.0214 - val_loss: 0.1469
Epoch 41/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.1360
Epoch 42/120
460/460 - 3s - 6ms/step - loss: 0.0209 - val_loss: 0.1457
Epoch 43/120
460/460 - 3s - 6ms/step - loss: 0.0208 - val_loss: 0.1613
Epoch 44/120
460/460 - 3s - 6ms/step - loss: 0.0208 - val_loss: 0.1542
Epoch 45/120
460/460 - 3s - 6ms/step - loss: 0.0209 - val_loss: 0.1587
Epoch 46/120
460/460 - 3s - 6ms/step - loss: 0.0206 - val_loss: 0.1655
Epoch 47/120
460/460 - 3s - 6ms/step - loss: 0.0204 - val_loss: 0.1590
Epoch 48/120
460/460 - 3s - 6ms/step - loss: 0.0203 - val_loss: 0.1797
Epoch 49/120
460/460 - 3s - 6ms/step - loss: 0.0203 - val_loss: 0.1729
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1886
Per-joint RMSE: 0.1528 0.3075 0.1616 0.1457 0.2005 0.0894
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=150 ###
##################################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2 --H 150 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:01:52.737992: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:01:52.763903: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-tk4g6xg8 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:01:53.791201: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:53.796319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:53.797109: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:53.798827: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:53.799674: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:53.800497: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:53.896203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:53.897061: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:53.897810: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:53.898548: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8530 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:01:54.204832: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=3.557224e-02      RMSE=1.886061e-01
  per-joint RMSE: 0.1528 0.3075 0.1616 0.1457 0.2005 0.0894
Combined torque MSE=3.557224e-02     RMSE=1.886060e-01
  per-joint RMSE: 0.1528 0.3075 0.1616 0.1457 0.2005 0.0894
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


###############################
### TRAIN LSTM seed=2 H=150 ###
###############################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:01:56.156008: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:01:56.182236: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-ilpyg_1b because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 18
 dout = 6
  X_train = (32666, 150, 18), Y_train = (32666, 6)
  X_test  = (4755, 150, 18),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:01:57.902472: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:57.907360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:57.908277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:57.910098: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:57.910997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:57.911860: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:57.998033: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:57.999055: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:58.000023: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:01:58.000819: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8527 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:01:59.136773: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.1024 - val_loss: 0.1605
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.0511 - val_loss: 0.1784
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.0414 - val_loss: 0.2129
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.0372 - val_loss: 0.2040
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.0339 - val_loss: 0.1974
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.0323 - val_loss: 0.1722
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.0314 - val_loss: 0.1690
Epoch 8/120
460/460 - 3s - 7ms/step - loss: 0.0305 - val_loss: 0.1759
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.0299 - val_loss: 0.1324
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.0289 - val_loss: 0.1477
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.0276 - val_loss: 0.1471
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.0273 - val_loss: 0.1296
Epoch 13/120
460/460 - 5s - 11ms/step - loss: 0.0271 - val_loss: 0.1630
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.0264 - val_loss: 0.1398
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.0262 - val_loss: 0.1547
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.0261 - val_loss: 0.1622
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.0253 - val_loss: 0.1491
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.0252 - val_loss: 0.1432
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.0248 - val_loss: 0.1541
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.0246 - val_loss: 0.1610
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.0257 - val_loss: 0.1672
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.0242 - val_loss: 0.1573
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.0237 - val_loss: 0.1578
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.0235 - val_loss: 0.1772
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.0236 - val_loss: 0.1738
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.0234 - val_loss: 0.1680
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.0230 - val_loss: 0.1607
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.0228 - val_loss: 0.1559
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.0226 - val_loss: 0.1618
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.0229 - val_loss: 0.1623
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.0224 - val_loss: 0.1491
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.0223 - val_loss: 0.1440
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1751
Per-joint RMSE: 0.1743 0.2913 0.1479 0.1216 0.1567 0.0869
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=2 H=150 ###
##################################

============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2 --H 150 --split test --features state --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:03:31.773779: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:03:31.800478: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-mibej1x4 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:03:32.849347: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:32.854517: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:32.855317: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:32.857000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:32.857793: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:32.858613: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:32.943803: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:32.944695: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:32.945443: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:32.946175: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8493 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:03:33.251423: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=3.066153e-02      RMSE=1.751043e-01
  per-joint RMSE: 0.1743 0.2913 0.1479 0.1216 0.1567 0.0869
Combined torque MSE=3.066153e-02     RMSE=1.751043e-01
  per-joint RMSE: 0.1743 0.2913 0.1479 0.1216 0.1567 0.0869
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


#################################
### CONFIG: feat=tau_hat H=50 ###
#################################

############################################
### BUILD LSTM WINDOWS H=50 feat=tau_hat ###
############################################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 50 --features tau_hat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=50, n_dof=6, feature_dim=6
X_train: (34566, 50, 6)  Y_train: (34566, 6)
X_test : (5255, 50, 6)  Y_test : (5255, 6)
feature_mode=tau_hat


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:03:35.619416: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:03:35.645273: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-o20gde09 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (34566, 50, 6), Y_train = (34566, 6)
  X_test  = (5255, 50, 6),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:03:36.867971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:36.873099: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:36.874021: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:36.875579: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:36.876492: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:36.877351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:36.964239: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:36.965162: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:36.966066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:03:36.967264: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8319 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:03:37.934326: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.5108 - val_loss: 0.5777
Epoch 2/120
487/487 - 2s - 3ms/step - loss: 0.2863 - val_loss: 0.6303
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.2655 - val_loss: 0.6134
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.2123 - val_loss: 0.5795
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.2156 - val_loss: 0.6020
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.1967 - val_loss: 0.5896
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.1766 - val_loss: 0.5501
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.1691 - val_loss: 0.4640
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.1934 - val_loss: 0.5062
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.1784 - val_loss: 0.4991
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.1709 - val_loss: 0.3899
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.1689 - val_loss: 0.4746
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.1597 - val_loss: 0.5020
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.1560 - val_loss: 0.4414
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.1485 - val_loss: 0.4226
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.1005 - val_loss: 0.4497
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0538 - val_loss: 0.4205
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0400 - val_loss: 0.4362
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0705 - val_loss: 0.4618
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0443 - val_loss: 0.4800
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.1177 - val_loss: 0.4768
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0956 - val_loss: 0.4552
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0623 - val_loss: 0.4677
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0363 - val_loss: 0.4658
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0379 - val_loss: 0.4443
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0367 - val_loss: 0.4494
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0392 - val_loss: 0.4724
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0415 - val_loss: 0.4680
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0677 - val_loss: 0.4469
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0405 - val_loss: 0.4791
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0336 - val_loss: 0.4503
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3142
Per-joint RMSE: 0.2551 0.5557 0.3198 0.2058 0.2457 0.1162
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features tau_hat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:04:25.708696: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:04:25.735125: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-cp310wrv because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-30 21:04:26.776869: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:26.781968: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:26.782766: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:26.784850: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:26.785654: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:26.786386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:26.868163: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:26.869108: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:26.869954: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:26.871818: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8499 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:04:27.178460: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=9.871684e-02      RMSE=3.141924e-01
  per-joint RMSE: 0.2551 0.5556 0.3197 0.2058 0.2457 0.1162
Combined torque MSE=9.871684e-02     RMSE=3.141924e-01
  per-joint RMSE: 0.2551 0.5556 0.3197 0.2058 0.2457 0.1162
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:04:29.136419: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:04:29.163021: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-22okrril because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (34566, 50, 6), Y_train = (34566, 6)
  X_test  = (5255, 50, 6),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:04:30.362170: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:30.367001: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:30.368344: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:30.369947: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:30.370743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:30.371487: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:30.454301: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:30.455168: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:30.455920: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:04:30.456665: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8501 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:04:31.432356: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.5273 - val_loss: 0.5611
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.3250 - val_loss: 0.5789
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.2378 - val_loss: 0.5558
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.2090 - val_loss: 0.6338
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.2182 - val_loss: 0.5956
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.1987 - val_loss: 0.5986
Epoch 7/120
487/487 - 2s - 3ms/step - loss: 0.2040 - val_loss: 0.4986
Epoch 8/120
487/487 - 2s - 3ms/step - loss: 0.2429 - val_loss: 0.3481
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.1745 - val_loss: 0.4677
Epoch 10/120
487/487 - 2s - 3ms/step - loss: 0.1760 - val_loss: 0.4728
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.1677 - val_loss: 0.4207
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.1917 - val_loss: 0.4578
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.1769 - val_loss: 0.5137
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.1728 - val_loss: 0.4556
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.1629 - val_loss: 0.3926
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.1567 - val_loss: 0.2660
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.1390 - val_loss: 0.3304
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.1264 - val_loss: 0.2802
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.1389 - val_loss: 0.3645
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.1216 - val_loss: 0.3307
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0948 - val_loss: 0.3220
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0695 - val_loss: 0.3284
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0494 - val_loss: 0.3317
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0680 - val_loss: 0.3503
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0496 - val_loss: 0.4004
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0497 - val_loss: 0.3790
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0540 - val_loss: 0.2950
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0347 - val_loss: 0.3024
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0829 - val_loss: 0.3418
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0464 - val_loss: 0.3657
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0390 - val_loss: 0.3797
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0588 - val_loss: 0.3851
Epoch 33/120
487/487 - 2s - 3ms/step - loss: 0.0397 - val_loss: 0.4002
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0552 - val_loss: 0.3489
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0636 - val_loss: 0.3613
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.1390 - val_loss: 0.3383
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3165
Per-joint RMSE: 0.2306 0.5267 0.3208 0.2349 0.3079 0.1322
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features tau_hat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:05:26.595517: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:05:26.621892: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-syn_4wok because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-30 21:05:27.642940: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:27.647951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:27.648744: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:27.650544: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:27.651409: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:27.652200: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:27.743534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:27.744398: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:27.745142: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:27.745872: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8552 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:05:28.055525: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=1.001645e-01      RMSE=3.164878e-01
  per-joint RMSE: 0.2306 0.5267 0.3208 0.2349 0.3079 0.1322
Combined torque MSE=1.001645e-01     RMSE=3.164878e-01
  per-joint RMSE: 0.2306 0.5267 0.3208 0.2349 0.3079 0.1322
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=2 H=50 ###
##############################

==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:05:30.014558: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:05:30.041051: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-pkdnjccx because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (34566, 50, 6), Y_train = (34566, 6)
  X_test  = (5255, 50, 6),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:05:31.244179: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:31.249002: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:31.249803: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:31.251542: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:31.252346: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:31.253090: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:31.334726: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:31.335674: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:31.336431: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:05:31.337178: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8548 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:05:32.335257: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.5276 - val_loss: 0.4291
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.3354 - val_loss: 0.3434
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.2629 - val_loss: 0.4835
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.2156 - val_loss: 0.4183
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.2303 - val_loss: 0.4710
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.2126 - val_loss: 0.5075
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.2087 - val_loss: 0.4019
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.2060 - val_loss: 0.4362
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.1904 - val_loss: 0.4096
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.1807 - val_loss: 0.3910
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.1825 - val_loss: 0.4346
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.1755 - val_loss: 0.4803
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.1652 - val_loss: 0.5320
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.1774 - val_loss: 0.4814
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.1791 - val_loss: 0.4248
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.2030 - val_loss: 0.5412
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.1837 - val_loss: 0.4806
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.1759 - val_loss: 0.5705
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.1555 - val_loss: 0.5317
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.1496 - val_loss: 0.4930
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.1581 - val_loss: 0.7078
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.1359 - val_loss: 0.5462
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.1371 - val_loss: 0.4557
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.1170 - val_loss: 0.5141
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0926 - val_loss: 0.5450
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.1103 - val_loss: 0.5498
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0724 - val_loss: 0.4922
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0584 - val_loss: 0.4968
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0427 - val_loss: 0.5044
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0355 - val_loss: 0.4460
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0353 - val_loss: 0.4349
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0514 - val_loss: 0.4603
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0513 - val_loss: 0.5373
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.1380 - val_loss: 0.6002
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0964 - val_loss: 0.4405
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3387
Per-joint RMSE: 0.2585 0.6231 0.3505 0.1952 0.2457 0.1091
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=2 H=50 ###
#################################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2 --H 50 --split test --features tau_hat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:06:25.522580: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:06:25.550099: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-b_cu0rzo because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-30 21:06:26.584027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:26.589652: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:26.590449: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:26.592139: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:26.592928: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:26.593660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:26.678149: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:26.678986: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:26.679733: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:26.680545: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8548 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:06:26.989140: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=9.134522e-02      RMSE=3.022337e-01
  per-joint RMSE: 0.2462 0.4832 0.3024 0.2163 0.3154 0.1275
Combined torque MSE=9.134522e-02     RMSE=3.022337e-01
  per-joint RMSE: 0.2462 0.4832 0.3024 0.2163 0.3154 0.1275
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##################################
### CONFIG: feat=tau_hat H=100 ###
##################################

#############################################
### BUILD LSTM WINDOWS H=100 feat=tau_hat ###
#############################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 100 --features tau_hat' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 100
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=100, n_dof=6, feature_dim=6
X_train: (33616, 100, 6)  Y_train: (33616, 6)
X_test : (5005, 100, 6)  Y_test : (5005, 6)
feature_mode=tau_hat


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:06:29.329134: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:06:29.355482: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-nru52bs8 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 6
 dout = 6
  X_train = (33616, 100, 6), Y_train = (33616, 6)
  X_test  = (5005, 100, 6),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:06:30.676031: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:30.681110: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:30.682042: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:30.683701: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:30.684807: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:30.685784: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:30.773203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:30.774117: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:30.774921: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:06:30.775710: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8540 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:06:31.753672: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.4978 - val_loss: 0.5395
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.3652 - val_loss: 0.5568
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.3318 - val_loss: 1.0122
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.3328 - val_loss: 0.6522
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.2855 - val_loss: 0.3394
Epoch 6/120
473/473 - 2s - 5ms/step - loss: 0.3368 - val_loss: 0.4309
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.3960 - val_loss: 0.8312
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.4071 - val_loss: 1.0714
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.3050 - val_loss: 1.0371
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.4061 - val_loss: 1.0567
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.3577 - val_loss: 1.1022
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.2589 - val_loss: 0.9485
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.2409 - val_loss: 1.2978
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.2072 - val_loss: 1.3051
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.2075 - val_loss: 0.7980
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.1822 - val_loss: 0.7649
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.1811 - val_loss: 0.8245
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.2116 - val_loss: 1.0422
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.2049 - val_loss: 0.9802
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.1869 - val_loss: 1.0863
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.2170 - val_loss: 0.8718
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.1727 - val_loss: 0.8201
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.1400 - val_loss: 0.8229
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.1754 - val_loss: 0.5592
Epoch 25/120
473/473 - 2s - 5ms/step - loss: 0.1643 - val_loss: 0.6369
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.1428 - val_loss: 0.7434
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.2330 - val_loss: 0.7198
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.1777 - val_loss: 0.8505
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.1581 - val_loss: 1.0362
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.1895 - val_loss: 0.8016
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.1526 - val_loss: 0.7068
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0997 - val_loss: 0.7261
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.1442 - val_loss: 0.4361
Epoch 34/120
473/473 - 2s - 5ms/step - loss: 0.2080 - val_loss: 0.9646
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.1953 - val_loss: 1.3512
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.1347 - val_loss: 1.6383
Epoch 37/120
473/473 - 2s - 5ms/step - loss: 0.0987 - val_loss: 1.3833
Epoch 38/120
473/473 - 2s - 5ms/step - loss: 0.0695 - val_loss: 1.4870
Epoch 39/120
473/473 - 2s - 5ms/step - loss: 0.0569 - val_loss: 1.3606
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.1054 - val_loss: 0.9112
Epoch 41/120
473/473 - 2s - 4ms/step - loss: 0.0858 - val_loss: 1.0821
Epoch 42/120
473/473 - 2s - 4ms/step - loss: 0.0778 - val_loss: 0.9744
Epoch 43/120
473/473 - 2s - 4ms/step - loss: 0.0513 - val_loss: 1.1233
Epoch 44/120
473/473 - 2s - 4ms/step - loss: 0.0629 - val_loss: 1.1031
Epoch 45/120
473/473 - 2s - 4ms/step - loss: 0.0545 - val_loss: 1.1348
Epoch 46/120
473/473 - 2s - 4ms/step - loss: 0.0965 - val_loss: 1.1747
Epoch 47/120
473/473 - 2s - 4ms/step - loss: 0.1084 - val_loss: 1.0694
Epoch 48/120
473/473 - 2s - 4ms/step - loss: 0.1485 - val_loss: 1.6030
Epoch 49/120
473/473 - 2s - 4ms/step - loss: 0.0851 - val_loss: 1.6493
Epoch 50/120
473/473 - 2s - 4ms/step - loss: 0.0574 - val_loss: 1.6423
Epoch 51/120
473/473 - 2s - 4ms/step - loss: 0.0782 - val_loss: 1.4830
Epoch 52/120
473/473 - 2s - 4ms/step - loss: 0.0726 - val_loss: 1.5843
Epoch 53/120
473/473 - 2s - 4ms/step - loss: 0.0511 - val_loss: 1.5926
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3176
Per-joint RMSE: 0.2314 0.5725 0.3255 0.1933 0.2544 0.1263
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features tau_hat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:08:24.272713: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:08:24.299145: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-ab9k5aw1 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-30 21:08:25.329483: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:25.334887: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:25.335762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:25.337432: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:25.338231: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:25.339068: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:25.419755: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:25.420613: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:25.421358: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:25.422090: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8226 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:08:25.721700: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=9.909783e-02      RMSE=3.147981e-01
  per-joint RMSE: 0.2237 0.5502 0.3318 0.1954 0.2807 0.1214
Combined torque MSE=9.909783e-02     RMSE=3.147981e-01
  per-joint RMSE: 0.2237 0.5502 0.3318 0.1954 0.2807 0.1214
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:08:27.659639: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:08:27.685295: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-qy6kazuf because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 6
 dout = 6
  X_train = (33616, 100, 6), Y_train = (33616, 6)
  X_test  = (5005, 100, 6),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:08:28.964366: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:28.969348: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:28.970182: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:28.972006: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:28.972802: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:28.973621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:29.056859: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:29.057700: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:29.058442: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:08:29.059187: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8296 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:08:30.048314: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.5180 - val_loss: 0.5274
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.3238 - val_loss: 0.6993
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.3276 - val_loss: 0.7799
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.3086 - val_loss: 1.1024
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.4006 - val_loss: 0.7906
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.3561 - val_loss: 0.9169
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.2586 - val_loss: 0.7948
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.2656 - val_loss: 0.7842
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.2426 - val_loss: 0.9103
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.2288 - val_loss: 0.7585
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.2452 - val_loss: 0.7949
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.2222 - val_loss: 0.8125
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.2035 - val_loss: 0.8608
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.1848 - val_loss: 0.7896
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.1702 - val_loss: 0.9785
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.1898 - val_loss: 0.7860
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.1369 - val_loss: 0.8204
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.1059 - val_loss: 0.8109
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.1575 - val_loss: 0.7939
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0962 - val_loss: 0.9299
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.1800 - val_loss: 0.8627
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.1542 - val_loss: 0.7846
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.1387 - val_loss: 0.8719
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0928 - val_loss: 0.7899
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0755 - val_loss: 0.7787
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0568 - val_loss: 0.7410
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0849 - val_loss: 0.8772
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0551 - val_loss: 0.8717
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0555 - val_loss: 0.8613
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.1127 - val_loss: 0.7402
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0977 - val_loss: 0.6914
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0848 - val_loss: 0.7103
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.0850 - val_loss: 0.7595
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.0598 - val_loss: 0.8408
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0474 - val_loss: 0.7891
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.0608 - val_loss: 0.8104
Epoch 37/120
473/473 - 2s - 4ms/step - loss: 0.0484 - val_loss: 0.8400
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0641 - val_loss: 0.8929
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0785 - val_loss: 0.7155
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.0469 - val_loss: 0.7265
Epoch 41/120
473/473 - 2s - 4ms/step - loss: 0.0841 - val_loss: 0.7997
Epoch 42/120
473/473 - 2s - 4ms/step - loss: 0.0504 - val_loss: 0.7702
Epoch 43/120
473/473 - 2s - 4ms/step - loss: 0.0431 - val_loss: 0.8910
Epoch 44/120
473/473 - 2s - 4ms/step - loss: 0.0423 - val_loss: 0.8859
Epoch 45/120
473/473 - 2s - 4ms/step - loss: 0.0467 - val_loss: 0.9094
Epoch 46/120
473/473 - 2s - 4ms/step - loss: 0.0631 - val_loss: 0.8830
Epoch 47/120
473/473 - 2s - 4ms/step - loss: 0.1034 - val_loss: 0.9749
Epoch 48/120
473/473 - 2s - 4ms/step - loss: 0.0514 - val_loss: 0.9249
Epoch 49/120
473/473 - 2s - 4ms/step - loss: 0.0395 - val_loss: 0.8845
Epoch 50/120
473/473 - 2s - 4ms/step - loss: 0.0388 - val_loss: 0.9169
Epoch 51/120
473/473 - 2s - 4ms/step - loss: 0.0379 - val_loss: 0.8866
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3164
Per-joint RMSE: 0.2238 0.5735 0.3206 0.1685 0.2817 0.1052
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features tau_hat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:10:17.498207: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:10:17.524388: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-a24fsy0r because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-30 21:10:18.550611: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:18.555551: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:18.556448: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:18.558127: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:18.559003: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:18.559827: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:18.638407: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:18.639360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:18.640117: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:18.640855: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8354 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:10:18.944899: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=8.085169e-02      RMSE=2.843443e-01
  per-joint RMSE: 0.2199 0.4709 0.3136 0.2175 0.2442 0.0985
Combined torque MSE=8.085169e-02     RMSE=2.843443e-01
  per-joint RMSE: 0.2199 0.4709 0.3136 0.2175 0.2442 0.0985
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=2 H=100 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:10:20.892529: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:10:20.917900: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-nm43412k because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 6
 dout = 6
  X_train = (33616, 100, 6), Y_train = (33616, 6)
  X_test  = (5005, 100, 6),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:10:22.203716: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:22.208555: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:22.209342: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:22.210993: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:22.211852: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:22.212586: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:22.296738: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:22.297586: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:22.298408: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:10:22.299143: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8347 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:10:23.278324: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 3s - 7ms/step - loss: 0.5295 - val_loss: 0.4027
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.4024 - val_loss: 0.5544
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.3558 - val_loss: 0.6630
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.3772 - val_loss: 0.4586
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.2830 - val_loss: 0.4384
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.2697 - val_loss: 0.5897
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.2707 - val_loss: 1.0763
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.2677 - val_loss: 1.0359
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.2680 - val_loss: 1.1734
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.2449 - val_loss: 1.0131
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.2129 - val_loss: 0.9075
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.2392 - val_loss: 0.5348
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.2089 - val_loss: 0.6535
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.2241 - val_loss: 0.5984
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.2498 - val_loss: 0.4898
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.2423 - val_loss: 0.7143
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.1977 - val_loss: 0.7660
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.2205 - val_loss: 0.7954
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.1985 - val_loss: 0.9033
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.2007 - val_loss: 0.7331
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.1799 - val_loss: 0.5891
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.1758 - val_loss: 0.5608
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.1718 - val_loss: 0.6778
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.1883 - val_loss: 0.5048
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.1981 - val_loss: 0.6523
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.1856 - val_loss: 0.6881
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.2062 - val_loss: 0.5412
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.2506 - val_loss: 0.6027
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.2018 - val_loss: 0.7612
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.1653 - val_loss: 0.7029
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.1414 - val_loss: 0.6506
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.1669 - val_loss: 0.4427
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.1682 - val_loss: 0.9440
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.1293 - val_loss: 1.0271
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0809 - val_loss: 0.8746
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.0882 - val_loss: 1.0434
Epoch 37/120
473/473 - 2s - 4ms/step - loss: 0.0759 - val_loss: 0.8390
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0718 - val_loss: 0.9434
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0652 - val_loss: 1.0425
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.0822 - val_loss: 1.0315
Epoch 41/120
473/473 - 2s - 4ms/step - loss: 0.1016 - val_loss: 1.2260
Epoch 42/120
473/473 - 2s - 4ms/step - loss: 0.0825 - val_loss: 1.1352
Epoch 43/120
473/473 - 2s - 4ms/step - loss: 0.0613 - val_loss: 1.1719
Epoch 44/120
473/473 - 2s - 4ms/step - loss: 0.0568 - val_loss: 1.1150
Epoch 45/120
473/473 - 2s - 4ms/step - loss: 0.0510 - val_loss: 1.1210
Epoch 46/120
473/473 - 2s - 4ms/step - loss: 0.0523 - val_loss: 1.2162
Epoch 47/120
473/473 - 2s - 4ms/step - loss: 0.0862 - val_loss: 0.8214
Epoch 48/120
473/473 - 2s - 4ms/step - loss: 0.0795 - val_loss: 0.9846
Epoch 49/120
473/473 - 2s - 4ms/step - loss: 0.0445 - val_loss: 1.1215
Epoch 50/120
473/473 - 2s - 4ms/step - loss: 0.0570 - val_loss: 1.2177
Epoch 51/120
473/473 - 2s - 4ms/step - loss: 0.0568 - val_loss: 0.9750
Epoch 52/120
473/473 - 2s - 4ms/step - loss: 0.0535 - val_loss: 1.1944
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3208
Per-joint RMSE: 0.2677 0.5575 0.3553 0.1822 0.2447 0.1261
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=2 H=100 ###
##################################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2 --H 100 --split test --features tau_hat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:12:11.837276: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:12:11.863412: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-n52ie6xd because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-30 21:12:12.860054: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:12.864929: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:12.865723: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:12.867516: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:12.868307: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:12.869040: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:12.950801: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:12.951720: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:12.952455: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:12.953196: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8497 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:12:13.259975: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=9.116518e-02      RMSE=3.019357e-01
  per-joint RMSE: 0.2201 0.5254 0.3408 0.1964 0.2406 0.0991
Combined torque MSE=9.116518e-02     RMSE=3.019357e-01
  per-joint RMSE: 0.2201 0.5254 0.3408 0.1964 0.2406 0.0991
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


##################################
### CONFIG: feat=tau_hat H=150 ###
##################################

#############################################
### BUILD LSTM WINDOWS H=150 feat=tau_hat ###
#############################################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 150 --features tau_hat' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 150
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=150, n_dof=6, feature_dim=6
X_train: (32666, 150, 6)  Y_train: (32666, 6)
X_test : (4755, 150, 6)  Y_test : (4755, 6)
feature_mode=tau_hat


###############################
### TRAIN LSTM seed=0 H=150 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:12:15.607026: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:12:15.632704: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-v9g_49ja because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 6
 dout = 6
  X_train = (32666, 150, 6), Y_train = (32666, 6)
  X_test  = (4755, 150, 6),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:12:17.007509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:17.012544: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:17.013461: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:17.015203: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:17.016195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:17.016944: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:17.106614: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:17.107510: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:17.108306: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:12:17.109089: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8498 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:12:18.133742: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.5066 - val_loss: 0.4517
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.3098 - val_loss: 0.7112
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.2822 - val_loss: 0.5888
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.2412 - val_loss: 0.7477
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.3117 - val_loss: 0.5116
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.2199 - val_loss: 0.3864
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.2568 - val_loss: 0.6952
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.2976 - val_loss: 0.7854
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.3155 - val_loss: 0.5683
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.3269 - val_loss: 0.9197
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.2746 - val_loss: 0.8312
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.3252 - val_loss: 0.9905
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.2750 - val_loss: 0.6798
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.2769 - val_loss: 0.6920
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.2645 - val_loss: 0.4143
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.2720 - val_loss: 0.6959
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.3266 - val_loss: 0.7292
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.3328 - val_loss: 0.5121
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.3320 - val_loss: 0.4590
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.2878 - val_loss: 0.7764
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.2714 - val_loss: 0.3342
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.2432 - val_loss: 0.3412
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.1918 - val_loss: 0.8361
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.2276 - val_loss: 0.7442
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.2385 - val_loss: 0.3017
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.2650 - val_loss: 0.4345
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.2357 - val_loss: 0.4518
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.1579 - val_loss: 0.5848
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.2086 - val_loss: 0.4893
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.2715 - val_loss: 0.5237
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.2407 - val_loss: 0.4743
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.2299 - val_loss: 0.4597
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.1762 - val_loss: 0.6444
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.2177 - val_loss: 0.8051
Epoch 35/120
460/460 - 3s - 6ms/step - loss: 0.2418 - val_loss: 0.8600
Epoch 36/120
460/460 - 3s - 6ms/step - loss: 0.3088 - val_loss: 0.9339
Epoch 37/120
460/460 - 3s - 6ms/step - loss: 0.2117 - val_loss: 0.6660
Epoch 38/120
460/460 - 3s - 6ms/step - loss: 0.1380 - val_loss: 0.9689
Epoch 39/120
460/460 - 3s - 6ms/step - loss: 0.1248 - val_loss: 0.7779
Epoch 40/120
460/460 - 3s - 6ms/step - loss: 0.1753 - val_loss: 0.8021
Epoch 41/120
460/460 - 3s - 6ms/step - loss: 0.2154 - val_loss: 0.7501
Epoch 42/120
460/460 - 3s - 6ms/step - loss: 0.1151 - val_loss: 0.8810
Epoch 43/120
460/460 - 3s - 6ms/step - loss: 0.1669 - val_loss: 0.5317
Epoch 44/120
460/460 - 3s - 6ms/step - loss: 0.1845 - val_loss: 0.5784
Epoch 45/120
460/460 - 3s - 6ms/step - loss: 0.1466 - val_loss: 0.6889
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3060
Per-joint RMSE: 0.2602 0.5002 0.3244 0.2101 0.2843 0.1176
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=150 ###
##################################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2 --H 150 --split test --features tau_hat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:14:23.644103: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:14:23.670006: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-24ze56tt because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-30 21:14:24.706707: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:24.711680: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:24.712574: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:24.714222: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:24.715103: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:24.715846: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:24.799906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:24.800827: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:24.801586: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:24.802318: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8480 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:14:25.107779: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=9.364516e-02      RMSE=3.060150e-01
  per-joint RMSE: 0.2601 0.5002 0.3243 0.2101 0.2843 0.1176
Combined torque MSE=9.364516e-02     RMSE=3.060150e-01
  per-joint RMSE: 0.2601 0.5002 0.3243 0.2101 0.2843 0.1176
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


###############################
### TRAIN LSTM seed=1 H=150 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:14:27.098216: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:14:27.123999: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-3m2ps1ds because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 6
 dout = 6
  X_train = (32666, 150, 6), Y_train = (32666, 6)
  X_test  = (4755, 150, 6),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:14:28.520997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:28.526053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:28.526887: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:28.528594: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:28.529404: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:28.530160: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:28.607795: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:28.608732: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:28.609501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:14:28.610258: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8501 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:14:29.628557: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.5044 - val_loss: 0.6860
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.3095 - val_loss: 0.4797
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.2699 - val_loss: 0.5668
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.2388 - val_loss: 0.4693
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.2127 - val_loss: 0.8666
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.2433 - val_loss: 0.8538
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.2943 - val_loss: 0.8741
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.2297 - val_loss: 1.0794
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.1702 - val_loss: 1.0571
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.1842 - val_loss: 1.0657
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.1585 - val_loss: 1.0292
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.1459 - val_loss: 0.8160
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.2610 - val_loss: 0.7644
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.3069 - val_loss: 0.9147
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.2672 - val_loss: 0.8977
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.2324 - val_loss: 0.8371
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.1476 - val_loss: 0.7158
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.2242 - val_loss: 0.9265
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.2842 - val_loss: 0.7176
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.3054 - val_loss: 0.6629
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.3768 - val_loss: 0.4133
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.2646 - val_loss: 0.4704
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.1961 - val_loss: 0.4089
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.1457 - val_loss: 0.4163
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.1160 - val_loss: 0.4244
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.1766 - val_loss: 0.4316
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.2387 - val_loss: 0.6087
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.1461 - val_loss: 0.7175
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.1178 - val_loss: 0.8571
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.1126 - val_loss: 0.6179
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.1017 - val_loss: 0.6355
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.0887 - val_loss: 0.5726
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.1194 - val_loss: 0.5362
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.1189 - val_loss: 0.7511
Epoch 35/120
460/460 - 3s - 6ms/step - loss: 0.0832 - val_loss: 0.5727
Epoch 36/120
460/460 - 3s - 6ms/step - loss: 0.0824 - val_loss: 0.6584
Epoch 37/120
460/460 - 3s - 6ms/step - loss: 0.0764 - val_loss: 0.7612
Epoch 38/120
460/460 - 3s - 6ms/step - loss: 0.0580 - val_loss: 0.8190
Epoch 39/120
460/460 - 3s - 6ms/step - loss: 0.0875 - val_loss: 0.9040
Epoch 40/120
460/460 - 3s - 6ms/step - loss: 0.0925 - val_loss: 0.7257
Epoch 41/120
460/460 - 3s - 6ms/step - loss: 0.0671 - val_loss: 0.5970
Epoch 42/120
460/460 - 3s - 6ms/step - loss: 0.0566 - val_loss: 0.6364
Epoch 43/120
460/460 - 3s - 6ms/step - loss: 0.0487 - val_loss: 0.6378
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3438
Per-joint RMSE: 0.2534 0.6496 0.3277 0.1751 0.2652 0.1209
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=150 ###
##################################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2 --H 150 --split test --features tau_hat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:16:30.571656: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:16:30.597866: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-vqgnfj45 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-30 21:16:31.620593: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:31.625690: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:31.626523: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:31.628161: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:31.628956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:31.629777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:31.709816: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:31.711387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:31.712375: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:31.713111: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8595 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:16:32.033443: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=1.181855e-01      RMSE=3.437811e-01
  per-joint RMSE: 0.2534 0.6496 0.3277 0.1751 0.2652 0.1209
Combined torque MSE=1.181855e-01     RMSE=3.437811e-01
  per-joint RMSE: 0.2534 0.6496 0.3277 0.1751 0.2652 0.1209
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


###############################
### TRAIN LSTM seed=2 H=150 ###
###############################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:16:34.010566: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:16:34.036165: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-i4e2vbsd because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_tau_hat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 6
 dout = 6
  X_train = (32666, 150, 6), Y_train = (32666, 6)
  X_test  = (4755, 150, 6),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:16:35.422941: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:35.427767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:35.428569: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:35.430122: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:35.431005: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:35.431751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:35.504430: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:35.505446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:35.506287: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:16:35.507101: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8595 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:16:36.542300: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.4980 - val_loss: 0.5592
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.3299 - val_loss: 0.5462
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.2830 - val_loss: 0.3569
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.3194 - val_loss: 0.5645
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.3093 - val_loss: 0.4195
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.3132 - val_loss: 0.4146
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.2705 - val_loss: 0.3969
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.3401 - val_loss: 0.4841
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.3487 - val_loss: 0.4445
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.3458 - val_loss: 0.5109
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.2980 - val_loss: 0.4742
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.3062 - val_loss: 0.4711
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.3378 - val_loss: 0.4401
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.2826 - val_loss: 0.7184
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.2630 - val_loss: 0.6651
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.3196 - val_loss: 0.7062
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.3232 - val_loss: 0.3646
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.3256 - val_loss: 0.5437
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.2611 - val_loss: 0.5078
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.2799 - val_loss: 0.9052
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.2509 - val_loss: 0.9055
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.2398 - val_loss: 1.0307
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.2603 - val_loss: 0.6743
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.2323 - val_loss: 0.7943
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.2118 - val_loss: 0.7384
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.1986 - val_loss: 0.6944
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.2338 - val_loss: 0.9856
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.2103 - val_loss: 0.9898
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.2109 - val_loss: 0.9322
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.2170 - val_loss: 0.8301
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.2057 - val_loss: 0.7772
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.1993 - val_loss: 1.0651
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.1746 - val_loss: 0.5041
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.1522 - val_loss: 0.6381
Epoch 35/120
460/460 - 3s - 6ms/step - loss: 0.1498 - val_loss: 0.8415
Epoch 36/120
460/460 - 3s - 6ms/step - loss: 0.1448 - val_loss: 0.9186
Epoch 37/120
460/460 - 3s - 6ms/step - loss: 0.1271 - val_loss: 0.9603
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.3735
Per-joint RMSE: 0.3124 0.6829 0.3623 0.1943 0.2914 0.1382
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=2 H=150 ###
##################################

====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2 --H 150 --split test --features tau_hat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:18:19.586237: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:18:19.612500: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-fnu0859q because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-30 21:18:20.644697: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:20.651399: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:20.652196: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:20.653918: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:20.654723: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:20.655534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:20.741503: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:20.742450: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:20.743259: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:20.744000: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8608 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:18:21.052056: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=1.069577e-01      RMSE=3.270438e-01
  per-joint RMSE: 0.2496 0.6053 0.3289 0.1624 0.2580 0.1094
Combined torque MSE=1.069577e-01     RMSE=3.270438e-01
  per-joint RMSE: 0.2496 0.6053 0.3289 0.1624 0.2580 0.1094
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_tau_hat__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


######################################
### CONFIG: feat=state_tauhat H=50 ###
######################################

#################################################
### BUILD LSTM WINDOWS H=50 feat=state_tauhat ###
#################################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 50 --features state_tauhat' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=50, n_dof=6, feature_dim=18
X_train: (34566, 50, 18)  Y_train: (34566, 6)
X_test : (5255, 50, 18)  Y_test : (5255, 6)
feature_mode=state_tauhat


##############################
### TRAIN LSTM seed=0 H=50 ###
##############################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:18:23.461085: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:18:23.486824: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-cnyia_zu because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (34566, 50, 18), Y_train = (34566, 6)
  X_test  = (5255, 50, 18),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:18:24.798938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:24.804065: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:24.804995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:24.806792: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:24.807796: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:24.808662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:24.905109: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:24.906031: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:24.906975: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:18:24.907763: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8605 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:18:25.887454: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0931 - val_loss: 0.1264
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0482 - val_loss: 0.1062
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0403 - val_loss: 0.1078
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0363 - val_loss: 0.1062
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0333 - val_loss: 0.0940
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0318 - val_loss: 0.0925
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0302 - val_loss: 0.0959
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0294 - val_loss: 0.0879
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0286 - val_loss: 0.0867
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0278 - val_loss: 0.0896
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0272 - val_loss: 0.0845
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0267 - val_loss: 0.0808
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0268 - val_loss: 0.0839
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0261 - val_loss: 0.0849
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0258 - val_loss: 0.0829
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0255 - val_loss: 0.0796
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0249 - val_loss: 0.0795
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0248 - val_loss: 0.0831
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0247 - val_loss: 0.0843
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0242 - val_loss: 0.0793
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0244 - val_loss: 0.0843
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0239 - val_loss: 0.0853
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0239 - val_loss: 0.0810
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0233 - val_loss: 0.0861
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0232 - val_loss: 0.0793
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0228 - val_loss: 0.0840
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0229 - val_loss: 0.0860
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.0876
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.0837
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.0797
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0219 - val_loss: 0.0863
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.0870
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.0817
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0223 - val_loss: 0.0895
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0216 - val_loss: 0.0899
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.0889
Epoch 37/120
487/487 - 1s - 3ms/step - loss: 0.0216 - val_loss: 0.0867
Epoch 38/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.0879
Epoch 39/120
487/487 - 1s - 3ms/step - loss: 0.0211 - val_loss: 0.0914
Epoch 40/120
487/487 - 1s - 3ms/step - loss: 0.0211 - val_loss: 0.0902
Epoch 41/120
487/487 - 1s - 3ms/step - loss: 0.0208 - val_loss: 0.0958
Epoch 42/120
487/487 - 1s - 3ms/step - loss: 0.0209 - val_loss: 0.0888
Epoch 43/120
487/487 - 1s - 3ms/step - loss: 0.0205 - val_loss: 0.0945
Epoch 44/120
487/487 - 1s - 3ms/step - loss: 0.0205 - val_loss: 0.0974
Epoch 45/120
487/487 - 1s - 3ms/step - loss: 0.0210 - val_loss: 0.0939
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1723
Per-joint RMSE: 0.1112 0.3153 0.1348 0.1082 0.1765 0.0724
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=0 H=50 ###
#################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state_tauhat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:19:32.780493: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:19:32.806307: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-wj1tz6ei because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:19:33.872865: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:33.877872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:33.878668: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:33.880286: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:33.881070: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:33.881807: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:33.968789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:33.969617: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:33.970355: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:33.971096: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8592 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:19:34.279603: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=2.967723e-02      RMSE=1.722708e-01
  per-joint RMSE: 0.1112 0.3153 0.1348 0.1082 0.1765 0.0724
Combined torque MSE=2.967723e-02     RMSE=1.722708e-01
  per-joint RMSE: 0.1112 0.3153 0.1348 0.1082 0.1765 0.0724
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=1 H=50 ###
##############################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:19:36.241904: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:19:36.268071: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-gorqr2jr because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (34566, 50, 18), Y_train = (34566, 6)
  X_test  = (5255, 50, 18),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:19:37.590294: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:37.595191: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:37.595991: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:37.597649: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:37.598447: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:37.599179: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:37.681848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:37.682712: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:37.683511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:19:37.684240: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8580 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:19:38.704942: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0947 - val_loss: 0.1063
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0475 - val_loss: 0.1401
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0395 - val_loss: 0.1467
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0349 - val_loss: 0.1532
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0332 - val_loss: 0.1568
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0313 - val_loss: 0.1340
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0293 - val_loss: 0.1516
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0292 - val_loss: 0.1389
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0292 - val_loss: 0.1403
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0287 - val_loss: 0.1372
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0272 - val_loss: 0.1435
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0272 - val_loss: 0.1308
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0264 - val_loss: 0.1422
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0263 - val_loss: 0.1239
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0256 - val_loss: 0.1231
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.1195
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0252 - val_loss: 0.1131
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.1196
Epoch 19/120
487/487 - 2s - 3ms/step - loss: 0.0245 - val_loss: 0.1137
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0241 - val_loss: 0.1171
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0243 - val_loss: 0.1158
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0241 - val_loss: 0.1090
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0237 - val_loss: 0.1027
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0234 - val_loss: 0.1104
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0242 - val_loss: 0.1136
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0233 - val_loss: 0.1156
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0230 - val_loss: 0.1045
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0228 - val_loss: 0.1072
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.1143
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.1042
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0224 - val_loss: 0.1042
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0219 - val_loss: 0.1053
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0220 - val_loss: 0.1111
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0218 - val_loss: 0.1077
Epoch 35/120
487/487 - 1s - 3ms/step - loss: 0.0220 - val_loss: 0.1063
Epoch 36/120
487/487 - 1s - 3ms/step - loss: 0.0215 - val_loss: 0.0996
Epoch 37/120
487/487 - 1s - 3ms/step - loss: 0.0217 - val_loss: 0.1025
Epoch 38/120
487/487 - 1s - 3ms/step - loss: 0.0212 - val_loss: 0.1066
Epoch 39/120
487/487 - 1s - 3ms/step - loss: 0.0216 - val_loss: 0.0994
Epoch 40/120
487/487 - 1s - 3ms/step - loss: 0.0211 - val_loss: 0.1059
Epoch 41/120
487/487 - 1s - 3ms/step - loss: 0.0210 - val_loss: 0.1001
Epoch 42/120
487/487 - 1s - 3ms/step - loss: 0.0209 - val_loss: 0.1083
Epoch 43/120
487/487 - 1s - 3ms/step - loss: 0.0208 - val_loss: 0.1059
Epoch 44/120
487/487 - 1s - 3ms/step - loss: 0.0208 - val_loss: 0.1127
Epoch 45/120
487/487 - 1s - 3ms/step - loss: 0.0207 - val_loss: 0.1083
Epoch 46/120
487/487 - 2s - 3ms/step - loss: 0.0205 - val_loss: 0.0991
Epoch 47/120
487/487 - 1s - 3ms/step - loss: 0.0202 - val_loss: 0.1079
Epoch 48/120
487/487 - 1s - 3ms/step - loss: 0.0203 - val_loss: 0.1035
Epoch 49/120
487/487 - 1s - 3ms/step - loss: 0.0203 - val_loss: 0.1006
Epoch 50/120
487/487 - 1s - 3ms/step - loss: 0.0201 - val_loss: 0.1049
Epoch 51/120
487/487 - 1s - 3ms/step - loss: 0.0200 - val_loss: 0.1065
Epoch 52/120
487/487 - 1s - 3ms/step - loss: 0.0200 - val_loss: 0.1142
Epoch 53/120
487/487 - 1s - 3ms/step - loss: 0.0200 - val_loss: 0.1056
Epoch 54/120
487/487 - 1s - 3ms/step - loss: 0.0200 - val_loss: 0.1074
Epoch 55/120
487/487 - 1s - 3ms/step - loss: 0.0198 - val_loss: 0.1114
Epoch 56/120
487/487 - 1s - 3ms/step - loss: 0.0197 - val_loss: 0.1078
Epoch 57/120
487/487 - 1s - 3ms/step - loss: 0.0196 - val_loss: 0.1078
Epoch 58/120
487/487 - 1s - 3ms/step - loss: 0.0194 - val_loss: 0.1090
Epoch 59/120
487/487 - 1s - 3ms/step - loss: 0.0194 - val_loss: 0.1047
Epoch 60/120
487/487 - 1s - 3ms/step - loss: 0.0193 - val_loss: 0.1082
Epoch 61/120
487/487 - 1s - 3ms/step - loss: 0.0193 - val_loss: 0.1119
Epoch 62/120
487/487 - 1s - 3ms/step - loss: 0.0192 - val_loss: 0.1090
Epoch 63/120
487/487 - 1s - 3ms/step - loss: 0.0190 - val_loss: 0.1147
Epoch 64/120
487/487 - 1s - 3ms/step - loss: 0.0191 - val_loss: 0.1104
Epoch 65/120
487/487 - 1s - 3ms/step - loss: 0.0189 - val_loss: 0.1154
Epoch 66/120
487/487 - 1s - 3ms/step - loss: 0.0190 - val_loss: 0.1066
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1739
Per-joint RMSE: 0.1292 0.2774 0.1646 0.1169 0.2003 0.0828
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=1 H=50 ###
#################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state_tauhat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:21:17.166294: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:21:17.192696: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-e_u5_jqu because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:21:18.219506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:18.224552: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:18.225694: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:18.227309: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:18.228167: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:18.228985: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:18.309144: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:18.310028: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:18.310773: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:18.311504: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8555 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:21:18.617473: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=3.022906e-02      RMSE=1.738651e-01
  per-joint RMSE: 0.1292 0.2774 0.1646 0.1169 0.2003 0.0828
Combined torque MSE=3.022906e-02     RMSE=1.738651e-01
  per-joint RMSE: 0.1292 0.2774 0.1646 0.1169 0.2003 0.0828
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


##############################
### TRAIN LSTM seed=2 H=50 ###
##############################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:21:20.574841: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:21:20.600885: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-y5k05g3n because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (34566, 50, 18), Y_train = (34566, 6)
  X_test  = (5255, 50, 18),  Y_test  = (5255, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:21:21.914431: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:21.919324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:21.920126: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:21.921657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:21.922444: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:21.923178: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:22.005871: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:22.006786: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:22.007533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:21:22.008349: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8557 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:21:23.086831: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
487/487 - 3s - 6ms/step - loss: 0.0945 - val_loss: 0.1023
Epoch 2/120
487/487 - 1s - 3ms/step - loss: 0.0488 - val_loss: 0.0956
Epoch 3/120
487/487 - 1s - 3ms/step - loss: 0.0400 - val_loss: 0.0928
Epoch 4/120
487/487 - 1s - 3ms/step - loss: 0.0355 - val_loss: 0.0900
Epoch 5/120
487/487 - 1s - 3ms/step - loss: 0.0328 - val_loss: 0.0977
Epoch 6/120
487/487 - 1s - 3ms/step - loss: 0.0328 - val_loss: 0.0994
Epoch 7/120
487/487 - 1s - 3ms/step - loss: 0.0313 - val_loss: 0.0939
Epoch 8/120
487/487 - 1s - 3ms/step - loss: 0.0291 - val_loss: 0.1039
Epoch 9/120
487/487 - 1s - 3ms/step - loss: 0.0293 - val_loss: 0.0980
Epoch 10/120
487/487 - 1s - 3ms/step - loss: 0.0286 - val_loss: 0.1069
Epoch 11/120
487/487 - 1s - 3ms/step - loss: 0.0271 - val_loss: 0.1037
Epoch 12/120
487/487 - 1s - 3ms/step - loss: 0.0269 - val_loss: 0.1076
Epoch 13/120
487/487 - 1s - 3ms/step - loss: 0.0267 - val_loss: 0.1050
Epoch 14/120
487/487 - 1s - 3ms/step - loss: 0.0262 - val_loss: 0.1023
Epoch 15/120
487/487 - 1s - 3ms/step - loss: 0.0255 - val_loss: 0.1092
Epoch 16/120
487/487 - 1s - 3ms/step - loss: 0.0264 - val_loss: 0.1137
Epoch 17/120
487/487 - 1s - 3ms/step - loss: 0.0250 - val_loss: 0.1081
Epoch 18/120
487/487 - 1s - 3ms/step - loss: 0.0249 - val_loss: 0.1028
Epoch 19/120
487/487 - 1s - 3ms/step - loss: 0.0243 - val_loss: 0.1089
Epoch 20/120
487/487 - 1s - 3ms/step - loss: 0.0244 - val_loss: 0.1068
Epoch 21/120
487/487 - 1s - 3ms/step - loss: 0.0239 - val_loss: 0.1051
Epoch 22/120
487/487 - 1s - 3ms/step - loss: 0.0237 - val_loss: 0.1126
Epoch 23/120
487/487 - 1s - 3ms/step - loss: 0.0239 - val_loss: 0.1058
Epoch 24/120
487/487 - 1s - 3ms/step - loss: 0.0234 - val_loss: 0.1036
Epoch 25/120
487/487 - 1s - 3ms/step - loss: 0.0232 - val_loss: 0.1055
Epoch 26/120
487/487 - 1s - 3ms/step - loss: 0.0235 - val_loss: 0.1095
Epoch 27/120
487/487 - 1s - 3ms/step - loss: 0.0229 - val_loss: 0.1069
Epoch 28/120
487/487 - 1s - 3ms/step - loss: 0.0239 - val_loss: 0.1041
Epoch 29/120
487/487 - 1s - 3ms/step - loss: 0.0226 - val_loss: 0.1059
Epoch 30/120
487/487 - 1s - 3ms/step - loss: 0.0225 - val_loss: 0.1082
Epoch 31/120
487/487 - 1s - 3ms/step - loss: 0.0227 - val_loss: 0.1072
Epoch 32/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.1208
Epoch 33/120
487/487 - 1s - 3ms/step - loss: 0.0220 - val_loss: 0.1144
Epoch 34/120
487/487 - 1s - 3ms/step - loss: 0.0221 - val_loss: 0.1194
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1917
Per-joint RMSE: 0.1483 0.3229 0.1591 0.1642 0.1849 0.0883
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_rmse_time.png


#################################
### COMBINED EVAL seed=2 H=50 ###
#################################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/scalers_H50.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2 --H 50 --split test --features state_tauhat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:22:14.606076: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:22:14.632548: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-essnr0mj because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:22:15.681140: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:15.686129: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:15.687014: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:15.688806: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:15.689602: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:15.690460: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:15.771783: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:15.772718: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:15.773485: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:15.774270: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8587 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:22:16.086717: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.313912e-02  RMSE=2.704425e-01
  per-joint RMSE: 0.2639 0.4566 0.2058 0.1516 0.2800 0.1301
Residual LSTM:  MSE=3.638285e-02      RMSE=1.907429e-01
  per-joint RMSE: 0.1500 0.3356 0.1662 0.1548 0.1477 0.0988
Combined torque MSE=3.638285e-02     RMSE=1.907429e-01
  per-joint RMSE: 0.1500 0.3356 0.1662 0.1548 0.1477 0.0988
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/metrics_test_H50.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H50.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H50_ep120_b64_u128_do0p2/torque_rmse_time_test_H50.png


#######################################
### CONFIG: feat=state_tauhat H=100 ###
#######################################

##################################################
### BUILD LSTM WINDOWS H=100 feat=state_tauhat ###
##################################################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 100 --features state_tauhat' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 100
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=100, n_dof=6, feature_dim=18
X_train: (33616, 100, 18)  Y_train: (33616, 6)
X_test : (5005, 100, 18)  Y_test : (5005, 6)
feature_mode=state_tauhat


###############################
### TRAIN LSTM seed=0 H=100 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:22:18.621295: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:22:18.647825: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-gf_r3i5_ because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (33616, 100, 18), Y_train = (33616, 6)
  X_test  = (5005, 100, 18),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:22:20.262725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:20.268046: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:20.269007: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:20.270915: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:20.271991: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:20.272854: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:20.371624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:20.372626: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:20.373428: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:22:20.374439: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8544 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:22:21.503495: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 4s - 8ms/step - loss: 0.0953 - val_loss: 0.1099
Epoch 2/120
473/473 - 2s - 5ms/step - loss: 0.0472 - val_loss: 0.1042
Epoch 3/120
473/473 - 2s - 5ms/step - loss: 0.0385 - val_loss: 0.1043
Epoch 4/120
473/473 - 2s - 5ms/step - loss: 0.0345 - val_loss: 0.1009
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0327 - val_loss: 0.1117
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0314 - val_loss: 0.1095
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0296 - val_loss: 0.1068
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0288 - val_loss: 0.1035
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0289 - val_loss: 0.1011
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0276 - val_loss: 0.0998
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0270 - val_loss: 0.1020
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0267 - val_loss: 0.0976
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0262 - val_loss: 0.1007
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0260 - val_loss: 0.1053
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0258 - val_loss: 0.1009
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0254 - val_loss: 0.1019
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0250 - val_loss: 0.1053
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0248 - val_loss: 0.0955
Epoch 19/120
473/473 - 2s - 4ms/step - loss: 0.0249 - val_loss: 0.0981
Epoch 20/120
473/473 - 2s - 4ms/step - loss: 0.0240 - val_loss: 0.0932
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0238 - val_loss: 0.0959
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.0977
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0233 - val_loss: 0.1037
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0231 - val_loss: 0.0969
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0229 - val_loss: 0.1034
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0227 - val_loss: 0.1083
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.1015
Epoch 28/120
473/473 - 2s - 5ms/step - loss: 0.0225 - val_loss: 0.1074
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.0973
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.1073
Epoch 31/120
473/473 - 2s - 5ms/step - loss: 0.0222 - val_loss: 0.1081
Epoch 32/120
473/473 - 2s - 5ms/step - loss: 0.0219 - val_loss: 0.1029
Epoch 33/120
473/473 - 2s - 4ms/step - loss: 0.0217 - val_loss: 0.0991
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.1063
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0216 - val_loss: 0.1028
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.0212 - val_loss: 0.1000
Epoch 37/120
473/473 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.0960
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.1020
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.0974
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.1045
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1719
Per-joint RMSE: 0.1086 0.2987 0.1362 0.1255 0.1884 0.0804
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=100 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state_tauhat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:23:47.713017: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:23:47.739310: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-dd9_ck17 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:23:48.811089: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:48.816072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:48.816982: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:48.818834: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:48.819736: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:48.820591: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:48.906429: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:48.907343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:48.908353: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:48.909195: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8603 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:23:49.214341: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=2.954003e-02      RMSE=1.718721e-01
  per-joint RMSE: 0.1086 0.2987 0.1362 0.1255 0.1884 0.0804
Combined torque MSE=2.954003e-02     RMSE=1.718721e-01
  per-joint RMSE: 0.1086 0.2987 0.1362 0.1255 0.1884 0.0804
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=1 H=100 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:23:51.250498: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:23:51.276176: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-7yn221su because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (33616, 100, 18), Y_train = (33616, 6)
  X_test  = (5005, 100, 18),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:23:52.810836: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:52.815912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:52.816709: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:52.818636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:52.819419: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:52.820152: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:52.902384: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:52.903583: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:52.904448: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:23:52.905236: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8591 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:23:54.016844: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 4s - 7ms/step - loss: 0.0995 - val_loss: 0.1068
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0478 - val_loss: 0.1104
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0394 - val_loss: 0.1020
Epoch 4/120
473/473 - 2s - 4ms/step - loss: 0.0349 - val_loss: 0.1176
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0336 - val_loss: 0.1227
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0310 - val_loss: 0.1125
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0298 - val_loss: 0.1093
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0292 - val_loss: 0.1064
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0283 - val_loss: 0.1134
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0280 - val_loss: 0.1090
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0275 - val_loss: 0.1036
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0269 - val_loss: 0.1026
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0262 - val_loss: 0.1080
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0262 - val_loss: 0.1010
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0254 - val_loss: 0.1000
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0252 - val_loss: 0.1024
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0258 - val_loss: 0.1015
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0250 - val_loss: 0.1065
Epoch 19/120
473/473 - 2s - 5ms/step - loss: 0.0246 - val_loss: 0.0974
Epoch 20/120
473/473 - 2s - 5ms/step - loss: 0.0239 - val_loss: 0.0979
Epoch 21/120
473/473 - 2s - 5ms/step - loss: 0.0241 - val_loss: 0.0985
Epoch 22/120
473/473 - 2s - 4ms/step - loss: 0.0242 - val_loss: 0.1007
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.0998
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0238 - val_loss: 0.1042
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0231 - val_loss: 0.0974
Epoch 26/120
473/473 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.1036
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0228 - val_loss: 0.0979
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0227 - val_loss: 0.1017
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.1138
Epoch 30/120
473/473 - 2s - 5ms/step - loss: 0.0223 - val_loss: 0.1024
Epoch 31/120
473/473 - 2s - 5ms/step - loss: 0.0232 - val_loss: 0.0981
Epoch 32/120
473/473 - 2s - 5ms/step - loss: 0.0221 - val_loss: 0.0954
Epoch 33/120
473/473 - 2s - 5ms/step - loss: 0.0216 - val_loss: 0.1019
Epoch 34/120
473/473 - 2s - 5ms/step - loss: 0.0224 - val_loss: 0.0957
Epoch 35/120
473/473 - 2s - 5ms/step - loss: 0.0217 - val_loss: 0.0944
Epoch 36/120
473/473 - 2s - 5ms/step - loss: 0.0215 - val_loss: 0.0981
Epoch 37/120
473/473 - 2s - 4ms/step - loss: 0.0213 - val_loss: 0.0978
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.0948
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.0976
Epoch 40/120
473/473 - 2s - 5ms/step - loss: 0.0208 - val_loss: 0.0953
Epoch 41/120
473/473 - 2s - 5ms/step - loss: 0.0209 - val_loss: 0.1071
Epoch 42/120
473/473 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.1022
Epoch 43/120
473/473 - 2s - 4ms/step - loss: 0.0206 - val_loss: 0.0986
Epoch 44/120
473/473 - 2s - 4ms/step - loss: 0.0206 - val_loss: 0.0993
Epoch 45/120
473/473 - 2s - 4ms/step - loss: 0.0204 - val_loss: 0.1024
Epoch 46/120
473/473 - 2s - 5ms/step - loss: 0.0202 - val_loss: 0.1015
Epoch 47/120
473/473 - 2s - 4ms/step - loss: 0.0200 - val_loss: 0.1043
Epoch 48/120
473/473 - 2s - 4ms/step - loss: 0.0201 - val_loss: 0.1069
Epoch 49/120
473/473 - 2s - 4ms/step - loss: 0.0202 - val_loss: 0.1053
Epoch 50/120
473/473 - 2s - 4ms/step - loss: 0.0197 - val_loss: 0.1073
Epoch 51/120
473/473 - 2s - 4ms/step - loss: 0.0198 - val_loss: 0.1033
Epoch 52/120
473/473 - 2s - 4ms/step - loss: 0.0197 - val_loss: 0.1086
Epoch 53/120
473/473 - 2s - 4ms/step - loss: 0.0195 - val_loss: 0.1038
Epoch 54/120
473/473 - 2s - 4ms/step - loss: 0.0196 - val_loss: 0.1005
Epoch 55/120
473/473 - 2s - 4ms/step - loss: 0.0195 - val_loss: 0.1037
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1659
Per-joint RMSE: 0.1102 0.2976 0.1229 0.0912 0.1903 0.0696
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=100 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state_tauhat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:25:52.625982: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:25:52.652165: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-anmzde9h because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:25:53.681643: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:53.686717: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:53.687529: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:53.689313: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:53.690099: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:53.690830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:53.778384: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:53.779220: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:53.779961: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:53.780750: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8565 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:25:54.085778: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=2.753244e-02      RMSE=1.659290e-01
  per-joint RMSE: 0.1102 0.2976 0.1229 0.0912 0.1903 0.0696
Combined torque MSE=2.753244e-02     RMSE=1.659290e-01
  per-joint RMSE: 0.1102 0.2976 0.1229 0.0912 0.1903 0.0696
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


###############################
### TRAIN LSTM seed=2 H=100 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:25:56.052821: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:25:56.078593: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-zu6hcr60 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H100__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 100
  din = 18
 dout = 6
  X_train = (33616, 100, 18), Y_train = (33616, 6)
  X_test  = (5005, 100, 18),  Y_test  = (5005, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/scalers_H100.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:25:57.612080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:57.617091: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:57.617900: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:57.619571: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:57.620357: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:57.621095: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:57.701656: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:57.702567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:57.703453: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:25:57.704235: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8564 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 100, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 100, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:25:58.817395: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
473/473 - 4s - 7ms/step - loss: 0.0971 - val_loss: 0.1156
Epoch 2/120
473/473 - 2s - 4ms/step - loss: 0.0474 - val_loss: 0.1265
Epoch 3/120
473/473 - 2s - 4ms/step - loss: 0.0396 - val_loss: 0.1222
Epoch 4/120
473/473 - 2s - 5ms/step - loss: 0.0350 - val_loss: 0.1091
Epoch 5/120
473/473 - 2s - 4ms/step - loss: 0.0329 - val_loss: 0.1070
Epoch 6/120
473/473 - 2s - 4ms/step - loss: 0.0311 - val_loss: 0.1063
Epoch 7/120
473/473 - 2s - 4ms/step - loss: 0.0295 - val_loss: 0.1069
Epoch 8/120
473/473 - 2s - 4ms/step - loss: 0.0297 - val_loss: 0.1115
Epoch 9/120
473/473 - 2s - 4ms/step - loss: 0.0280 - val_loss: 0.0951
Epoch 10/120
473/473 - 2s - 4ms/step - loss: 0.0277 - val_loss: 0.0938
Epoch 11/120
473/473 - 2s - 4ms/step - loss: 0.0270 - val_loss: 0.0948
Epoch 12/120
473/473 - 2s - 4ms/step - loss: 0.0266 - val_loss: 0.0991
Epoch 13/120
473/473 - 2s - 4ms/step - loss: 0.0263 - val_loss: 0.0898
Epoch 14/120
473/473 - 2s - 4ms/step - loss: 0.0259 - val_loss: 0.0941
Epoch 15/120
473/473 - 2s - 4ms/step - loss: 0.0250 - val_loss: 0.0878
Epoch 16/120
473/473 - 2s - 4ms/step - loss: 0.0253 - val_loss: 0.0896
Epoch 17/120
473/473 - 2s - 4ms/step - loss: 0.0250 - val_loss: 0.0886
Epoch 18/120
473/473 - 2s - 4ms/step - loss: 0.0246 - val_loss: 0.0930
Epoch 19/120
473/473 - 2s - 5ms/step - loss: 0.0239 - val_loss: 0.0875
Epoch 20/120
473/473 - 2s - 5ms/step - loss: 0.0241 - val_loss: 0.0919
Epoch 21/120
473/473 - 2s - 4ms/step - loss: 0.0237 - val_loss: 0.0894
Epoch 22/120
473/473 - 2s - 5ms/step - loss: 0.0236 - val_loss: 0.0874
Epoch 23/120
473/473 - 2s - 4ms/step - loss: 0.0235 - val_loss: 0.0951
Epoch 24/120
473/473 - 2s - 4ms/step - loss: 0.0234 - val_loss: 0.0924
Epoch 25/120
473/473 - 2s - 4ms/step - loss: 0.0228 - val_loss: 0.0997
Epoch 26/120
473/473 - 2s - 5ms/step - loss: 0.0228 - val_loss: 0.0992
Epoch 27/120
473/473 - 2s - 4ms/step - loss: 0.0227 - val_loss: 0.0931
Epoch 28/120
473/473 - 2s - 4ms/step - loss: 0.0226 - val_loss: 0.0929
Epoch 29/120
473/473 - 2s - 4ms/step - loss: 0.0224 - val_loss: 0.1045
Epoch 30/120
473/473 - 2s - 4ms/step - loss: 0.0222 - val_loss: 0.0891
Epoch 31/120
473/473 - 2s - 4ms/step - loss: 0.0219 - val_loss: 0.1043
Epoch 32/120
473/473 - 2s - 4ms/step - loss: 0.0218 - val_loss: 0.0969
Epoch 33/120
473/473 - 2s - 5ms/step - loss: 0.0218 - val_loss: 0.1020
Epoch 34/120
473/473 - 2s - 4ms/step - loss: 0.0217 - val_loss: 0.1013
Epoch 35/120
473/473 - 2s - 4ms/step - loss: 0.0212 - val_loss: 0.0978
Epoch 36/120
473/473 - 2s - 4ms/step - loss: 0.0211 - val_loss: 0.0966
Epoch 37/120
473/473 - 2s - 4ms/step - loss: 0.0215 - val_loss: 0.1030
Epoch 38/120
473/473 - 2s - 4ms/step - loss: 0.0212 - val_loss: 0.0911
Epoch 39/120
473/473 - 2s - 4ms/step - loss: 0.0209 - val_loss: 0.0945
Epoch 40/120
473/473 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.1015
Epoch 41/120
473/473 - 2s - 4ms/step - loss: 0.0208 - val_loss: 0.0994
Epoch 42/120
473/473 - 2s - 4ms/step - loss: 0.0204 - val_loss: 0.0963
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_train_test_H100.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1824
Per-joint RMSE: 0.1207 0.3091 0.1796 0.1378 0.1677 0.1007
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=2 H=100 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/scalers_H100.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2 --H 100 --split test --features state_tauhat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:27:29.510985: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:27:29.537608: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-8u84zu16 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 100
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:27:30.558942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:30.564352: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:30.565572: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:30.567354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:30.568161: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:30.568901: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:30.652074: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:30.652922: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:30.653681: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:30.654426: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8604 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:27:30.966161: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.344536e-02  RMSE=2.710080e-01
  per-joint RMSE: 0.2573 0.4647 0.1988 0.1478 0.2840 0.1285
Residual LSTM:  MSE=3.327571e-02      RMSE=1.824163e-01
  per-joint RMSE: 0.1207 0.3091 0.1796 0.1378 0.1677 0.1007
Combined torque MSE=3.327571e-02     RMSE=1.824163e-01
  per-joint RMSE: 0.1207 0.3091 0.1796 0.1378 0.1677 0.1007
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_test_H100.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/metrics_test_H100.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/combined_predictions_test_H100.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H100.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H100_ep120_b64_u128_do0p2/torque_rmse_time_test_H100.png


#######################################
### CONFIG: feat=state_tauhat H=150 ###
#######################################

##################################################
### BUILD LSTM WINDOWS H=150 feat=state_tauhat ###
##################################################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --H 150 --features state_tauhat' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  out_npz     = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
  H           = 150
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
Saved: /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.json
H=150, n_dof=6, feature_dim=18
X_train: (32666, 150, 18)  Y_train: (32666, 6)
X_test : (4755, 150, 18)  Y_test : (4755, 6)
feature_mode=state_tauhat


###############################
### TRAIN LSTM seed=0 H=150 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 0 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:27:33.511654: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:27:33.536972: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-6kiahp_f because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 18
 dout = 6
  X_train = (32666, 150, 18), Y_train = (32666, 6)
  X_test  = (4755, 150, 18),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:27:35.269956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:35.275275: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:35.277670: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:35.280044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:35.281050: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:35.281980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:35.372707: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:35.373598: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:35.374401: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:27:35.375190: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8591 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:27:36.581180: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.0952 - val_loss: 0.0976
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.0486 - val_loss: 0.1123
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.0404 - val_loss: 0.1067
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.0358 - val_loss: 0.1082
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.0336 - val_loss: 0.0989
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.0313 - val_loss: 0.1107
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.0333 - val_loss: 0.1127
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.0308 - val_loss: 0.1110
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.0288 - val_loss: 0.1063
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.0281 - val_loss: 0.1056
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.0274 - val_loss: 0.1074
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.0272 - val_loss: 0.1074
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.0264 - val_loss: 0.1103
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.0260 - val_loss: 0.1089
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.0261 - val_loss: 0.1066
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.0256 - val_loss: 0.1099
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.0252 - val_loss: 0.1168
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.0248 - val_loss: 0.1113
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.0246 - val_loss: 0.1064
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.0245 - val_loss: 0.1043
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.0248 - val_loss: 0.1001
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.0238 - val_loss: 0.1010
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.0240 - val_loss: 0.0937
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.0234 - val_loss: 0.1036
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.0242 - val_loss: 0.0981
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.0233 - val_loss: 0.1102
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.0229 - val_loss: 0.1012
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.0227 - val_loss: 0.0970
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.0223 - val_loss: 0.0965
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.0222 - val_loss: 0.1044
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.0223 - val_loss: 0.1019
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.0224 - val_loss: 0.0982
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.0218 - val_loss: 0.1066
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.0217 - val_loss: 0.0992
Epoch 35/120
460/460 - 3s - 6ms/step - loss: 0.0215 - val_loss: 0.1093
Epoch 36/120
460/460 - 3s - 6ms/step - loss: 0.0215 - val_loss: 0.1039
Epoch 37/120
460/460 - 3s - 6ms/step - loss: 0.0215 - val_loss: 0.1098
Epoch 38/120
460/460 - 3s - 6ms/step - loss: 0.0215 - val_loss: 0.1025
Epoch 39/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.0958
Epoch 40/120
460/460 - 3s - 6ms/step - loss: 0.0211 - val_loss: 0.1030
Epoch 41/120
460/460 - 3s - 6ms/step - loss: 0.0217 - val_loss: 0.0971
Epoch 42/120
460/460 - 3s - 6ms/step - loss: 0.0208 - val_loss: 0.0983
Epoch 43/120
460/460 - 3s - 6ms/step - loss: 0.0206 - val_loss: 0.0992
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1802
Per-joint RMSE: 0.1183 0.3364 0.1411 0.1135 0.1664 0.0853
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=0 H=150 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2 --H 150 --split test --features state_tauhat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 0 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:29:38.679284: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:29:38.705171: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-s3pxf36g because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:29:39.753913: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:39.758908: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:39.759782: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:39.761597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:39.762392: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:39.763139: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:39.840201: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:39.841131: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:39.841889: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:39.842702: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8591 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:29:40.144985: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=3.248473e-02      RMSE=1.802352e-01
  per-joint RMSE: 0.1183 0.3364 0.1411 0.1135 0.1664 0.0853
Combined torque MSE=3.248473e-02     RMSE=1.802352e-01
  per-joint RMSE: 0.1183 0.3364 0.1411 0.1135 0.1664 0.0853
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s0_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


###############################
### TRAIN LSTM seed=1 H=150 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 1 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:29:42.187373: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:29:42.213898: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-rb9pjd9a because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 18
 dout = 6
  X_train = (32666, 150, 18), Y_train = (32666, 6)
  X_test  = (4755, 150, 18),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:29:43.992579: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:43.998051: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:43.999235: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:44.001051: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:44.001978: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:44.002848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:44.091750: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:44.092748: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:44.093543: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:29:44.094324: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8403 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:29:45.271640: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.0969 - val_loss: 0.1244
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.0487 - val_loss: 0.1396
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.0394 - val_loss: 0.1308
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.0370 - val_loss: 0.1197
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.0330 - val_loss: 0.1386
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.0317 - val_loss: 0.1173
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.0299 - val_loss: 0.1291
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.0295 - val_loss: 0.1088
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.0282 - val_loss: 0.1196
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.0278 - val_loss: 0.1148
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.0272 - val_loss: 0.1162
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.0267 - val_loss: 0.1119
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.0263 - val_loss: 0.1120
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.0257 - val_loss: 0.1070
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.0254 - val_loss: 0.1071
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.0254 - val_loss: 0.1105
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.0247 - val_loss: 0.1144
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.0253 - val_loss: 0.1042
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.0240 - val_loss: 0.1119
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.0244 - val_loss: 0.1263
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.0239 - val_loss: 0.1132
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.0233 - val_loss: 0.1148
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.0231 - val_loss: 0.1097
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.0233 - val_loss: 0.1004
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.0233 - val_loss: 0.1000
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.0229 - val_loss: 0.1170
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.0228 - val_loss: 0.1198
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.0226 - val_loss: 0.1064
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.0221 - val_loss: 0.1092
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.0220 - val_loss: 0.1022
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.0219 - val_loss: 0.1000
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.0220 - val_loss: 0.1103
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.0217 - val_loss: 0.1087
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.0215 - val_loss: 0.1134
Epoch 35/120
460/460 - 3s - 6ms/step - loss: 0.0214 - val_loss: 0.1106
Epoch 36/120
460/460 - 3s - 6ms/step - loss: 0.0222 - val_loss: 0.1149
Epoch 37/120
460/460 - 3s - 6ms/step - loss: 0.0216 - val_loss: 0.1167
Epoch 38/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.1147
Epoch 39/120
460/460 - 3s - 6ms/step - loss: 0.0208 - val_loss: 0.1099
Epoch 40/120
460/460 - 3s - 6ms/step - loss: 0.0207 - val_loss: 0.1090
Epoch 41/120
460/460 - 3s - 6ms/step - loss: 0.0207 - val_loss: 0.1146
Epoch 42/120
460/460 - 3s - 6ms/step - loss: 0.0205 - val_loss: 0.1139
Epoch 43/120
460/460 - 3s - 6ms/step - loss: 0.0204 - val_loss: 0.1228
Epoch 44/120
460/460 - 3s - 6ms/step - loss: 0.0205 - val_loss: 0.1197
Epoch 45/120
460/460 - 3s - 6ms/step - loss: 0.0201 - val_loss: 0.1244
Epoch 46/120
460/460 - 3s - 6ms/step - loss: 0.0200 - val_loss: 0.1200
Epoch 47/120
460/460 - 3s - 6ms/step - loss: 0.0200 - val_loss: 0.1167
Epoch 48/120
460/460 - 3s - 6ms/step - loss: 0.0197 - val_loss: 0.1153
Epoch 49/120
460/460 - 3s - 6ms/step - loss: 0.0198 - val_loss: 0.1121
Epoch 50/120
460/460 - 3s - 6ms/step - loss: 0.0199 - val_loss: 0.1132
Epoch 51/120
460/460 - 3s - 6ms/step - loss: 0.0198 - val_loss: 0.1131
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1899
Per-joint RMSE: 0.1447 0.3218 0.1448 0.1530 0.2027 0.0799
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=1 H=150 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2 --H 150 --split test --features state_tauhat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 1 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:32:07.214706: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:32:07.242019: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-baxec0ow because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:32:08.294639: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:08.299474: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:08.300273: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:08.301907: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:08.302700: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:08.303534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:08.384479: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:08.385321: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:08.386157: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:08.386969: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8678 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:32:08.698708: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=3.605609e-02      RMSE=1.898844e-01
  per-joint RMSE: 0.1447 0.3218 0.1448 0.1530 0.2027 0.0799
Combined torque MSE=3.605609e-02     RMSE=1.898844e-01
  per-joint RMSE: 0.1447 0.3218 0.1448 0.1530 0.2027 0.0799
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s1_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png


###############################
### TRAIN LSTM seed=2 H=150 ###
###############################

==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --out_dir /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2 --model_name residual_lstm.keras --epochs 120 --batch 64 --val_split 0.1 --seed 2 --units 128 --dropout 0.2 --eps 1e-08 --early_stop True --early_stop_patience 20 --early_stop_min_delta 0.0 --early_stop_warmup_evals 10 ' ===
==========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:32:10.697022: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:32:10.724018: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
mkdir -p failed for path /.config/matplotlib: [Errno 13] Permission denied: '/.config'
Matplotlib created a temporary cache directory at /tmp/matplotlib-uj05fia2 because there was an issue with the default path (/.config/matplotlib); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__lstm_windows_H150__feat_state_tauhat__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
   H  = 150
  din = 18
 dout = 6
  X_train = (32666, 150, 18), Y_train = (32666, 6)
  X_test  = (4755, 150, 18),  Y_test  = (4755, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/scalers_H150.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-30 21:32:12.483750: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:12.488902: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:12.489824: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:12.491690: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:12.492596: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:12.493335: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:12.583769: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:12.584660: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:12.585458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:32:12.586243: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8684 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 150, 128)       │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 150, 128)       │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/120
2026-01-30 21:32:13.826319: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
460/460 - 4s - 9ms/step - loss: 0.0947 - val_loss: 0.1043
Epoch 2/120
460/460 - 3s - 6ms/step - loss: 0.0487 - val_loss: 0.0936
Epoch 3/120
460/460 - 3s - 6ms/step - loss: 0.0405 - val_loss: 0.0867
Epoch 4/120
460/460 - 3s - 6ms/step - loss: 0.0355 - val_loss: 0.0855
Epoch 5/120
460/460 - 3s - 6ms/step - loss: 0.0338 - val_loss: 0.0910
Epoch 6/120
460/460 - 3s - 6ms/step - loss: 0.0322 - val_loss: 0.0983
Epoch 7/120
460/460 - 3s - 6ms/step - loss: 0.0311 - val_loss: 0.1103
Epoch 8/120
460/460 - 3s - 6ms/step - loss: 0.0295 - val_loss: 0.0951
Epoch 9/120
460/460 - 3s - 6ms/step - loss: 0.0286 - val_loss: 0.0998
Epoch 10/120
460/460 - 3s - 6ms/step - loss: 0.0278 - val_loss: 0.0962
Epoch 11/120
460/460 - 3s - 6ms/step - loss: 0.0281 - val_loss: 0.0918
Epoch 12/120
460/460 - 3s - 6ms/step - loss: 0.0269 - val_loss: 0.1230
Epoch 13/120
460/460 - 3s - 6ms/step - loss: 0.0282 - val_loss: 0.0965
Epoch 14/120
460/460 - 3s - 6ms/step - loss: 0.0271 - val_loss: 0.0884
Epoch 15/120
460/460 - 3s - 6ms/step - loss: 0.0259 - val_loss: 0.0925
Epoch 16/120
460/460 - 3s - 6ms/step - loss: 0.0256 - val_loss: 0.0870
Epoch 17/120
460/460 - 3s - 6ms/step - loss: 0.0254 - val_loss: 0.0854
Epoch 18/120
460/460 - 3s - 6ms/step - loss: 0.0247 - val_loss: 0.0831
Epoch 19/120
460/460 - 3s - 6ms/step - loss: 0.0246 - val_loss: 0.0899
Epoch 20/120
460/460 - 3s - 6ms/step - loss: 0.0247 - val_loss: 0.0819
Epoch 21/120
460/460 - 3s - 6ms/step - loss: 0.0243 - val_loss: 0.0856
Epoch 22/120
460/460 - 3s - 6ms/step - loss: 0.0236 - val_loss: 0.0742
Epoch 23/120
460/460 - 3s - 6ms/step - loss: 0.0236 - val_loss: 0.0798
Epoch 24/120
460/460 - 3s - 6ms/step - loss: 0.0232 - val_loss: 0.0806
Epoch 25/120
460/460 - 3s - 6ms/step - loss: 0.0231 - val_loss: 0.0790
Epoch 26/120
460/460 - 3s - 6ms/step - loss: 0.0229 - val_loss: 0.0818
Epoch 27/120
460/460 - 3s - 6ms/step - loss: 0.0230 - val_loss: 0.0813
Epoch 28/120
460/460 - 3s - 6ms/step - loss: 0.0231 - val_loss: 0.0800
Epoch 29/120
460/460 - 3s - 6ms/step - loss: 0.0226 - val_loss: 0.0776
Epoch 30/120
460/460 - 3s - 6ms/step - loss: 0.0222 - val_loss: 0.0796
Epoch 31/120
460/460 - 3s - 6ms/step - loss: 0.0219 - val_loss: 0.0792
Epoch 32/120
460/460 - 3s - 6ms/step - loss: 0.0221 - val_loss: 0.0819
Epoch 33/120
460/460 - 3s - 6ms/step - loss: 0.0219 - val_loss: 0.0870
Epoch 34/120
460/460 - 3s - 6ms/step - loss: 0.0215 - val_loss: 0.0924
Epoch 35/120
460/460 - 3s - 6ms/step - loss: 0.0216 - val_loss: 0.0836
Epoch 36/120
460/460 - 3s - 6ms/step - loss: 0.0214 - val_loss: 0.0860
Epoch 37/120
460/460 - 3s - 6ms/step - loss: 0.0213 - val_loss: 0.0849
Epoch 38/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.0826
Epoch 39/120
460/460 - 3s - 6ms/step - loss: 0.0210 - val_loss: 0.0815
Epoch 40/120
460/460 - 3s - 6ms/step - loss: 0.0209 - val_loss: 0.0829
Epoch 41/120
460/460 - 3s - 6ms/step - loss: 0.0206 - val_loss: 0.0896
Epoch 42/120
460/460 - 3s - 6ms/step - loss: 0.0206 - val_loss: 0.0948
Saved metrics JSON: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_train_test_H150.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.1806
Per-joint RMSE: 0.1290 0.3317 0.1254 0.1263 0.1780 0.0756
################################################

Saved predictions: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/loss_curve.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_rmse_per_joint.png
Saved: /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_rmse_time.png


##################################
### COMBINED EVAL seed=2 H=150 ###
##################################

========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz --model /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras --scalers /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/scalers_H150.npz --out_dir /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2 --H 150 --split test --features state_tauhat --save_pred_npz --metrics_csv /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv --metrics_json /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl --K 84 --test_fraction 0.2 --seed 2 --dataset_seed 0 --delan_seed 2 --delan_epochs 200 --hp_preset lutter_like_256_d3 --delan_rmse_val 0.22930417577243173 --delan_rmse_test 0.2697645090247436' ===
========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-30 21:34:12.496169: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-30 21:34:12.522237: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/workspace/shared/.mplconfig is not a writable directory
Matplotlib created a temporary cache directory at /tmp/matplotlib-j0bjrq89 because there was an issue with the default path (/workspace/shared/.mplconfig); it is highly recommended to set the MPLCONFIGDIR environment variable to a writable directory, in particular to speed up the import of Matplotlib and to better support multiprocessing.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3/UR3_Load0_5x10^4_under__best5x10L0__K84__residual__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3.npz
 model        = /workspace/shared/models/lstm/best/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_lstm.keras
 split        = test
 H            = 150
 n_traj       = 5
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-30 21:34:13.569257: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:34:13.574453: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:34:13.576799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:34:13.578867: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:34:13.579810: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:34:13.580596: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:34:13.665872: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:34:13.666771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:34:13.667521: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-30 21:34:13.668342: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8702 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-30 21:34:13.978539: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 5/5

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.220215e-02  RMSE=2.687046e-01
  per-joint RMSE: 0.2469 0.4637 0.1948 0.1472 0.2870 0.1235
Residual LSTM:  MSE=3.262103e-02      RMSE=1.806129e-01
  per-joint RMSE: 0.1290 0.3317 0.1254 0.1263 0.1780 0.0756
Combined torque MSE=3.262103e-02     RMSE=1.806129e-01
  per-joint RMSE: 0.1290 0.3317 0.1254 0.1263 0.1780 0.0756
################################################

Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_test_H150.txt
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/metrics_test_H150.json
Appended CSV: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.csv
Appended JSON: /workspace/shared/evaluation/summary_lstm_best_combined_20260130_213442.jsonl
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/combined_predictions_test_H150.npz
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/residual_gt_vs_pred_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_gt_vs_delan_vs_combined_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_rmse_per_joint_grouped_test_H150.png
Saved: /workspace/shared/evaluation/lstm_best/UR3_Load0_5x10^4_under__best5x10L0__20260130_213442/UR3_Load0_5x10^4_under__best5x10L0__K84__d0__delan_jax_struct_s2_ep200_hp_lutter_like_256_d3_actsoftplus_b1024_lr1e-4_wd1e-5_w256_d3__feat_state_tauhat__lstm_best_s2_H150_ep120_b64_u128_do0p2/torque_rmse_time_test_H150.png

