#################################################################################################################
### RUN: K=100 test_fraction=0.3 seed=1                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz ###
#################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 100 --test_fraction 0.3 --seed 1 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
Trajectories: train=70 test=30
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 300 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 300, 'lagrangian_type': <function structured_lagrangian_fn at 0x7bb7f096c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
   dt ≈ 0.026799889944760784
  dof = 6
  Train trajectories = 70
  Test trajectories  = 30
  Train samples = 34301
  Test samples  = 13048
################################################

2026-01-22 07:40:54.837393: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300 | type=structured | dof=6
################################################
2026-01-22 07:40:57.990717: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:40:57.990753: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:40:57.990760: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:40:57.990790: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:40:57.990795: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:40:57.990811: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:40:57.990850: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:40:57.990856: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:40:57.990872: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:40:57.990878: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.2s, Loss=1.14e+01, Inv=1.14e+01, For=1.56e+02, Power=2.92e+00
  [eval] test_mse=2.801e+00  (n=13048)
Epoch 00050: Time=  11.6s, Loss=2.28e+00, Inv=2.28e+00, For=8.04e+01, Power=1.37e+00
Epoch 00100: Time=  16.0s, Loss=2.11e+00, Inv=2.11e+00, For=8.97e+01, Power=1.29e+00
Epoch 00150: Time=  20.6s, Loss=2.03e+00, Inv=2.03e+00, For=1.10e+02, Power=1.28e+00
Epoch 00200: Time=  25.4s, Loss=1.98e+00, Inv=1.98e+00, For=1.35e+02, Power=1.26e+00
  [eval] test_mse=2.534e+00  (n=13048)
Epoch 00250: Time=  29.8s, Loss=1.95e+00, Inv=1.95e+00, For=1.51e+02, Power=1.25e+00
Epoch 00300: Time=  34.1s, Loss=1.93e+00, Inv=1.93e+00, For=1.67e+02, Power=1.24e+00
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300
Torque MSE  = 4.760e-01
Torque RMSE = 6.899e-01
Per-joint MSE : 5.276e-01 5.988e-01 3.150e-01 1.844e-01 6.212e-01 6.088e-01
Per-joint RMSE: 7.264e-01 7.738e-01 5.613e-01 4.294e-01 7.881e-01 7.802e-01
Comp Time per Sample = 2.057e-08s / 48617450.3Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep300.jax
Detected n_dof=6 (seed=0)
2026-01-22 07:41:34.192613: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 70 trajectories
2026-01-22 07:41:35.506374: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:41:35.506386: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:41:37.101359: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:41:38.237089: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:41:38.237103: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:41:39.700807: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:41:39.700842: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:41:39.700847: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/70
  done 50/70
2026-01-22 07:41:41.196115: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 70/70

Exporting split=test: 30 trajectories
  done 25/30
  done 30/30

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=24
X_train: (33358, 25, 24)  Y_train: (33358, 6)
X_test : (12664, 25, 24)  Y_test : (12664, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:41:43.355669: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:41:43.379944: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (33358, 25, 24), Y_train = (33358, 6)
  X_test  = (12664, 25, 24),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:41:44.477887: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:44.483032: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:44.484052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:44.485867: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:44.486789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:44.487597: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:44.584602: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:44.585490: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:44.586383: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:44.587273: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8962 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:41:45.566006: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 16ms/step - loss: 0.2480 - val_loss: 0.3659
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.1417 - val_loss: 0.3606
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.1247 - val_loss: 0.3557
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1156 - val_loss: 0.3530
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1092 - val_loss: 0.3488
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1047 - val_loss: 0.3447
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1007 - val_loss: 0.3419
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.0967 - val_loss: 0.3339
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.0941 - val_loss: 0.3296
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.0914 - val_loss: 0.3283
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.0895 - val_loss: 0.3320
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.0883 - val_loss: 0.3307
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.0861 - val_loss: 0.3302
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.0848 - val_loss: 0.3211
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.0837 - val_loss: 0.3138
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0820 - val_loss: 0.3134
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0811 - val_loss: 0.3174
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0795 - val_loss: 0.3134
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0783 - val_loss: 0.3049
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0771 - val_loss: 0.3031
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0769 - val_loss: 0.3033
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0755 - val_loss: 0.3061
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0751 - val_loss: 0.3021
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0746 - val_loss: 0.3016
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.0732 - val_loss: 0.2996
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.0727 - val_loss: 0.3032
Epoch 27/80
105/105 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.3008
Epoch 28/80
105/105 - 0s - 3ms/step - loss: 0.0719 - val_loss: 0.2969
Epoch 29/80
105/105 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.3023
Epoch 30/80
105/105 - 0s - 3ms/step - loss: 0.0705 - val_loss: 0.3007
Epoch 31/80
105/105 - 0s - 3ms/step - loss: 0.0699 - val_loss: 0.2959
Epoch 32/80
105/105 - 0s - 3ms/step - loss: 0.0702 - val_loss: 0.2976
Epoch 33/80
105/105 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.2973
Epoch 34/80
105/105 - 0s - 3ms/step - loss: 0.0684 - val_loss: 0.3003
Epoch 35/80
105/105 - 0s - 3ms/step - loss: 0.0684 - val_loss: 0.3017
Epoch 36/80
105/105 - 0s - 3ms/step - loss: 0.0676 - val_loss: 0.3047
Epoch 37/80
105/105 - 0s - 3ms/step - loss: 0.0678 - val_loss: 0.3035
Epoch 38/80
105/105 - 0s - 3ms/step - loss: 0.0667 - val_loss: 0.2991
Epoch 39/80
105/105 - 0s - 3ms/step - loss: 0.0665 - val_loss: 0.3068
Epoch 40/80
105/105 - 0s - 3ms/step - loss: 0.0654 - val_loss: 0.3028
Epoch 41/80
105/105 - 0s - 3ms/step - loss: 0.0655 - val_loss: 0.3002
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5907
Per-joint RMSE: 0.5809 0.5887 0.4552 0.3775 0.7241 0.7317
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:41:59.077050: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:41:59.101889: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:41:59.959017: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:59.963698: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:59.964488: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:59.966396: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:59.967190: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:41:59.967925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:00.046000: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:00.046830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:00.047585: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:00.048316: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:42:00.342201: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.772196e-01  RMSE=6.908109e-01
  per-joint RMSE: 0.7288 0.7751 0.5598 0.4333 0.7936 0.7749
Residual LSTM:  MSE=3.488918e-01      RMSE=5.906706e-01
  per-joint RMSE: 0.5809 0.5887 0.4552 0.3775 0.7241 0.7317
Combined torque MSE=3.488918e-01     RMSE=5.906706e-01
  per-joint RMSE: 0.5809 0.5887 0.4552 0.3775 0.7241 0.7317
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=6
X_train: (33358, 25, 6)  Y_train: (33358, 6)
X_test : (12664, 25, 6)  Y_test : (12664, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:42:02.499207: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:42:02.523003: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (33358, 25, 6), Y_train = (33358, 6)
  X_test  = (12664, 25, 6),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:42:03.506134: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:03.510592: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:03.511406: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:03.513077: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:03.513865: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:03.514606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:03.595238: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:03.596080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:03.596815: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:03.597556: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:42:04.491393: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 15ms/step - loss: 0.4870 - val_loss: 1.3953
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.2809 - val_loss: 1.1912
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.2199 - val_loss: 1.1415
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1883 - val_loss: 1.1346
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1622 - val_loss: 1.1521
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1461 - val_loss: 1.1930
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1339 - val_loss: 1.1651
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.1268 - val_loss: 1.1555
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.1207 - val_loss: 1.1831
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.1141 - val_loss: 1.1375
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.1137 - val_loss: 1.1377
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.1082 - val_loss: 1.1402
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.1036 - val_loss: 1.1422
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.1031 - val_loss: 1.2373
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6371
Per-joint RMSE: 0.6599 0.6594 0.5361 0.3893 0.7496 0.7513
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:42:10.100802: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:42:10.125511: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:42:10.983391: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:10.988341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:10.989161: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:10.990926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:10.991722: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:10.992458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:11.074004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:11.075823: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:11.076664: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:11.077443: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:42:11.368515: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.772196e-01  RMSE=6.908109e-01
  per-joint RMSE: 0.7288 0.7751 0.5598 0.4333 0.7936 0.7749
Residual LSTM:  MSE=4.059295e-01      RMSE=6.371260e-01
  per-joint RMSE: 0.6599 0.6594 0.5361 0.3893 0.7496 0.7513
Combined torque MSE=4.059295e-01     RMSE=6.371260e-01
  per-joint RMSE: 0.6599 0.6594 0.5361 0.3893 0.7496 0.7513
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33358, 25, 18)  Y_train: (33358, 6)
X_test : (12664, 25, 18)  Y_test : (12664, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:42:13.591413: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:42:13.615325: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33358, 25, 18), Y_train = (33358, 6)
  X_test  = (12664, 25, 18),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:42:14.670244: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:14.674994: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:14.675790: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:14.677584: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:14.678371: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:14.679105: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:14.758826: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:14.759673: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:14.760486: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:14.761302: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:42:15.726595: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 16ms/step - loss: 0.2859 - val_loss: 0.3787
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.1607 - val_loss: 0.3649
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.1411 - val_loss: 0.3510
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1298 - val_loss: 0.3523
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1215 - val_loss: 0.3417
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1158 - val_loss: 0.3415
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1111 - val_loss: 0.3383
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.1075 - val_loss: 0.3302
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.1029 - val_loss: 0.3240
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.1001 - val_loss: 0.3230
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.0968 - val_loss: 0.3199
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.0960 - val_loss: 0.3143
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.0927 - val_loss: 0.3204
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.0910 - val_loss: 0.3113
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.0900 - val_loss: 0.3154
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0879 - val_loss: 0.3159
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0868 - val_loss: 0.3125
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0849 - val_loss: 0.3079
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0856 - val_loss: 0.3120
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0837 - val_loss: 0.3126
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0827 - val_loss: 0.3110
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0819 - val_loss: 0.3145
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0837 - val_loss: 0.3065
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0797 - val_loss: 0.3059
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.0797 - val_loss: 0.3094
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.0779 - val_loss: 0.3014
Epoch 27/80
105/105 - 0s - 3ms/step - loss: 0.0779 - val_loss: 0.3090
Epoch 28/80
105/105 - 0s - 3ms/step - loss: 0.0762 - val_loss: 0.3020
Epoch 29/80
105/105 - 0s - 3ms/step - loss: 0.0758 - val_loss: 0.3061
Epoch 30/80
105/105 - 0s - 3ms/step - loss: 0.0760 - val_loss: 0.3095
Epoch 31/80
105/105 - 0s - 3ms/step - loss: 0.0755 - val_loss: 0.3052
Epoch 32/80
105/105 - 0s - 3ms/step - loss: 0.0741 - val_loss: 0.3097
Epoch 33/80
105/105 - 0s - 3ms/step - loss: 0.0742 - val_loss: 0.3040
Epoch 34/80
105/105 - 0s - 3ms/step - loss: 0.0730 - val_loss: 0.2995
Epoch 35/80
105/105 - 0s - 3ms/step - loss: 0.0721 - val_loss: 0.3072
Epoch 36/80
105/105 - 0s - 3ms/step - loss: 0.0729 - val_loss: 0.3019
Epoch 37/80
105/105 - 0s - 3ms/step - loss: 0.0730 - val_loss: 0.3024
Epoch 38/80
105/105 - 0s - 3ms/step - loss: 0.0723 - val_loss: 0.3063
Epoch 39/80
105/105 - 0s - 3ms/step - loss: 0.0726 - val_loss: 0.3083
Epoch 40/80
105/105 - 0s - 3ms/step - loss: 0.0716 - val_loss: 0.3013
Epoch 41/80
105/105 - 0s - 3ms/step - loss: 0.0704 - val_loss: 0.3006
Epoch 42/80
105/105 - 0s - 3ms/step - loss: 0.0702 - val_loss: 0.3074
Epoch 43/80
105/105 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.3034
Epoch 44/80
105/105 - 0s - 3ms/step - loss: 0.0702 - val_loss: 0.3009
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6310
Per-joint RMSE: 0.6323 0.6562 0.4849 0.3620 0.7836 0.7606
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:42:30.025043: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:42:30.050467: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:42:30.902683: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:30.907381: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:30.908172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:30.909810: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:30.910609: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:30.911334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:30.992188: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:30.993128: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:30.993902: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:30.994740: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:42:31.286759: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.772196e-01  RMSE=6.908109e-01
  per-joint RMSE: 0.7288 0.7751 0.5598 0.4333 0.7936 0.7749
Residual LSTM:  MSE=3.981831e-01      RMSE=6.310175e-01
  per-joint RMSE: 0.6323 0.6562 0.4849 0.3620 0.7836 0.7606
Combined torque MSE=3.981831e-01     RMSE=6.310175e-01
  per-joint RMSE: 0.6323 0.6562 0.4849 0.3620 0.7836 0.7606
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33358, 25, 18)  Y_train: (33358, 6)
X_test : (12664, 25, 18)  Y_test : (12664, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:42:33.525062: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:42:33.549030: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33358, 25, 18), Y_train = (33358, 6)
  X_test  = (12664, 25, 18),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:42:34.617719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:34.622298: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:34.623100: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:34.624762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:34.625558: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:34.626301: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:34.706634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:34.707472: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:34.708222: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:34.708955: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:42:35.665309: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 16ms/step - loss: 0.2503 - val_loss: 0.3634
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.1441 - val_loss: 0.3555
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.1268 - val_loss: 0.3442
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1176 - val_loss: 0.3400
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1112 - val_loss: 0.3396
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1061 - val_loss: 0.3298
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1014 - val_loss: 0.3245
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.0982 - val_loss: 0.3199
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.0949 - val_loss: 0.3228
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.0924 - val_loss: 0.3185
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.0898 - val_loss: 0.3166
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.0887 - val_loss: 0.3087
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.0867 - val_loss: 0.3073
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.0857 - val_loss: 0.3111
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.0839 - val_loss: 0.3076
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0822 - val_loss: 0.3033
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0811 - val_loss: 0.3078
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0802 - val_loss: 0.3006
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0794 - val_loss: 0.3025
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.3026
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0774 - val_loss: 0.2992
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0768 - val_loss: 0.2966
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0755 - val_loss: 0.2969
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0745 - val_loss: 0.3020
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.0740 - val_loss: 0.3013
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.0734 - val_loss: 0.2981
Epoch 27/80
105/105 - 0s - 3ms/step - loss: 0.0726 - val_loss: 0.2954
Epoch 28/80
105/105 - 0s - 3ms/step - loss: 0.0721 - val_loss: 0.2980
Epoch 29/80
105/105 - 0s - 3ms/step - loss: 0.0714 - val_loss: 0.2948
Epoch 30/80
105/105 - 0s - 3ms/step - loss: 0.0711 - val_loss: 0.2960
Epoch 31/80
105/105 - 0s - 3ms/step - loss: 0.0701 - val_loss: 0.2971
Epoch 32/80
105/105 - 0s - 3ms/step - loss: 0.0696 - val_loss: 0.2957
Epoch 33/80
105/105 - 0s - 3ms/step - loss: 0.0700 - val_loss: 0.2997
Epoch 34/80
105/105 - 0s - 3ms/step - loss: 0.0686 - val_loss: 0.2987
Epoch 35/80
105/105 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.2964
Epoch 36/80
105/105 - 0s - 3ms/step - loss: 0.0683 - val_loss: 0.2959
Epoch 37/80
105/105 - 0s - 3ms/step - loss: 0.0679 - val_loss: 0.2963
Epoch 38/80
105/105 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.2947
Epoch 39/80
105/105 - 0s - 3ms/step - loss: 0.0670 - val_loss: 0.2988
Epoch 40/80
105/105 - 0s - 3ms/step - loss: 0.0664 - val_loss: 0.2943
Epoch 41/80
105/105 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.2914
Epoch 42/80
105/105 - 0s - 3ms/step - loss: 0.0653 - val_loss: 0.2957
Epoch 43/80
105/105 - 0s - 3ms/step - loss: 0.0655 - val_loss: 0.2916
Epoch 44/80
105/105 - 0s - 3ms/step - loss: 0.0647 - val_loss: 0.2949
Epoch 45/80
105/105 - 0s - 3ms/step - loss: 0.0641 - val_loss: 0.2929
Epoch 46/80
105/105 - 0s - 3ms/step - loss: 0.0638 - val_loss: 0.2970
Epoch 47/80
105/105 - 0s - 3ms/step - loss: 0.0639 - val_loss: 0.2970
Epoch 48/80
105/105 - 0s - 3ms/step - loss: 0.0637 - val_loss: 0.2969
Epoch 49/80
105/105 - 0s - 3ms/step - loss: 0.0633 - val_loss: 0.2945
Epoch 50/80
105/105 - 0s - 3ms/step - loss: 0.0628 - val_loss: 0.2974
Epoch 51/80
105/105 - 0s - 3ms/step - loss: 0.0634 - val_loss: 0.2961
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6112
Per-joint RMSE: 0.6093 0.6492 0.4923 0.3730 0.7291 0.7316
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:42:51.968050: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:42:51.992178: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:42:52.843563: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:52.848217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:52.849006: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:52.850771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:52.851565: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:52.852305: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:52.929371: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:52.930207: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:52.930949: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:52.931738: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:42:53.223257: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.772196e-01  RMSE=6.908109e-01
  per-joint RMSE: 0.7288 0.7751 0.5598 0.4333 0.7936 0.7749
Residual LSTM:  MSE=3.735222e-01      RMSE=6.111646e-01
  per-joint RMSE: 0.6093 0.6492 0.4923 0.3730 0.7291 0.7316
Combined torque MSE=3.735222e-01     RMSE=6.111646e-01
  per-joint RMSE: 0.6093 0.6492 0.4923 0.3730 0.7291 0.7316
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=24
X_train: (32483, 50, 24)  Y_train: (32483, 6)
X_test : (12314, 50, 24)  Y_test : (12314, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:42:55.588703: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:42:55.612778: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (32483, 50, 24), Y_train = (32483, 6)
  X_test  = (12314, 50, 24),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:42:56.860316: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:56.865197: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:56.866110: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:56.867954: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:56.868855: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:56.869712: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:56.961786: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:56.962686: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:56.963497: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:42:56.964284: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:42:57.987177: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 18ms/step - loss: 0.2495 - val_loss: 0.3651
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1435 - val_loss: 0.3521
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1277 - val_loss: 0.3520
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1182 - val_loss: 0.3521
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1123 - val_loss: 0.3544
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1074 - val_loss: 0.3494
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1036 - val_loss: 0.3446
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1001 - val_loss: 0.3411
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0969 - val_loss: 0.3402
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0945 - val_loss: 0.3332
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0918 - val_loss: 0.3269
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0907 - val_loss: 0.3266
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0893 - val_loss: 0.3221
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0868 - val_loss: 0.3174
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0855 - val_loss: 0.3226
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0841 - val_loss: 0.3154
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0829 - val_loss: 0.3095
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0814 - val_loss: 0.3111
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0798 - val_loss: 0.3108
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0792 - val_loss: 0.3141
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0783 - val_loss: 0.3124
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0771 - val_loss: 0.3095
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0763 - val_loss: 0.3086
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0758 - val_loss: 0.3048
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0751 - val_loss: 0.3086
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0741 - val_loss: 0.3074
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0732 - val_loss: 0.3098
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0731 - val_loss: 0.3045
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0723 - val_loss: 0.3084
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0717 - val_loss: 0.3047
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0711 - val_loss: 0.3053
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0705 - val_loss: 0.3017
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0696 - val_loss: 0.3027
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0696 - val_loss: 0.3048
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0687 - val_loss: 0.3014
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0687 - val_loss: 0.3035
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0681 - val_loss: 0.3056
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0680 - val_loss: 0.3047
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0677 - val_loss: 0.3113
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0670 - val_loss: 0.3064
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0662 - val_loss: 0.3020
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0661 - val_loss: 0.3089
Epoch 43/80
102/102 - 0s - 4ms/step - loss: 0.0660 - val_loss: 0.3074
Epoch 44/80
102/102 - 0s - 4ms/step - loss: 0.0651 - val_loss: 0.3125
Epoch 45/80
102/102 - 0s - 4ms/step - loss: 0.0651 - val_loss: 0.3127
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5954
Per-joint RMSE: 0.5992 0.6173 0.4627 0.3692 0.7220 0.7178
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:43:18.427077: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:43:18.451345: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:43:19.310251: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:19.314968: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:19.315769: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:19.317501: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:19.318304: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:19.319040: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:19.399861: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:19.400763: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:19.401565: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:19.402370: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:43:19.697644: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.697846e-01  RMSE=6.854083e-01
  per-joint RMSE: 0.7237 0.7789 0.5520 0.4252 0.7842 0.7667
Residual LSTM:  MSE=3.544789e-01      RMSE=5.953813e-01
  per-joint RMSE: 0.5992 0.6173 0.4627 0.3692 0.7220 0.7178
Combined torque MSE=3.544789e-01     RMSE=5.953813e-01
  per-joint RMSE: 0.5992 0.6173 0.4627 0.3692 0.7220 0.7178
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=6
X_train: (32483, 50, 6)  Y_train: (32483, 6)
X_test : (12314, 50, 6)  Y_test : (12314, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:43:21.920710: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:43:21.945468: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (32483, 50, 6), Y_train = (32483, 6)
  X_test  = (12314, 50, 6),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:43:22.996971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:23.001616: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:23.002414: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:23.004009: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:23.007167: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:23.008020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:23.089666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:23.090526: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:23.091338: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:23.092149: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:43:24.016855: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.4548 - val_loss: 1.2851
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.2357 - val_loss: 1.0483
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1760 - val_loss: 1.0379
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1632 - val_loss: 0.9956
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1403 - val_loss: 0.9950
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1313 - val_loss: 1.0220
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1241 - val_loss: 0.9972
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1198 - val_loss: 1.0133
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1153 - val_loss: 0.9992
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1134 - val_loss: 1.0391
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1093 - val_loss: 1.0290
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.1079 - val_loss: 1.0147
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.1062 - val_loss: 1.0417
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.1064 - val_loss: 1.0154
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.1057 - val_loss: 1.0524
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6447
Per-joint RMSE: 0.6855 0.6743 0.5264 0.3929 0.7586 0.7501
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:43:31.779902: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:43:31.804635: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:43:32.658293: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:32.663040: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:32.663833: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:32.665553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:32.666350: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:32.667089: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:32.755044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:32.755984: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:32.756738: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:32.757475: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:43:33.048839: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.697846e-01  RMSE=6.854083e-01
  per-joint RMSE: 0.7237 0.7789 0.5520 0.4252 0.7842 0.7667
Residual LSTM:  MSE=4.156874e-01      RMSE=6.447383e-01
  per-joint RMSE: 0.6855 0.6743 0.5264 0.3929 0.7586 0.7501
Combined torque MSE=4.156874e-01     RMSE=6.447383e-01
  per-joint RMSE: 0.6855 0.6743 0.5264 0.3929 0.7586 0.7501
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32483, 50, 18)  Y_train: (32483, 6)
X_test : (12314, 50, 18)  Y_test : (12314, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:43:35.389609: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:43:35.413442: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32483, 50, 18), Y_train = (32483, 6)
  X_test  = (12314, 50, 18),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:43:36.597553: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:36.602589: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:36.603500: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:36.605465: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:36.606390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:36.607248: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:36.693676: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:36.694566: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:36.695563: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:36.696408: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:43:37.644852: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2853 - val_loss: 0.3741
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1649 - val_loss: 0.3666
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1486 - val_loss: 0.3588
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1372 - val_loss: 0.3608
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1288 - val_loss: 0.3556
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1214 - val_loss: 0.3533
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1167 - val_loss: 0.3507
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1111 - val_loss: 0.3446
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1093 - val_loss: 0.3433
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1046 - val_loss: 0.3361
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1017 - val_loss: 0.3325
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0996 - val_loss: 0.3350
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0970 - val_loss: 0.3353
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0950 - val_loss: 0.3318
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0934 - val_loss: 0.3268
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0916 - val_loss: 0.3364
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0894 - val_loss: 0.3356
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0885 - val_loss: 0.3256
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0872 - val_loss: 0.3237
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0853 - val_loss: 0.3189
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0844 - val_loss: 0.3272
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0835 - val_loss: 0.3218
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0823 - val_loss: 0.3189
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0819 - val_loss: 0.3147
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0807 - val_loss: 0.3151
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0795 - val_loss: 0.3167
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0793 - val_loss: 0.3164
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0780 - val_loss: 0.3150
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0777 - val_loss: 0.3130
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0771 - val_loss: 0.3175
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0764 - val_loss: 0.3147
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0754 - val_loss: 0.3089
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0757 - val_loss: 0.3126
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0749 - val_loss: 0.3153
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0743 - val_loss: 0.3097
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0732 - val_loss: 0.3162
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0734 - val_loss: 0.3429
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0726 - val_loss: 0.3133
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0724 - val_loss: 0.3144
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0715 - val_loss: 0.3169
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0709 - val_loss: 0.3181
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0709 - val_loss: 0.3181
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6210
Per-joint RMSE: 0.6375 0.6520 0.4774 0.3536 0.7523 0.7506
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:43:56.581203: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:43:56.606361: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:43:57.462748: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:57.467405: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:57.468197: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:57.469971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:57.470848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:57.471596: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:57.546454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:57.547295: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:57.548044: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:43:57.548777: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:43:57.846382: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.697846e-01  RMSE=6.854083e-01
  per-joint RMSE: 0.7237 0.7789 0.5520 0.4252 0.7842 0.7667
Residual LSTM:  MSE=3.856475e-01      RMSE=6.210052e-01
  per-joint RMSE: 0.6375 0.6520 0.4774 0.3536 0.7523 0.7506
Combined torque MSE=3.856475e-01     RMSE=6.210052e-01
  per-joint RMSE: 0.6375 0.6520 0.4774 0.3536 0.7523 0.7506
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32483, 50, 18)  Y_train: (32483, 6)
X_test : (12314, 50, 18)  Y_test : (12314, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:44:00.196604: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:44:00.220419: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32483, 50, 18), Y_train = (32483, 6)
  X_test  = (12314, 50, 18),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:44:01.421024: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:01.425870: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:01.426781: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:01.428599: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:01.429505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:01.430366: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:01.516892: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:01.517794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:01.518621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:01.519471: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:44:02.489375: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2490 - val_loss: 0.3611
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1447 - val_loss: 0.3483
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1299 - val_loss: 0.3441
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1209 - val_loss: 0.3440
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1145 - val_loss: 0.3398
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1094 - val_loss: 0.3381
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1052 - val_loss: 0.3319
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1018 - val_loss: 0.3249
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0987 - val_loss: 0.3225
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0957 - val_loss: 0.3244
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0930 - val_loss: 0.3149
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0913 - val_loss: 0.3154
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0894 - val_loss: 0.3170
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0877 - val_loss: 0.3175
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0867 - val_loss: 0.3160
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0845 - val_loss: 0.3179
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0838 - val_loss: 0.3205
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0825 - val_loss: 0.3181
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0814 - val_loss: 0.3197
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0800 - val_loss: 0.3157
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0794 - val_loss: 0.3159
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.6090
Per-joint RMSE: 0.5771 0.6609 0.5122 0.3574 0.7362 0.7237
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:44:12.864845: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:44:12.889058: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s0_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:44:13.772980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:13.777719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:13.778513: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:13.780345: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:13.781217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:13.781961: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:13.863799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:13.864725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:13.865567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:44:13.866368: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:44:14.166375: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.697846e-01  RMSE=6.854083e-01
  per-joint RMSE: 0.7237 0.7789 0.5520 0.4252 0.7842 0.7667
Residual LSTM:  MSE=3.709410e-01      RMSE=6.090493e-01
  per-joint RMSE: 0.5771 0.6609 0.5122 0.3574 0.7362 0.7237
Combined torque MSE=3.709410e-01     RMSE=6.090493e-01
  per-joint RMSE: 0.5771 0.6609 0.5122 0.3574 0.7362 0.7237
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s0_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 300 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 300, 'lagrangian_type': <function structured_lagrangian_fn at 0x791f0e4b41f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
   dt ≈ 0.026799889944760784
  dof = 6
  Train trajectories = 70
  Test trajectories  = 30
  Train samples = 34301
  Test samples  = 13048
################################################

2026-01-22 07:44:18.694820: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300 | type=structured | dof=6
################################################
2026-01-22 07:44:21.837682: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:21.837718: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:21.837724: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:21.837752: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:21.837757: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:21.837772: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:21.837809: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:21.837815: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:21.837830: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:21.837835: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.55e+01, Inv=1.55e+01, For=1.61e+02, Power=3.55e+00
  [eval] test_mse=1.866e+00  (n=13048)
Epoch 00050: Time=  10.8s, Loss=2.34e+00, Inv=2.34e+00, For=7.17e+01, Power=1.37e+00
Epoch 00100: Time=  15.1s, Loss=2.13e+00, Inv=2.13e+00, For=8.53e+01, Power=1.29e+00
Epoch 00150: Time=  19.2s, Loss=2.04e+00, Inv=2.04e+00, For=9.55e+01, Power=1.28e+00
Epoch 00200: Time=  23.5s, Loss=1.99e+00, Inv=1.99e+00, For=1.08e+02, Power=1.25e+00
  [eval] test_mse=2.218e+00  (n=13048)
Epoch 00250: Time=  27.8s, Loss=1.96e+00, Inv=1.96e+00, For=1.17e+02, Power=1.24e+00
Epoch 00300: Time=  32.0s, Loss=1.93e+00, Inv=1.93e+00, For=1.25e+02, Power=1.23e+00
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300
Torque MSE  = 4.046e-01
Torque RMSE = 6.361e-01
Per-joint MSE : 5.886e-01 3.826e-01 4.006e-01 2.389e-01 1.385e-01 6.785e-01
Per-joint RMSE: 7.672e-01 6.185e-01 6.329e-01 4.888e-01 3.721e-01 8.237e-01
Comp Time per Sample = 2.017e-08s / 49570512.7Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep300.jax
Detected n_dof=6 (seed=1)
2026-01-22 07:44:55.943022: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 70 trajectories
2026-01-22 07:44:57.251765: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:57.251777: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:44:58.887771: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:45:00.092623: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:45:00.092638: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:45:01.550732: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:45:01.550765: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:45:01.550771: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/70
  done 50/70
2026-01-22 07:45:03.202070: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 70/70

Exporting split=test: 30 trajectories
  done 25/30
  done 30/30

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=24
X_train: (33358, 25, 24)  Y_train: (33358, 6)
X_test : (12664, 25, 24)  Y_test : (12664, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:45:05.365443: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:45:05.389804: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (33358, 25, 24), Y_train = (33358, 6)
  X_test  = (12664, 25, 24),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:45:06.467924: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:06.472895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:06.473827: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:06.475590: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:06.476523: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:06.477388: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:06.566970: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:06.567852: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:06.568656: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:06.569470: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8962 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:45:07.542513: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 16ms/step - loss: 0.2467 - val_loss: 0.3868
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.1413 - val_loss: 0.3787
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.1235 - val_loss: 0.3743
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1139 - val_loss: 0.3642
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1086 - val_loss: 0.3641
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1019 - val_loss: 0.3588
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.0992 - val_loss: 0.3566
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.0959 - val_loss: 0.3526
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.0927 - val_loss: 0.3401
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.0909 - val_loss: 0.3383
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.0877 - val_loss: 0.3420
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.0874 - val_loss: 0.3344
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.0851 - val_loss: 0.3413
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.0835 - val_loss: 0.3343
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.0822 - val_loss: 0.3328
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0811 - val_loss: 0.3317
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0800 - val_loss: 0.3297
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0783 - val_loss: 0.3227
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.3283
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0766 - val_loss: 0.3197
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0762 - val_loss: 0.3231
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0757 - val_loss: 0.3153
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0750 - val_loss: 0.3126
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0737 - val_loss: 0.3126
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.0727 - val_loss: 0.3110
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.0725 - val_loss: 0.3113
Epoch 27/80
105/105 - 0s - 3ms/step - loss: 0.0725 - val_loss: 0.3184
Epoch 28/80
105/105 - 0s - 3ms/step - loss: 0.0717 - val_loss: 0.3106
Epoch 29/80
105/105 - 0s - 3ms/step - loss: 0.0709 - val_loss: 0.3123
Epoch 30/80
105/105 - 0s - 3ms/step - loss: 0.0706 - val_loss: 0.3127
Epoch 31/80
105/105 - 0s - 3ms/step - loss: 0.0699 - val_loss: 0.3186
Epoch 32/80
105/105 - 0s - 3ms/step - loss: 0.0696 - val_loss: 0.3053
Epoch 33/80
105/105 - 0s - 3ms/step - loss: 0.0690 - val_loss: 0.3130
Epoch 34/80
105/105 - 0s - 3ms/step - loss: 0.0681 - val_loss: 0.3103
Epoch 35/80
105/105 - 0s - 3ms/step - loss: 0.0687 - val_loss: 0.3142
Epoch 36/80
105/105 - 0s - 3ms/step - loss: 0.0676 - val_loss: 0.3102
Epoch 37/80
105/105 - 0s - 3ms/step - loss: 0.0672 - val_loss: 0.3094
Epoch 38/80
105/105 - 0s - 3ms/step - loss: 0.0672 - val_loss: 0.3116
Epoch 39/80
105/105 - 0s - 3ms/step - loss: 0.0663 - val_loss: 0.3027
Epoch 40/80
105/105 - 0s - 3ms/step - loss: 0.0666 - val_loss: 0.3080
Epoch 41/80
105/105 - 0s - 3ms/step - loss: 0.0653 - val_loss: 0.3155
Epoch 42/80
105/105 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.3085
Epoch 43/80
105/105 - 0s - 3ms/step - loss: 0.0655 - val_loss: 0.3043
Epoch 44/80
105/105 - 0s - 3ms/step - loss: 0.0643 - val_loss: 0.3040
Epoch 45/80
105/105 - 0s - 3ms/step - loss: 0.0646 - val_loss: 0.3114
Epoch 46/80
105/105 - 0s - 3ms/step - loss: 0.0646 - val_loss: 0.3024
Epoch 47/80
105/105 - 0s - 3ms/step - loss: 0.0639 - val_loss: 0.3110
Epoch 48/80
105/105 - 0s - 3ms/step - loss: 0.0631 - val_loss: 0.3048
Epoch 49/80
105/105 - 0s - 3ms/step - loss: 0.0630 - val_loss: 0.3083
Epoch 50/80
105/105 - 0s - 3ms/step - loss: 0.0625 - val_loss: 0.3076
Epoch 51/80
105/105 - 0s - 3ms/step - loss: 0.0624 - val_loss: 0.3015
Epoch 52/80
105/105 - 0s - 3ms/step - loss: 0.0616 - val_loss: 0.3076
Epoch 53/80
105/105 - 0s - 3ms/step - loss: 0.0611 - val_loss: 0.3021
Epoch 54/80
105/105 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.3120
Epoch 55/80
105/105 - 0s - 3ms/step - loss: 0.0607 - val_loss: 0.3072
Epoch 56/80
105/105 - 0s - 3ms/step - loss: 0.0610 - val_loss: 0.3047
Epoch 57/80
105/105 - 0s - 3ms/step - loss: 0.0608 - val_loss: 0.3106
Epoch 58/80
105/105 - 0s - 3ms/step - loss: 0.0609 - val_loss: 0.3061
Epoch 59/80
105/105 - 0s - 3ms/step - loss: 0.0604 - val_loss: 0.3068
Epoch 60/80
105/105 - 0s - 3ms/step - loss: 0.0594 - val_loss: 0.3129
Epoch 61/80
105/105 - 0s - 3ms/step - loss: 0.0598 - val_loss: 0.3152
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5239
Per-joint RMSE: 0.6207 0.3709 0.5338 0.4075 0.3091 0.7598
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:45:26.712782: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:45:26.738076: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:45:27.608606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:27.613421: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:27.614212: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:27.616166: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:27.616958: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:27.617698: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:27.698900: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:27.699734: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:27.700469: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:27.701196: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:45:27.994683: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.025480e-01  RMSE=6.344667e-01
  per-joint RMSE: 0.7683 0.6108 0.6356 0.4908 0.3761 0.8158
Residual LSTM:  MSE=2.744494e-01      RMSE=5.238792e-01
  per-joint RMSE: 0.6207 0.3709 0.5338 0.4075 0.3091 0.7598
Combined torque MSE=2.744494e-01     RMSE=5.238792e-01
  per-joint RMSE: 0.6207 0.3709 0.5338 0.4075 0.3091 0.7598
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=6
X_train: (33358, 25, 6)  Y_train: (33358, 6)
X_test : (12664, 25, 6)  Y_test : (12664, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:45:30.155119: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:45:30.179401: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (33358, 25, 6), Y_train = (33358, 6)
  X_test  = (12664, 25, 6),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:45:31.162026: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:31.166794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:31.167663: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:31.169322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:31.170101: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:31.170837: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:31.248621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:31.249468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:31.250301: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:31.251043: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:45:32.172366: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 15ms/step - loss: 0.4791 - val_loss: 1.3521
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.2810 - val_loss: 1.1288
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.2236 - val_loss: 1.0867
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1902 - val_loss: 1.0921
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1637 - val_loss: 1.0790
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1478 - val_loss: 1.0864
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1385 - val_loss: 1.0814
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.1317 - val_loss: 1.0593
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.1283 - val_loss: 1.0839
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.1194 - val_loss: 1.0631
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.1156 - val_loss: 1.0715
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.1139 - val_loss: 1.0418
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.1128 - val_loss: 1.0635
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.1053 - val_loss: 1.0323
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.1044 - val_loss: 1.0438
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.1022 - val_loss: 1.0154
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0992 - val_loss: 1.0437
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0990 - val_loss: 1.0283
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0949 - val_loss: 1.0454
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0939 - val_loss: 1.0293
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0941 - val_loss: 1.0306
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0942 - val_loss: 1.0191
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0947 - val_loss: 1.0333
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0948 - val_loss: 1.0670
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.1073 - val_loss: 1.0746
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.1024 - val_loss: 1.0464
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5912
Per-joint RMSE: 0.7377 0.4988 0.5744 0.4670 0.3533 0.7945
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:45:41.143951: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:45:41.168509: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:45:42.033671: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:42.038303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:42.039247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:42.040956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:42.041840: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:42.042650: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:42.127608: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:42.128444: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:42.129195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:42.129924: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:45:42.426098: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.025480e-01  RMSE=6.344667e-01
  per-joint RMSE: 0.7683 0.6108 0.6356 0.4908 0.3761 0.8158
Residual LSTM:  MSE=3.495198e-01      RMSE=5.912020e-01
  per-joint RMSE: 0.7377 0.4988 0.5744 0.4670 0.3533 0.7945
Combined torque MSE=3.495198e-01     RMSE=5.912020e-01
  per-joint RMSE: 0.7377 0.4988 0.5744 0.4670 0.3533 0.7945
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33358, 25, 18)  Y_train: (33358, 6)
X_test : (12664, 25, 18)  Y_test : (12664, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:45:44.674246: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:45:44.697709: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33358, 25, 18), Y_train = (33358, 6)
  X_test  = (12664, 25, 18),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:45:45.758389: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:45.763045: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:45.763923: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:45.765485: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:45.766282: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:45.767118: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:45.848155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:45.849083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:45.849895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:45:45.850629: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:45:46.809974: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 16ms/step - loss: 0.2858 - val_loss: 0.3841
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.1641 - val_loss: 0.3690
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.1439 - val_loss: 0.3676
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1338 - val_loss: 0.3561
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1263 - val_loss: 0.3526
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1196 - val_loss: 0.3476
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1128 - val_loss: 0.3398
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.1096 - val_loss: 0.3385
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.1048 - val_loss: 0.3389
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.1021 - val_loss: 0.3343
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.0986 - val_loss: 0.3308
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.0975 - val_loss: 0.3352
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.0952 - val_loss: 0.3327
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.0912 - val_loss: 0.3316
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.0907 - val_loss: 0.3270
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0889 - val_loss: 0.3292
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0871 - val_loss: 0.3304
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0860 - val_loss: 0.3258
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0889 - val_loss: 0.3276
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0841 - val_loss: 0.3291
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0828 - val_loss: 0.3229
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0814 - val_loss: 0.3258
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0804 - val_loss: 0.3186
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0794 - val_loss: 0.3228
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.0782 - val_loss: 0.3189
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.0780 - val_loss: 0.3178
Epoch 27/80
105/105 - 0s - 3ms/step - loss: 0.0769 - val_loss: 0.3169
Epoch 28/80
105/105 - 0s - 3ms/step - loss: 0.0761 - val_loss: 0.3192
Epoch 29/80
105/105 - 0s - 3ms/step - loss: 0.0754 - val_loss: 0.3267
Epoch 30/80
105/105 - 0s - 3ms/step - loss: 0.0753 - val_loss: 0.3171
Epoch 31/80
105/105 - 0s - 3ms/step - loss: 0.0742 - val_loss: 0.3137
Epoch 32/80
105/105 - 0s - 3ms/step - loss: 0.0732 - val_loss: 0.3210
Epoch 33/80
105/105 - 0s - 3ms/step - loss: 0.0739 - val_loss: 0.3207
Epoch 34/80
105/105 - 0s - 3ms/step - loss: 0.0729 - val_loss: 0.3152
Epoch 35/80
105/105 - 0s - 3ms/step - loss: 0.0734 - val_loss: 0.3164
Epoch 36/80
105/105 - 0s - 3ms/step - loss: 0.0723 - val_loss: 0.3206
Epoch 37/80
105/105 - 0s - 3ms/step - loss: 0.0714 - val_loss: 0.3231
Epoch 38/80
105/105 - 0s - 3ms/step - loss: 0.0711 - val_loss: 0.3184
Epoch 39/80
105/105 - 0s - 3ms/step - loss: 0.0708 - val_loss: 0.3141
Epoch 40/80
105/105 - 0s - 3ms/step - loss: 0.0701 - val_loss: 0.3160
Epoch 41/80
105/105 - 0s - 3ms/step - loss: 0.0701 - val_loss: 0.3169
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5764
Per-joint RMSE: 0.7063 0.4389 0.5840 0.4451 0.3432 0.8030
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:46:00.213620: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:46:00.238766: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:46:01.093126: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:01.097873: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:01.098759: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:01.100385: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:01.101178: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:01.101912: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:01.183771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:01.184614: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:01.185360: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:01.186097: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:46:01.480852: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.025480e-01  RMSE=6.344667e-01
  per-joint RMSE: 0.7683 0.6108 0.6356 0.4908 0.3761 0.8158
Residual LSTM:  MSE=3.322316e-01      RMSE=5.763953e-01
  per-joint RMSE: 0.7063 0.4389 0.5840 0.4451 0.3432 0.8030
Combined torque MSE=3.322316e-01     RMSE=5.763953e-01
  per-joint RMSE: 0.7063 0.4389 0.5840 0.4451 0.3432 0.8030
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33358, 25, 18)  Y_train: (33358, 6)
X_test : (12664, 25, 18)  Y_test : (12664, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:46:03.715632: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:46:03.739523: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33358, 25, 18), Y_train = (33358, 6)
  X_test  = (12664, 25, 18),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:46:04.795054: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:04.799546: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:04.800430: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:04.802062: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:04.802926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:04.803667: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:04.880337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:04.881177: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:04.881925: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:04.882664: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:46:05.824776: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 16ms/step - loss: 0.2541 - val_loss: 0.3556
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.1457 - val_loss: 0.3590
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.1280 - val_loss: 0.3513
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1179 - val_loss: 0.3457
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1111 - val_loss: 0.3375
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1054 - val_loss: 0.3316
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1016 - val_loss: 0.3301
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.0978 - val_loss: 0.3297
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.0951 - val_loss: 0.3318
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.0933 - val_loss: 0.3199
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.0901 - val_loss: 0.3216
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.0883 - val_loss: 0.3246
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.0866 - val_loss: 0.3219
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.0851 - val_loss: 0.3218
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.0842 - val_loss: 0.3213
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0824 - val_loss: 0.3238
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0814 - val_loss: 0.3152
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0805 - val_loss: 0.3179
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0785 - val_loss: 0.3203
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0780 - val_loss: 0.3167
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0763 - val_loss: 0.3200
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0761 - val_loss: 0.3176
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0754 - val_loss: 0.3182
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0738 - val_loss: 0.3184
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.0742 - val_loss: 0.3231
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.0729 - val_loss: 0.3169
Epoch 27/80
105/105 - 0s - 3ms/step - loss: 0.0718 - val_loss: 0.3205
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5332
Per-joint RMSE: 0.6311 0.4508 0.5336 0.3818 0.2902 0.7678
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:46:15.100964: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:46:15.125604: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:46:15.976314: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:15.981142: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:15.982020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:15.983664: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:15.984454: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:15.985288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:16.066527: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:16.067924: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:16.068725: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:16.069458: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8959 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:46:16.364575: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=4.025480e-01  RMSE=6.344667e-01
  per-joint RMSE: 0.7683 0.6108 0.6356 0.4908 0.3761 0.8158
Residual LSTM:  MSE=2.842821e-01      RMSE=5.331811e-01
  per-joint RMSE: 0.6311 0.4508 0.5336 0.3818 0.2902 0.7678
Combined torque MSE=2.842821e-01     RMSE=5.331811e-01
  per-joint RMSE: 0.6311 0.4508 0.5336 0.3818 0.2902 0.7678
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=24
X_train: (32483, 50, 24)  Y_train: (32483, 6)
X_test : (12314, 50, 24)  Y_test : (12314, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:46:18.730859: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:46:18.754778: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (32483, 50, 24), Y_train = (32483, 6)
  X_test  = (12314, 50, 24),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:46:20.053844: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:20.058849: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:20.059765: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:20.061740: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:20.062655: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:20.063505: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:20.159387: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:20.160277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:20.161086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:20.161873: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:46:21.191524: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2550 - val_loss: 0.3801
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1430 - val_loss: 0.3655
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1280 - val_loss: 0.3577
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1186 - val_loss: 0.3499
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1115 - val_loss: 0.3448
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1069 - val_loss: 0.3407
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1027 - val_loss: 0.3376
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.0993 - val_loss: 0.3314
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0959 - val_loss: 0.3297
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0945 - val_loss: 0.3223
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0916 - val_loss: 0.3208
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0899 - val_loss: 0.3181
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0884 - val_loss: 0.3198
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0868 - val_loss: 0.3174
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0857 - val_loss: 0.3134
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0840 - val_loss: 0.3133
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0821 - val_loss: 0.3109
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0821 - val_loss: 0.3128
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0804 - val_loss: 0.3165
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0796 - val_loss: 0.3055
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0788 - val_loss: 0.3066
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0782 - val_loss: 0.3100
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0765 - val_loss: 0.3049
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0761 - val_loss: 0.3110
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0746 - val_loss: 0.3064
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0741 - val_loss: 0.3145
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0739 - val_loss: 0.3074
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0726 - val_loss: 0.3093
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0726 - val_loss: 0.3094
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0719 - val_loss: 0.3104
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0714 - val_loss: 0.3120
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0712 - val_loss: 0.3157
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0703 - val_loss: 0.3113
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5265
Per-joint RMSE: 0.6236 0.3851 0.5205 0.4089 0.3274 0.7619
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:46:36.737464: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:46:36.762152: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:46:37.621666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:37.626380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:37.627332: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:37.629035: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:37.629830: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:37.630567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:37.714222: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:37.715146: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:37.715959: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:37.716679: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:46:38.017312: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.969494e-01  RMSE=6.300392e-01
  per-joint RMSE: 0.7652 0.6088 0.6226 0.4904 0.3778 0.8091
Residual LSTM:  MSE=2.771756e-01      RMSE=5.264747e-01
  per-joint RMSE: 0.6236 0.3851 0.5205 0.4089 0.3274 0.7619
Combined torque MSE=2.771756e-01     RMSE=5.264747e-01
  per-joint RMSE: 0.6236 0.3851 0.5205 0.4089 0.3274 0.7619
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=6
X_train: (32483, 50, 6)  Y_train: (32483, 6)
X_test : (12314, 50, 6)  Y_test : (12314, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:46:40.268694: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:46:40.292983: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (32483, 50, 6), Y_train = (32483, 6)
  X_test  = (12314, 50, 6),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:46:41.337875: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:41.342503: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:41.343293: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:41.344903: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:41.345852: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:41.346595: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:41.426284: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:41.427209: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:41.427955: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:41.428687: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:46:42.350929: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.4670 - val_loss: 1.5022
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.2445 - val_loss: 1.0827
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1855 - val_loss: 1.0515
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1639 - val_loss: 1.0476
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1434 - val_loss: 1.0534
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1356 - val_loss: 1.0171
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1287 - val_loss: 1.0078
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1225 - val_loss: 0.9935
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1229 - val_loss: 0.9876
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1160 - val_loss: 0.9933
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1142 - val_loss: 1.0063
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.1091 - val_loss: 0.9936
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.1078 - val_loss: 0.9946
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.1057 - val_loss: 0.9893
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.1043 - val_loss: 0.9937
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.1036 - val_loss: 0.9812
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.1042 - val_loss: 1.0021
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.1003 - val_loss: 0.9965
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0978 - val_loss: 1.0041
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0989 - val_loss: 1.0130
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0969 - val_loss: 1.0003
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0951 - val_loss: 0.9990
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.1164 - val_loss: 1.0501
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.1217 - val_loss: 1.0279
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.1045 - val_loss: 1.0187
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0957 - val_loss: 1.0114
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5965
Per-joint RMSE: 0.7479 0.4902 0.5765 0.4776 0.3656 0.8007
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:46:54.561348: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:46:54.586503: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:46:55.415490: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:55.420103: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:55.421059: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:55.422732: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:55.423517: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:55.424260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:55.506242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:55.507083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:55.507921: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:55.508660: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:46:55.800157: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.969494e-01  RMSE=6.300392e-01
  per-joint RMSE: 0.7652 0.6088 0.6226 0.4904 0.3778 0.8091
Residual LSTM:  MSE=3.558069e-01      RMSE=5.964955e-01
  per-joint RMSE: 0.7479 0.4902 0.5765 0.4776 0.3656 0.8007
Combined torque MSE=3.558069e-01     RMSE=5.964955e-01
  per-joint RMSE: 0.7479 0.4902 0.5765 0.4776 0.3656 0.8007
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32483, 50, 18)  Y_train: (32483, 6)
X_test : (12314, 50, 18)  Y_test : (12314, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:46:58.130879: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:46:58.154681: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32483, 50, 18), Y_train = (32483, 6)
  X_test  = (12314, 50, 18),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:46:59.338962: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:59.343627: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:59.344549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:59.346315: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:59.347277: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:59.348172: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:59.435341: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:59.436227: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:59.437024: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:46:59.437887: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:47:00.439805: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2855 - val_loss: 0.3779
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1660 - val_loss: 0.3657
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1476 - val_loss: 0.3652
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1375 - val_loss: 0.3528
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1287 - val_loss: 0.3520
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1230 - val_loss: 0.3503
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1164 - val_loss: 0.3461
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1116 - val_loss: 0.3430
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1086 - val_loss: 0.3393
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1037 - val_loss: 0.3331
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1010 - val_loss: 0.3379
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0985 - val_loss: 0.3287
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0962 - val_loss: 0.3258
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0931 - val_loss: 0.3257
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0915 - val_loss: 0.3203
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0897 - val_loss: 0.3230
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0880 - val_loss: 0.3190
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0868 - val_loss: 0.3202
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0856 - val_loss: 0.3164
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0839 - val_loss: 0.3167
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0837 - val_loss: 0.3131
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0825 - val_loss: 0.3161
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0805 - val_loss: 0.3125
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0802 - val_loss: 0.3130
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0797 - val_loss: 0.3151
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0790 - val_loss: 0.3189
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0785 - val_loss: 0.3161
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0784 - val_loss: 0.3167
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0763 - val_loss: 0.3175
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0766 - val_loss: 0.3152
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0758 - val_loss: 0.3211
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0751 - val_loss: 0.3291
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0748 - val_loss: 0.3169
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5700
Per-joint RMSE: 0.6953 0.4577 0.5648 0.4450 0.3536 0.7836
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:47:15.939781: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:47:15.964754: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:47:16.829656: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:16.834312: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:16.835187: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:16.836829: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:16.837620: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:16.838456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:16.921374: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:16.922213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:16.922954: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:16.923685: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:47:17.219060: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.969494e-01  RMSE=6.300392e-01
  per-joint RMSE: 0.7652 0.6088 0.6226 0.4904 0.3778 0.8091
Residual LSTM:  MSE=3.248518e-01      RMSE=5.699577e-01
  per-joint RMSE: 0.6953 0.4577 0.5648 0.4450 0.3536 0.7836
Combined torque MSE=3.248518e-01     RMSE=5.699577e-01
  per-joint RMSE: 0.6953 0.4577 0.5648 0.4450 0.3536 0.7836
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32483, 50, 18)  Y_train: (32483, 6)
X_test : (12314, 50, 18)  Y_test : (12314, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:47:19.541437: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:47:19.565238: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32483, 50, 18), Y_train = (32483, 6)
  X_test  = (12314, 50, 18),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:47:20.757953: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:20.762776: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:20.763682: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:20.765301: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:20.766193: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:20.767050: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:20.855351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:20.856236: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:20.857039: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:20.857829: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:47:21.839113: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2603 - val_loss: 0.3794
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1493 - val_loss: 0.3544
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1314 - val_loss: 0.3517
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1214 - val_loss: 0.3401
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1153 - val_loss: 0.3381
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1099 - val_loss: 0.3379
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1060 - val_loss: 0.3350
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1023 - val_loss: 0.3326
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0991 - val_loss: 0.3328
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0956 - val_loss: 0.3320
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0934 - val_loss: 0.3258
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0915 - val_loss: 0.3274
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0891 - val_loss: 0.3258
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0875 - val_loss: 0.3214
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0864 - val_loss: 0.3198
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0849 - val_loss: 0.3217
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0834 - val_loss: 0.3228
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0816 - val_loss: 0.3229
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0812 - val_loss: 0.3233
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0805 - val_loss: 0.3189
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0791 - val_loss: 0.3165
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0782 - val_loss: 0.3198
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0772 - val_loss: 0.3204
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0769 - val_loss: 0.3164
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0762 - val_loss: 0.3138
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0751 - val_loss: 0.3202
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0743 - val_loss: 0.3131
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0740 - val_loss: 0.3065
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0731 - val_loss: 0.3129
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0724 - val_loss: 0.3105
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0717 - val_loss: 0.3084
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0720 - val_loss: 0.3168
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0710 - val_loss: 0.3049
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0707 - val_loss: 0.3122
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0696 - val_loss: 0.3075
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0697 - val_loss: 0.3070
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0691 - val_loss: 0.3094
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0689 - val_loss: 0.3064
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0686 - val_loss: 0.3092
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0681 - val_loss: 0.3029
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0675 - val_loss: 0.3072
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0676 - val_loss: 0.3101
Epoch 43/80
102/102 - 0s - 4ms/step - loss: 0.0665 - val_loss: 0.3054
Epoch 44/80
102/102 - 0s - 4ms/step - loss: 0.0667 - val_loss: 0.3078
Epoch 45/80
102/102 - 0s - 4ms/step - loss: 0.0662 - val_loss: 0.3054
Epoch 46/80
102/102 - 0s - 4ms/step - loss: 0.0659 - val_loss: 0.3073
Epoch 47/80
102/102 - 0s - 4ms/step - loss: 0.0655 - val_loss: 0.3134
Epoch 48/80
102/102 - 0s - 4ms/step - loss: 0.0655 - val_loss: 0.2999
Epoch 49/80
102/102 - 0s - 4ms/step - loss: 0.0651 - val_loss: 0.3053
Epoch 50/80
102/102 - 0s - 4ms/step - loss: 0.0651 - val_loss: 0.3014
Epoch 51/80
102/102 - 0s - 4ms/step - loss: 0.0642 - val_loss: 0.3060
Epoch 52/80
102/102 - 0s - 4ms/step - loss: 0.0639 - val_loss: 0.3116
Epoch 53/80
102/102 - 0s - 4ms/step - loss: 0.0639 - val_loss: 0.3007
Epoch 54/80
102/102 - 0s - 4ms/step - loss: 0.0643 - val_loss: 0.3095
Epoch 55/80
102/102 - 0s - 4ms/step - loss: 0.0628 - val_loss: 0.3045
Epoch 56/80
102/102 - 0s - 4ms/step - loss: 0.0628 - val_loss: 0.3016
Epoch 57/80
102/102 - 0s - 4ms/step - loss: 0.0630 - val_loss: 0.3053
Epoch 58/80
102/102 - 0s - 4ms/step - loss: 0.0619 - val_loss: 0.2989
Epoch 59/80
102/102 - 0s - 4ms/step - loss: 0.0618 - val_loss: 0.2981
Epoch 60/80
102/102 - 0s - 4ms/step - loss: 0.0622 - val_loss: 0.3059
Epoch 61/80
102/102 - 0s - 4ms/step - loss: 0.0615 - val_loss: 0.3054
Epoch 62/80
102/102 - 0s - 4ms/step - loss: 0.0610 - val_loss: 0.3040
Epoch 63/80
102/102 - 0s - 4ms/step - loss: 0.0607 - val_loss: 0.3031
Epoch 64/80
102/102 - 0s - 4ms/step - loss: 0.0608 - val_loss: 0.3027
Epoch 65/80
102/102 - 0s - 4ms/step - loss: 0.0607 - val_loss: 0.3050
Epoch 66/80
102/102 - 0s - 4ms/step - loss: 0.0604 - val_loss: 0.3029
Epoch 67/80
102/102 - 0s - 4ms/step - loss: 0.0599 - val_loss: 0.3075
Epoch 68/80
102/102 - 0s - 4ms/step - loss: 0.0596 - val_loss: 0.3046
Epoch 69/80
102/102 - 0s - 4ms/step - loss: 0.0599 - val_loss: 0.2952
Epoch 70/80
102/102 - 0s - 4ms/step - loss: 0.0592 - val_loss: 0.3046
Epoch 71/80
102/102 - 0s - 4ms/step - loss: 0.0590 - val_loss: 0.3022
Epoch 72/80
102/102 - 0s - 4ms/step - loss: 0.0586 - val_loss: 0.3059
Epoch 73/80
102/102 - 0s - 4ms/step - loss: 0.0584 - val_loss: 0.3051
Epoch 74/80
102/102 - 0s - 4ms/step - loss: 0.0586 - val_loss: 0.3036
Epoch 75/80
102/102 - 0s - 4ms/step - loss: 0.0579 - val_loss: 0.3076
Epoch 76/80
102/102 - 0s - 4ms/step - loss: 0.0578 - val_loss: 0.3068
Epoch 77/80
102/102 - 0s - 4ms/step - loss: 0.0569 - val_loss: 0.3063
Epoch 78/80
102/102 - 0s - 4ms/step - loss: 0.0570 - val_loss: 0.3023
Epoch 79/80
102/102 - 0s - 4ms/step - loss: 0.0567 - val_loss: 0.3025
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5489
Per-joint RMSE: 0.6354 0.4625 0.5526 0.4238 0.3208 0.7761
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:47:56.381026: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:47:56.405387: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s1_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:47:57.269098: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:57.273766: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:57.274559: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:57.276213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:57.277012: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:57.277836: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:57.364936: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:57.365768: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:57.366516: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:47:57.367249: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:47:57.661177: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.969494e-01  RMSE=6.300392e-01
  per-joint RMSE: 0.7652 0.6088 0.6226 0.4904 0.3778 0.8091
Residual LSTM:  MSE=3.013019e-01      RMSE=5.489097e-01
  per-joint RMSE: 0.6354 0.4625 0.5526 0.4238 0.3208 0.7761
Combined torque MSE=3.013019e-01     RMSE=5.489097e-01
  per-joint RMSE: 0.6354 0.4625 0.5526 0.4238 0.3208 0.7761
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s1_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz                                ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 300 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax' ===
================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 300, 'lagrangian_type': <function structured_lagrangian_fn at 0x734959d0c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
   dt ≈ 0.026799889944760784
  dof = 6
  Train trajectories = 70
  Test trajectories  = 30
  Train samples = 34301
  Test samples  = 13048
################################################

2026-01-22 07:48:02.168903: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300 | type=structured | dof=6
################################################
2026-01-22 07:48:05.316425: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:05.316461: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:05.316466: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:05.316494: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:05.316499: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:05.316513: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:05.316552: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:05.316557: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:05.316577: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:05.316582: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.3s, Loss=1.16e+01, Inv=1.16e+01, For=1.28e+02, Power=3.60e+00
  [eval] test_mse=2.409e+00  (n=13048)
Epoch 00050: Time=  11.3s, Loss=2.30e+00, Inv=2.30e+00, For=6.69e+01, Power=1.38e+00
Epoch 00100: Time=  15.9s, Loss=2.12e+00, Inv=2.12e+00, For=9.32e+01, Power=1.31e+00
Epoch 00150: Time=  20.0s, Loss=2.04e+00, Inv=2.04e+00, For=1.25e+02, Power=1.28e+00
Epoch 00200: Time=  24.8s, Loss=1.99e+00, Inv=1.99e+00, For=1.46e+02, Power=1.26e+00
  [eval] test_mse=2.147e+00  (n=13048)
Epoch 00250: Time=  29.6s, Loss=1.96e+00, Inv=1.96e+00, For=1.69e+02, Power=1.25e+00
Epoch 00300: Time=  34.1s, Loss=1.94e+00, Inv=1.94e+00, For=1.92e+02, Power=1.24e+00
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300
Torque MSE  = 3.835e-01
Torque RMSE = 6.192e-01
Per-joint MSE : 7.546e-01 4.306e-01 4.084e-01 1.106e-01 2.009e-01 3.956e-01
Per-joint RMSE: 8.687e-01 6.562e-01 6.391e-01 3.326e-01 4.483e-01 6.290e-01
Comp Time per Sample = 2.342e-08s / 42701925.0Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz' ===
===================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K100_tf0p3_seed1_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep300.jax
Detected n_dof=6 (seed=2)
2026-01-22 07:48:41.619151: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 70 trajectories
2026-01-22 07:48:42.907643: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:42.907655: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:44.442137: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:45.597042: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:45.597056: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:47.232491: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:47.232525: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 07:48:47.232530: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/70
  done 50/70
2026-01-22 07:48:48.804170: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 70/70

Exporting split=test: 30 trajectories
  done 25/30
  done 30/30

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz --H 25 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=24
X_train: (33358, 25, 24)  Y_train: (33358, 6)
X_test : (12664, 25, 24)  Y_test : (12664, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:48:51.088597: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:48:51.112799: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (33358, 25, 24), Y_train = (33358, 6)
  X_test  = (12664, 25, 24),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:48:52.214343: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:48:52.219088: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:48:52.220011: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:48:52.221607: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:48:52.222621: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:48:52.223482: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:48:52.308155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:48:52.309043: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:48:52.309842: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:48:52.310633: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8962 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:48:53.235871: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 15ms/step - loss: 0.2475 - val_loss: 0.3570
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.1411 - val_loss: 0.3547
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.1247 - val_loss: 0.3437
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1156 - val_loss: 0.3340
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1089 - val_loss: 0.3252
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1043 - val_loss: 0.3231
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.0999 - val_loss: 0.3199
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.0969 - val_loss: 0.3167
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.0945 - val_loss: 0.3130
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.0921 - val_loss: 0.3159
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.0892 - val_loss: 0.3097
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.0882 - val_loss: 0.3076
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.0867 - val_loss: 0.3080
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.0850 - val_loss: 0.3052
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.0835 - val_loss: 0.3031
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0821 - val_loss: 0.3025
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0805 - val_loss: 0.3028
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0799 - val_loss: 0.3030
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0786 - val_loss: 0.2978
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.2994
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0769 - val_loss: 0.2989
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0758 - val_loss: 0.2977
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0749 - val_loss: 0.3000
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0745 - val_loss: 0.2952
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.0740 - val_loss: 0.2953
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.0734 - val_loss: 0.2956
Epoch 27/80
105/105 - 0s - 3ms/step - loss: 0.0727 - val_loss: 0.2971
Epoch 28/80
105/105 - 0s - 3ms/step - loss: 0.0719 - val_loss: 0.2933
Epoch 29/80
105/105 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.2966
Epoch 30/80
105/105 - 0s - 3ms/step - loss: 0.0706 - val_loss: 0.2953
Epoch 31/80
105/105 - 0s - 3ms/step - loss: 0.0703 - val_loss: 0.2945
Epoch 32/80
105/105 - 0s - 3ms/step - loss: 0.0696 - val_loss: 0.2975
Epoch 33/80
105/105 - 0s - 3ms/step - loss: 0.0693 - val_loss: 0.2950
Epoch 34/80
105/105 - 0s - 3ms/step - loss: 0.0690 - val_loss: 0.2912
Epoch 35/80
105/105 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.2941
Epoch 36/80
105/105 - 0s - 3ms/step - loss: 0.0676 - val_loss: 0.2926
Epoch 37/80
105/105 - 0s - 3ms/step - loss: 0.0675 - val_loss: 0.2928
Epoch 38/80
105/105 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.2922
Epoch 39/80
105/105 - 0s - 3ms/step - loss: 0.0669 - val_loss: 0.2939
Epoch 40/80
105/105 - 0s - 3ms/step - loss: 0.0672 - val_loss: 0.2959
Epoch 41/80
105/105 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.2988
Epoch 42/80
105/105 - 0s - 3ms/step - loss: 0.0657 - val_loss: 0.2939
Epoch 43/80
105/105 - 0s - 3ms/step - loss: 0.0652 - val_loss: 0.2950
Epoch 44/80
105/105 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.2987
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5195
Per-joint RMSE: 0.7412 0.4974 0.5424 0.2487 0.3820 0.5660
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:49:07.252805: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:49:07.277544: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:49:08.124303: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:08.129003: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:08.129793: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:08.131506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:08.132298: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:08.133039: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:08.214796: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:08.215630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:08.216368: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:08.217103: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:49:08.510920: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.846338e-01  RMSE=6.201885e-01
  per-joint RMSE: 0.8737 0.6533 0.6423 0.3342 0.4531 0.6230
Residual LSTM:  MSE=2.698560e-01      RMSE=5.194767e-01
  per-joint RMSE: 0.7412 0.4974 0.5424 0.2487 0.3820 0.5660
Combined torque MSE=2.698560e-01     RMSE=5.194767e-01
  per-joint RMSE: 0.7412 0.4974 0.5424 0.2487 0.3820 0.5660
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz --H 25 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=6
X_train: (33358, 25, 6)  Y_train: (33358, 6)
X_test : (12664, 25, 6)  Y_test : (12664, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:49:10.696527: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:49:10.720721: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (33358, 25, 6), Y_train = (33358, 6)
  X_test  = (12664, 25, 6),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:49:11.717836: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:11.723027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:11.723954: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:11.725578: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:11.726384: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:11.727121: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:11.806395: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:11.807246: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:11.807995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:11.808734: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:49:12.722091: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 16ms/step - loss: 0.4863 - val_loss: 1.3929
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.2849 - val_loss: 1.1816
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.2168 - val_loss: 1.1259
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1850 - val_loss: 1.1234
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1618 - val_loss: 1.1370
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1438 - val_loss: 1.1085
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1331 - val_loss: 1.1217
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.1256 - val_loss: 1.0772
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.1183 - val_loss: 1.0853
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.1135 - val_loss: 1.0904
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.1142 - val_loss: 1.1064
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.1094 - val_loss: 1.0981
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.1050 - val_loss: 1.0925
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.1029 - val_loss: 1.1013
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.1036 - val_loss: 1.0968
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0994 - val_loss: 1.0811
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.1021 - val_loss: 1.0868
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0997 - val_loss: 1.0890
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5847
Per-joint RMSE: 0.8196 0.6377 0.5726 0.2959 0.4400 0.6032
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:49:19.525271: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:49:19.550364: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:49:20.420705: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:20.425356: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:20.426154: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:20.427839: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:20.428636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:20.429368: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:20.510355: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:20.511186: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:20.511926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:20.512653: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:49:20.805519: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.846338e-01  RMSE=6.201885e-01
  per-joint RMSE: 0.8737 0.6533 0.6423 0.3342 0.4531 0.6230
Residual LSTM:  MSE=3.418919e-01      RMSE=5.847152e-01
  per-joint RMSE: 0.8196 0.6377 0.5726 0.2959 0.4400 0.6032
Combined torque MSE=3.418919e-01     RMSE=5.847152e-01
  per-joint RMSE: 0.8196 0.6377 0.5726 0.2959 0.4400 0.6032
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz --H 25 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33358, 25, 18)  Y_train: (33358, 6)
X_test : (12664, 25, 18)  Y_test : (12664, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:49:23.037291: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:49:23.061721: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33358, 25, 18), Y_train = (33358, 6)
  X_test  = (12664, 25, 18),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:49:24.101475: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:24.106084: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:24.106875: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:24.108714: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:24.109509: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:24.110245: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:24.184098: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:24.185025: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:24.185853: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:24.186592: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8955 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:49:25.133413: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 16ms/step - loss: 0.2805 - val_loss: 0.3667
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.1602 - val_loss: 0.3540
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.1414 - val_loss: 0.3475
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1315 - val_loss: 0.3430
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1244 - val_loss: 0.3349
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1169 - val_loss: 0.3321
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1119 - val_loss: 0.3288
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.1071 - val_loss: 0.3222
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.1043 - val_loss: 0.3209
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.1018 - val_loss: 0.3195
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.0991 - val_loss: 0.3157
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.0968 - val_loss: 0.3154
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.0940 - val_loss: 0.3160
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.0920 - val_loss: 0.3201
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.0913 - val_loss: 0.3104
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0893 - val_loss: 0.3144
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0871 - val_loss: 0.3103
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0860 - val_loss: 0.3128
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0862 - val_loss: 0.3128
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0839 - val_loss: 0.3108
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0820 - val_loss: 0.3101
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0815 - val_loss: 0.3126
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0800 - val_loss: 0.3157
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0801 - val_loss: 0.3091
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.0797 - val_loss: 0.3091
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.0794 - val_loss: 0.3078
Epoch 27/80
105/105 - 0s - 3ms/step - loss: 0.0780 - val_loss: 0.3150
Epoch 28/80
105/105 - 0s - 3ms/step - loss: 0.0772 - val_loss: 0.3089
Epoch 29/80
105/105 - 0s - 3ms/step - loss: 0.0757 - val_loss: 0.3091
Epoch 30/80
105/105 - 0s - 3ms/step - loss: 0.0746 - val_loss: 0.3094
Epoch 31/80
105/105 - 0s - 3ms/step - loss: 0.0769 - val_loss: 0.3138
Epoch 32/80
105/105 - 0s - 3ms/step - loss: 0.0744 - val_loss: 0.3113
Epoch 33/80
105/105 - 0s - 3ms/step - loss: 0.0748 - val_loss: 0.3154
Epoch 34/80
105/105 - 0s - 3ms/step - loss: 0.0750 - val_loss: 0.3075
Epoch 35/80
105/105 - 0s - 3ms/step - loss: 0.0737 - val_loss: 0.3149
Epoch 36/80
105/105 - 0s - 3ms/step - loss: 0.0725 - val_loss: 0.3139
Epoch 37/80
105/105 - 0s - 3ms/step - loss: 0.0720 - val_loss: 0.3045
Epoch 38/80
105/105 - 0s - 3ms/step - loss: 0.0713 - val_loss: 0.3138
Epoch 39/80
105/105 - 0s - 3ms/step - loss: 0.0707 - val_loss: 0.3143
Epoch 40/80
105/105 - 0s - 3ms/step - loss: 0.0715 - val_loss: 0.3100
Epoch 41/80
105/105 - 0s - 3ms/step - loss: 0.0710 - val_loss: 0.3078
Epoch 42/80
105/105 - 0s - 3ms/step - loss: 0.0701 - val_loss: 0.3075
Epoch 43/80
105/105 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.3128
Epoch 44/80
105/105 - 0s - 3ms/step - loss: 0.0701 - val_loss: 0.3109
Epoch 45/80
105/105 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.3192
Epoch 46/80
105/105 - 0s - 3ms/step - loss: 0.0696 - val_loss: 0.3146
Epoch 47/80
105/105 - 0s - 3ms/step - loss: 0.0680 - val_loss: 0.3050
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5591
Per-joint RMSE: 0.7970 0.5511 0.5836 0.2329 0.4162 0.6075
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:49:40.032660: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:49:40.059779: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:49:40.909152: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:40.913847: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:40.914636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:40.916495: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:40.917292: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:40.918037: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:40.995175: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:40.996023: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:40.996777: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:40.997509: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8959 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:49:41.293104: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.846338e-01  RMSE=6.201885e-01
  per-joint RMSE: 0.8737 0.6533 0.6423 0.3342 0.4531 0.6230
Residual LSTM:  MSE=3.126448e-01      RMSE=5.591465e-01
  per-joint RMSE: 0.7970 0.5511 0.5836 0.2329 0.4162 0.6075
Combined torque MSE=3.126448e-01     RMSE=5.591465e-01
  per-joint RMSE: 0.7970 0.5511 0.5836 0.2329 0.4162 0.6075
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --H 25 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.json
H=25, n_dof=6, feature_dim=18
X_train: (33358, 25, 18)  Y_train: (33358, 6)
X_test : (12664, 25, 18)  Y_test : (12664, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:49:43.513480: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:49:43.537890: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (33358, 25, 18), Y_train = (33358, 6)
  X_test  = (12664, 25, 18),  Y_test  = (12664, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:49:44.594605: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:44.599147: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:44.599951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:44.601538: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:44.602331: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:44.603080: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:44.683489: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:44.684330: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:44.685087: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:49:44.685821: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:49:45.606508: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
105/105 - 2s - 16ms/step - loss: 0.2607 - val_loss: 0.3550
Epoch 2/80
105/105 - 0s - 3ms/step - loss: 0.1484 - val_loss: 0.3479
Epoch 3/80
105/105 - 0s - 3ms/step - loss: 0.1292 - val_loss: 0.3467
Epoch 4/80
105/105 - 0s - 3ms/step - loss: 0.1182 - val_loss: 0.3416
Epoch 5/80
105/105 - 0s - 3ms/step - loss: 0.1116 - val_loss: 0.3380
Epoch 6/80
105/105 - 0s - 3ms/step - loss: 0.1055 - val_loss: 0.3373
Epoch 7/80
105/105 - 0s - 3ms/step - loss: 0.1012 - val_loss: 0.3327
Epoch 8/80
105/105 - 0s - 3ms/step - loss: 0.0980 - val_loss: 0.3335
Epoch 9/80
105/105 - 0s - 3ms/step - loss: 0.0936 - val_loss: 0.3268
Epoch 10/80
105/105 - 0s - 3ms/step - loss: 0.0931 - val_loss: 0.3239
Epoch 11/80
105/105 - 0s - 3ms/step - loss: 0.0898 - val_loss: 0.3222
Epoch 12/80
105/105 - 0s - 3ms/step - loss: 0.0880 - val_loss: 0.3170
Epoch 13/80
105/105 - 0s - 3ms/step - loss: 0.0863 - val_loss: 0.3191
Epoch 14/80
105/105 - 0s - 3ms/step - loss: 0.0851 - val_loss: 0.3189
Epoch 15/80
105/105 - 0s - 3ms/step - loss: 0.0839 - val_loss: 0.3163
Epoch 16/80
105/105 - 0s - 3ms/step - loss: 0.0825 - val_loss: 0.3186
Epoch 17/80
105/105 - 0s - 3ms/step - loss: 0.0812 - val_loss: 0.3175
Epoch 18/80
105/105 - 0s - 3ms/step - loss: 0.0802 - val_loss: 0.3183
Epoch 19/80
105/105 - 0s - 3ms/step - loss: 0.0795 - val_loss: 0.3170
Epoch 20/80
105/105 - 0s - 3ms/step - loss: 0.0785 - val_loss: 0.3113
Epoch 21/80
105/105 - 0s - 3ms/step - loss: 0.0779 - val_loss: 0.3127
Epoch 22/80
105/105 - 0s - 3ms/step - loss: 0.0763 - val_loss: 0.3125
Epoch 23/80
105/105 - 0s - 3ms/step - loss: 0.0759 - val_loss: 0.3164
Epoch 24/80
105/105 - 0s - 3ms/step - loss: 0.0745 - val_loss: 0.3093
Epoch 25/80
105/105 - 0s - 3ms/step - loss: 0.0745 - val_loss: 0.3145
Epoch 26/80
105/105 - 0s - 3ms/step - loss: 0.0741 - val_loss: 0.3121
Epoch 27/80
105/105 - 0s - 3ms/step - loss: 0.0736 - val_loss: 0.3019
Epoch 28/80
105/105 - 0s - 3ms/step - loss: 0.0725 - val_loss: 0.3078
Epoch 29/80
105/105 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.3024
Epoch 30/80
105/105 - 0s - 3ms/step - loss: 0.0723 - val_loss: 0.3096
Epoch 31/80
105/105 - 0s - 3ms/step - loss: 0.0719 - val_loss: 0.3046
Epoch 32/80
105/105 - 0s - 3ms/step - loss: 0.0697 - val_loss: 0.3109
Epoch 33/80
105/105 - 0s - 3ms/step - loss: 0.0696 - val_loss: 0.3105
Epoch 34/80
105/105 - 0s - 3ms/step - loss: 0.0695 - val_loss: 0.3068
Epoch 35/80
105/105 - 0s - 3ms/step - loss: 0.0698 - val_loss: 0.3012
Epoch 36/80
105/105 - 0s - 3ms/step - loss: 0.0689 - val_loss: 0.3000
Epoch 37/80
105/105 - 0s - 3ms/step - loss: 0.0685 - val_loss: 0.2988
Epoch 38/80
105/105 - 0s - 3ms/step - loss: 0.0675 - val_loss: 0.3008
Epoch 39/80
105/105 - 0s - 3ms/step - loss: 0.0673 - val_loss: 0.3049
Epoch 40/80
105/105 - 0s - 3ms/step - loss: 0.0671 - val_loss: 0.3070
Epoch 41/80
105/105 - 0s - 3ms/step - loss: 0.0668 - val_loss: 0.3023
Epoch 42/80
105/105 - 0s - 3ms/step - loss: 0.0660 - val_loss: 0.3081
Epoch 43/80
105/105 - 0s - 3ms/step - loss: 0.0659 - val_loss: 0.3047
Epoch 44/80
105/105 - 0s - 3ms/step - loss: 0.0655 - val_loss: 0.3098
Epoch 45/80
105/105 - 0s - 3ms/step - loss: 0.0662 - val_loss: 0.3124
Epoch 46/80
105/105 - 0s - 3ms/step - loss: 0.0648 - val_loss: 0.3083
Epoch 47/80
105/105 - 0s - 3ms/step - loss: 0.0650 - val_loss: 0.3114
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5243
Per-joint RMSE: 0.7540 0.4789 0.5595 0.2417 0.3862 0.5755
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:50:00.427724: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:50:00.452494: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:50:01.301337: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:01.305864: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:01.306661: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:01.308342: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:01.309217: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:01.309962: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:01.390365: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:01.391201: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:01.391941: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:01.392678: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:50:01.681610: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.846338e-01  RMSE=6.201885e-01
  per-joint RMSE: 0.8737 0.6533 0.6423 0.3342 0.4531 0.6230
Residual LSTM:  MSE=2.749348e-01      RMSE=5.243422e-01
  per-joint RMSE: 0.7540 0.4789 0.5595 0.2417 0.3862 0.5755
Combined torque MSE=2.749348e-01     RMSE=5.243422e-01
  per-joint RMSE: 0.7540 0.4789 0.5595 0.2417 0.3862 0.5755
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H25_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz --H 50 --features full' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=24
X_train: (32483, 50, 24)  Y_train: (32483, 6)
X_test : (12314, 50, 24)  Y_test : (12314, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:50:04.069735: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:50:04.093615: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (32483, 50, 24), Y_train = (32483, 6)
  X_test  = (12314, 50, 24),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:50:05.323129: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:05.327906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:05.328819: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:05.330565: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:05.331485: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:05.332694: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:05.429115: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:05.430004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:05.430794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:05.431584: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:50:06.457073: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2545 - val_loss: 0.3712
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1464 - val_loss: 0.3642
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1292 - val_loss: 0.3627
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1207 - val_loss: 0.3611
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1137 - val_loss: 0.3533
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1075 - val_loss: 0.3491
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1031 - val_loss: 0.3399
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.0994 - val_loss: 0.3404
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0970 - val_loss: 0.3370
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0941 - val_loss: 0.3342
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0927 - val_loss: 0.3307
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0909 - val_loss: 0.3287
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0890 - val_loss: 0.3278
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0872 - val_loss: 0.3209
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0858 - val_loss: 0.3214
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0838 - val_loss: 0.3171
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.3146
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0820 - val_loss: 0.3158
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0810 - val_loss: 0.3077
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0800 - val_loss: 0.3116
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0785 - val_loss: 0.3068
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0779 - val_loss: 0.3043
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0772 - val_loss: 0.3002
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0764 - val_loss: 0.3028
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0756 - val_loss: 0.3070
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0750 - val_loss: 0.3033
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0739 - val_loss: 0.3034
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0740 - val_loss: 0.3009
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0734 - val_loss: 0.3053
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0721 - val_loss: 0.3009
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0716 - val_loss: 0.2995
Epoch 32/80
102/102 - 0s - 4ms/step - loss: 0.0713 - val_loss: 0.2948
Epoch 33/80
102/102 - 0s - 4ms/step - loss: 0.0711 - val_loss: 0.2961
Epoch 34/80
102/102 - 0s - 4ms/step - loss: 0.0706 - val_loss: 0.3054
Epoch 35/80
102/102 - 0s - 4ms/step - loss: 0.0699 - val_loss: 0.2994
Epoch 36/80
102/102 - 0s - 4ms/step - loss: 0.0691 - val_loss: 0.2964
Epoch 37/80
102/102 - 0s - 4ms/step - loss: 0.0686 - val_loss: 0.2981
Epoch 38/80
102/102 - 0s - 4ms/step - loss: 0.0683 - val_loss: 0.2969
Epoch 39/80
102/102 - 0s - 4ms/step - loss: 0.0680 - val_loss: 0.2995
Epoch 40/80
102/102 - 0s - 4ms/step - loss: 0.0677 - val_loss: 0.2984
Epoch 41/80
102/102 - 0s - 4ms/step - loss: 0.0668 - val_loss: 0.3019
Epoch 42/80
102/102 - 0s - 4ms/step - loss: 0.0665 - val_loss: 0.2972
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5217
Per-joint RMSE: 0.7331 0.5328 0.5194 0.2599 0.3764 0.5767
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:50:25.778905: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:50:25.803005: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 07:50:26.662404: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:26.667096: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:26.667940: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:26.669622: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:26.670467: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:26.671250: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:26.749719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:26.750614: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:26.751409: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:26.752195: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:50:27.049993: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.798697e-01  RMSE=6.163357e-01
  per-joint RMSE: 0.8714 0.6529 0.6363 0.3285 0.4503 0.6148
Residual LSTM:  MSE=2.721454e-01      RMSE=5.216755e-01
  per-joint RMSE: 0.7331 0.5328 0.5194 0.2599 0.3764 0.5767
Combined torque MSE=2.721453e-01     RMSE=5.216755e-01
  per-joint RMSE: 0.7331 0.5328 0.5194 0.2599 0.3764 0.5767
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_full__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz --H 50 --features tau_hat' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=6
X_train: (32483, 50, 6)  Y_train: (32483, 6)
X_test : (12314, 50, 6)  Y_test : (12314, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:50:29.291039: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:50:29.316299: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (32483, 50, 6), Y_train = (32483, 6)
  X_test  = (12314, 50, 6),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:50:30.349354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:30.353853: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:30.354649: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:30.356260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:30.357052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:30.357790: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:30.441105: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:30.441951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:30.442783: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:30.443513: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:50:31.376356: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.4538 - val_loss: 1.2272
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.2398 - val_loss: 1.1191
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1856 - val_loss: 1.0216
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1608 - val_loss: 0.9940
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1420 - val_loss: 0.9802
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1356 - val_loss: 0.9652
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1278 - val_loss: 0.9903
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1211 - val_loss: 0.9961
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1177 - val_loss: 0.9805
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1155 - val_loss: 0.9635
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1121 - val_loss: 0.9783
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.1103 - val_loss: 0.9776
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.1071 - val_loss: 0.9845
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.1056 - val_loss: 0.9568
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.1053 - val_loss: 0.9391
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.1019 - val_loss: 0.9563
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.1015 - val_loss: 0.9644
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.1008 - val_loss: 0.9487
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.1014 - val_loss: 0.9560
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0986 - val_loss: 0.9660
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0961 - val_loss: 0.9667
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0951 - val_loss: 0.9723
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0942 - val_loss: 0.9639
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0940 - val_loss: 0.9802
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0950 - val_loss: 0.9829
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5734
Per-joint RMSE: 0.8326 0.5572 0.5865 0.2970 0.4243 0.5973
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:50:43.248676: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:50:43.273830: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 07:50:44.137174: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:44.141750: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:44.142547: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:44.144239: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:44.145035: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:44.145871: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:44.227575: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:44.228433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:44.229096: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:44.229867: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:50:44.522321: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.798697e-01  RMSE=6.163357e-01
  per-joint RMSE: 0.8714 0.6529 0.6363 0.3285 0.4503 0.6148
Residual LSTM:  MSE=3.287980e-01      RMSE=5.734091e-01
  per-joint RMSE: 0.8326 0.5572 0.5865 0.2970 0.4243 0.5973
Combined torque MSE=3.287980e-01     RMSE=5.734091e-01
  per-joint RMSE: 0.8326 0.5572 0.5865 0.2970 0.4243 0.5973
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_tau_hat__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz --H 50 --features state' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32483, 50, 18)  Y_train: (32483, 6)
X_test : (12314, 50, 18)  Y_test : (12314, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:50:46.844635: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:50:46.868527: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32483, 50, 18), Y_train = (32483, 6)
  X_test  = (12314, 50, 18),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:50:48.065053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:48.069759: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:48.070655: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:48.072317: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:48.073240: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:48.074086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:48.156534: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:48.157506: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:48.158304: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:48.159174: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:50:49.140217: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2909 - val_loss: 0.3621
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1689 - val_loss: 0.3419
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1489 - val_loss: 0.3288
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1379 - val_loss: 0.3252
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1299 - val_loss: 0.3208
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1230 - val_loss: 0.3188
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1175 - val_loss: 0.3282
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1132 - val_loss: 0.3255
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.1091 - val_loss: 0.3207
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.1053 - val_loss: 0.3198
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.1031 - val_loss: 0.3210
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0997 - val_loss: 0.3205
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0978 - val_loss: 0.3241
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0954 - val_loss: 0.3210
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0929 - val_loss: 0.3214
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0909 - val_loss: 0.3208
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5509
Per-joint RMSE: 0.7894 0.5222 0.5888 0.2358 0.4098 0.5960
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:50:57.489047: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:50:57.514146: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:50:58.364029: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:58.368564: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:58.369361: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:58.371178: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:58.371972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:58.372704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:58.452246: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:58.453159: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:58.453980: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:50:58.454710: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:50:58.747825: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.798697e-01  RMSE=6.163357e-01
  per-joint RMSE: 0.8714 0.6529 0.6363 0.3285 0.4503 0.6148
Residual LSTM:  MSE=3.035415e-01      RMSE=5.509459e-01
  per-joint RMSE: 0.7894 0.5222 0.5888 0.2358 0.4098 0.5960
Combined torque MSE=3.035414e-01     RMSE=5.509459e-01
  per-joint RMSE: 0.7894 0.5222 0.5888 0.2358 0.4098 0.5960
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --H 50 --features state_tauhat' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.json
H=50, n_dof=6, feature_dim=18
X_train: (32483, 50, 18)  Y_train: (32483, 6)
X_test : (12314, 50, 18)  Y_test : (12314, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 80 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:51:01.094668: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:51:01.118459: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep300.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (32483, 50, 18), Y_train = (32483, 6)
  X_test  = (12314, 50, 18),  Y_test  = (12314, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 07:51:02.307027: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:02.312242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:02.313154: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:02.314949: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:02.315859: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:02.316719: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:02.413898: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:02.414804: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:02.415603: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:02.416383: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/80
2026-01-22 07:51:03.366307: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
102/102 - 2s - 17ms/step - loss: 0.2570 - val_loss: 0.3490
Epoch 2/80
102/102 - 0s - 4ms/step - loss: 0.1472 - val_loss: 0.3359
Epoch 3/80
102/102 - 0s - 4ms/step - loss: 0.1301 - val_loss: 0.3296
Epoch 4/80
102/102 - 0s - 4ms/step - loss: 0.1214 - val_loss: 0.3231
Epoch 5/80
102/102 - 0s - 4ms/step - loss: 0.1147 - val_loss: 0.3174
Epoch 6/80
102/102 - 0s - 4ms/step - loss: 0.1099 - val_loss: 0.3152
Epoch 7/80
102/102 - 0s - 4ms/step - loss: 0.1055 - val_loss: 0.3152
Epoch 8/80
102/102 - 0s - 4ms/step - loss: 0.1017 - val_loss: 0.3117
Epoch 9/80
102/102 - 0s - 4ms/step - loss: 0.0993 - val_loss: 0.3118
Epoch 10/80
102/102 - 0s - 4ms/step - loss: 0.0958 - val_loss: 0.3131
Epoch 11/80
102/102 - 0s - 5ms/step - loss: 0.0939 - val_loss: 0.3065
Epoch 12/80
102/102 - 0s - 4ms/step - loss: 0.0918 - val_loss: 0.3035
Epoch 13/80
102/102 - 0s - 4ms/step - loss: 0.0903 - val_loss: 0.3057
Epoch 14/80
102/102 - 0s - 4ms/step - loss: 0.0886 - val_loss: 0.3012
Epoch 15/80
102/102 - 0s - 4ms/step - loss: 0.0864 - val_loss: 0.3025
Epoch 16/80
102/102 - 0s - 4ms/step - loss: 0.0852 - val_loss: 0.3070
Epoch 17/80
102/102 - 0s - 4ms/step - loss: 0.0842 - val_loss: 0.3001
Epoch 18/80
102/102 - 0s - 4ms/step - loss: 0.0826 - val_loss: 0.3048
Epoch 19/80
102/102 - 0s - 4ms/step - loss: 0.0816 - val_loss: 0.3073
Epoch 20/80
102/102 - 0s - 4ms/step - loss: 0.0804 - val_loss: 0.3063
Epoch 21/80
102/102 - 0s - 4ms/step - loss: 0.0795 - val_loss: 0.2982
Epoch 22/80
102/102 - 0s - 4ms/step - loss: 0.0789 - val_loss: 0.2992
Epoch 23/80
102/102 - 0s - 4ms/step - loss: 0.0775 - val_loss: 0.3033
Epoch 24/80
102/102 - 0s - 4ms/step - loss: 0.0770 - val_loss: 0.3024
Epoch 25/80
102/102 - 0s - 4ms/step - loss: 0.0760 - val_loss: 0.2982
Epoch 26/80
102/102 - 0s - 4ms/step - loss: 0.0747 - val_loss: 0.2986
Epoch 27/80
102/102 - 0s - 4ms/step - loss: 0.0749 - val_loss: 0.3039
Epoch 28/80
102/102 - 0s - 4ms/step - loss: 0.0738 - val_loss: 0.3038
Epoch 29/80
102/102 - 0s - 4ms/step - loss: 0.0729 - val_loss: 0.3030
Epoch 30/80
102/102 - 0s - 4ms/step - loss: 0.0727 - val_loss: 0.3024
Epoch 31/80
102/102 - 0s - 4ms/step - loss: 0.0718 - val_loss: 0.3066
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.5220
Per-joint RMSE: 0.7387 0.5188 0.5480 0.2373 0.3797 0.5649
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 07:51:17.765289: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 07:51:17.789799: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300/delan_UR3_Load0_combined_26__A__K100_tf0p3__residual__delan_jax_struct_s2_ep300.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 30
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 07:51:18.644642: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:18.649243: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:18.650041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:18.651848: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:18.652644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:18.653394: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:18.731353: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:18.732183: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:18.732924: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 07:51:18.733658: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8957 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 07:51:19.029851: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 25/30
  done 30/30

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=3.798697e-01  RMSE=6.163357e-01
  per-joint RMSE: 0.8714 0.6529 0.6363 0.3285 0.4503 0.6148
Residual LSTM:  MSE=2.724470e-01      RMSE=5.219645e-01
  per-joint RMSE: 0.7387 0.5188 0.5480 0.2373 0.3797 0.5649
Combined torque MSE=2.724470e-01     RMSE=5.219645e-01
  per-joint RMSE: 0.7387 0.5188 0.5480 0.2373 0.3797 0.5649
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K100_tf0p3__delan_jax_struct_s2_ep300__feat_state_tauhat__lstm_s1_H50_ep80_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

