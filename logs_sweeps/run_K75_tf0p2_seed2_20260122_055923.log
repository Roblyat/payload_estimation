################################################################################################################
### RUN: K=75 test_fraction=0.2 seed=2                                                                       ###
### npz_in=/workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz ###
################################################################################################################

#####################
### 1) PREPROCESS ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_delan_dataset.py --qdd True --col_format wide --trajectory_amount 75 --test_fraction 0.2 --seed 2 --raw_csv /workspace/shared/data/raw/delan_UR3_Load0_combined_26.csv --out_npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Saved: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
Trajectories: train=60 test=15
Exists: True

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=0                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz -t structured -s 0 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7e642001c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
   dt ≈ 0.027237226774096998
  dof = 6
  Train trajectories = 60
  Test trajectories  = 15
  Train samples = 30288
  Test samples  = 6524
################################################

2026-01-22 06:22:16.298945: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250 | type=structured | dof=6
################################################
2026-01-22 06:22:19.452371: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:19.452410: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:19.452418: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:19.452454: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:19.452459: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:19.452477: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:19.452522: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:19.452528: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:19.452548: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:19.452556: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.57e+01, Inv=1.57e+01, For=1.42e+02, Power=3.38e+00
  [eval] test_mse=5.941e+00  (n=6524)
Epoch 00050: Time=  10.3s, Loss=2.27e+00, Inv=2.27e+00, For=6.28e+01, Power=1.53e+00
Epoch 00100: Time=  14.0s, Loss=1.95e+00, Inv=1.95e+00, For=5.17e+01, Power=1.31e+00
Epoch 00150: Time=  18.4s, Loss=1.83e+00, Inv=1.83e+00, For=6.53e+01, Power=1.23e+00
Epoch 00200: Time=  22.1s, Loss=1.75e+00, Inv=1.75e+00, For=8.16e+01, Power=1.19e+00
  [eval] test_mse=4.737e+00  (n=6524)
Epoch 00250: Time=  26.1s, Loss=1.70e+00, Inv=1.70e+00, For=1.02e+02, Power=1.17e+00
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250
Torque MSE  = 9.879e-01
Torque RMSE = 9.939e-01
Per-joint MSE : 1.165e+00 2.074e+00 7.486e-01 4.265e-01 4.084e-01 1.105e+00
Per-joint RMSE: 1.080e+00 1.440e+00 8.652e-01 6.531e-01 6.390e-01 1.051e+00
Comp Time per Sample = 4.854e-08s / 20602018.3Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s0_ep250.jax
Detected n_dof=6 (seed=0)
2026-01-22 06:22:47.652310: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 60 trajectories
2026-01-22 06:22:48.975262: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:48.975278: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:50.486269: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:50.486281: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:52.039129: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/60
2026-01-22 06:22:53.273375: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/60
2026-01-22 06:22:54.512906: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:54.512940: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:22:54.512946: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 60/60

Exporting split=test: 15 trajectories
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (29478, 25, 24)  Y_train: (29478, 6)
X_test : (6332, 25, 24)  Y_test : (6332, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:22:56.906402: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:22:56.930643: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (29478, 25, 24), Y_train = (29478, 6)
  X_test  = (6332, 25, 24),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:22:57.994441: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:57.999265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:58.000195: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:58.001735: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:58.002663: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:58.003535: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:58.089636: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:58.090606: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:58.091393: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:22:58.092170: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8951 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:22:59.041737: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.3305 - val_loss: 0.4049
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.1846 - val_loss: 0.3700
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.1580 - val_loss: 0.3485
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.1455 - val_loss: 0.3468
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1347 - val_loss: 0.3396
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1280 - val_loss: 0.3327
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1224 - val_loss: 0.3288
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1189 - val_loss: 0.3194
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1146 - val_loss: 0.3201
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1122 - val_loss: 0.3227
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1089 - val_loss: 0.3132
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1066 - val_loss: 0.3163
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1047 - val_loss: 0.3111
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1024 - val_loss: 0.3103
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.1010 - val_loss: 0.3033
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.0981 - val_loss: 0.3097
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.0961 - val_loss: 0.3053
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.0951 - val_loss: 0.3047
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.0956 - val_loss: 0.3036
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.0930 - val_loss: 0.2964
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.0922 - val_loss: 0.2997
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.0904 - val_loss: 0.2973
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.0902 - val_loss: 0.2958
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.0870 - val_loss: 0.2989
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.0867 - val_loss: 0.2877
Epoch 26/60
93/93 - 0s - 3ms/step - loss: 0.0867 - val_loss: 0.2969
Epoch 27/60
93/93 - 0s - 3ms/step - loss: 0.0851 - val_loss: 0.2859
Epoch 28/60
93/93 - 0s - 3ms/step - loss: 0.0843 - val_loss: 0.2881
Epoch 29/60
93/93 - 0s - 3ms/step - loss: 0.0850 - val_loss: 0.2826
Epoch 30/60
93/93 - 0s - 3ms/step - loss: 0.0834 - val_loss: 0.2839
Epoch 31/60
93/93 - 0s - 3ms/step - loss: 0.0829 - val_loss: 0.2839
Epoch 32/60
93/93 - 0s - 3ms/step - loss: 0.0823 - val_loss: 0.2820
Epoch 33/60
93/93 - 0s - 3ms/step - loss: 0.0811 - val_loss: 0.2801
Epoch 34/60
93/93 - 0s - 3ms/step - loss: 0.0805 - val_loss: 0.2769
Epoch 35/60
93/93 - 0s - 3ms/step - loss: 0.0793 - val_loss: 0.2753
Epoch 36/60
93/93 - 0s - 3ms/step - loss: 0.0787 - val_loss: 0.2810
Epoch 37/60
93/93 - 0s - 3ms/step - loss: 0.0789 - val_loss: 0.2735
Epoch 38/60
93/93 - 0s - 3ms/step - loss: 0.0792 - val_loss: 0.2783
Epoch 39/60
93/93 - 0s - 3ms/step - loss: 0.0774 - val_loss: 0.2783
Epoch 40/60
93/93 - 0s - 3ms/step - loss: 0.0772 - val_loss: 0.2773
Epoch 41/60
93/93 - 0s - 3ms/step - loss: 0.0773 - val_loss: 0.2686
Epoch 42/60
93/93 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.2690
Epoch 43/60
93/93 - 0s - 3ms/step - loss: 0.0762 - val_loss: 0.2742
Epoch 44/60
93/93 - 0s - 3ms/step - loss: 0.0758 - val_loss: 0.2669
Epoch 45/60
93/93 - 0s - 3ms/step - loss: 0.0750 - val_loss: 0.2629
Epoch 46/60
93/93 - 0s - 3ms/step - loss: 0.0741 - val_loss: 0.2710
Epoch 47/60
93/93 - 0s - 3ms/step - loss: 0.0735 - val_loss: 0.2659
Epoch 48/60
93/93 - 0s - 3ms/step - loss: 0.0740 - val_loss: 0.2628
Epoch 49/60
93/93 - 0s - 3ms/step - loss: 0.0730 - val_loss: 0.2619
Epoch 50/60
93/93 - 0s - 3ms/step - loss: 0.0733 - val_loss: 0.2692
Epoch 51/60
93/93 - 0s - 3ms/step - loss: 0.0730 - val_loss: 0.2665
Epoch 52/60
93/93 - 0s - 3ms/step - loss: 0.0743 - val_loss: 0.2644
Epoch 53/60
93/93 - 0s - 3ms/step - loss: 0.0717 - val_loss: 0.2594
Epoch 54/60
93/93 - 0s - 3ms/step - loss: 0.0720 - val_loss: 0.2661
Epoch 55/60
93/93 - 0s - 3ms/step - loss: 0.0722 - val_loss: 0.2680
Epoch 56/60
93/93 - 0s - 3ms/step - loss: 0.0712 - val_loss: 0.2697
Epoch 57/60
93/93 - 0s - 3ms/step - loss: 0.0719 - val_loss: 0.2687
Epoch 58/60
93/93 - 0s - 3ms/step - loss: 0.0719 - val_loss: 0.2646
Epoch 59/60
93/93 - 0s - 3ms/step - loss: 0.0709 - val_loss: 0.2647
Epoch 60/60
93/93 - 0s - 3ms/step - loss: 0.0698 - val_loss: 0.2659
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9137
Per-joint RMSE: 0.9732 1.3098 0.8217 0.6016 0.5671 0.9941
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:23:15.853007: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:23:15.877181: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:23:16.712420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:16.717094: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:16.717971: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:16.719679: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:16.720467: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:16.721210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:16.802893: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:16.803728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:16.804475: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:16.805211: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:23:17.107846: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.005330e+00  RMSE=1.002662e+00
  per-joint RMSE: 1.0936 1.4500 0.8742 0.6591 0.6460 1.0572
Residual LSTM:  MSE=8.349263e-01      RMSE=9.137430e-01
  per-joint RMSE: 0.9732 1.3098 0.8217 0.6016 0.5671 0.9941
Combined torque MSE=8.349263e-01     RMSE=9.137430e-01
  per-joint RMSE: 0.9732 1.3098 0.8217 0.6016 0.5671 0.9941
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (29478, 25, 6)  Y_train: (29478, 6)
X_test : (6332, 25, 6)  Y_test : (6332, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:23:19.036641: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:23:19.061046: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (29478, 25, 6), Y_train = (29478, 6)
  X_test  = (6332, 25, 6),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:23:20.047319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:20.051866: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:20.052666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:20.054268: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:20.055137: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:20.055875: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:20.137703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:20.138539: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:20.139286: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:20.140026: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:23:21.066466: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.6019 - val_loss: 0.7238
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.3716 - val_loss: 0.6442
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.2890 - val_loss: 0.6032
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.2386 - val_loss: 0.6064
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.2068 - val_loss: 0.5552
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1824 - val_loss: 0.5487
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1665 - val_loss: 0.5458
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1585 - val_loss: 0.5404
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1476 - val_loss: 0.5407
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1417 - val_loss: 0.5416
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1340 - val_loss: 0.5347
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1323 - val_loss: 0.5268
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1278 - val_loss: 0.5366
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1258 - val_loss: 0.5314
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.1241 - val_loss: 0.5763
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.1203 - val_loss: 0.5297
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.1183 - val_loss: 0.5245
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.1162 - val_loss: 0.5204
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.1137 - val_loss: 0.5334
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.1133 - val_loss: 0.5327
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.1110 - val_loss: 0.5283
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.1121 - val_loss: 0.5179
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.1102 - val_loss: 0.5319
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.1142 - val_loss: 0.5232
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.1112 - val_loss: 0.5341
Epoch 26/60
93/93 - 0s - 3ms/step - loss: 0.1064 - val_loss: 0.5370
Epoch 27/60
93/93 - 0s - 3ms/step - loss: 0.1041 - val_loss: 0.5533
Epoch 28/60
93/93 - 0s - 3ms/step - loss: 0.1041 - val_loss: 0.5393
Epoch 29/60
93/93 - 0s - 3ms/step - loss: 0.1045 - val_loss: 0.5398
Epoch 30/60
93/93 - 0s - 3ms/step - loss: 0.1030 - val_loss: 0.5401
Epoch 31/60
93/93 - 0s - 3ms/step - loss: 0.1008 - val_loss: 0.5383
Epoch 32/60
93/93 - 0s - 3ms/step - loss: 0.0996 - val_loss: 0.5299
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9827
Per-joint RMSE: 1.0657 1.4416 0.8542 0.6411 0.6213 1.0266
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:23:30.866386: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:23:30.890411: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:23:31.742703: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:31.747452: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:31.748258: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:31.749938: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:31.750736: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:31.751477: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:31.836339: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:31.837176: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:31.838002: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:31.838734: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:23:32.131669: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.005330e+00  RMSE=1.002662e+00
  per-joint RMSE: 1.0936 1.4500 0.8742 0.6591 0.6460 1.0572
Residual LSTM:  MSE=9.657692e-01      RMSE=9.827356e-01
  per-joint RMSE: 1.0657 1.4416 0.8542 0.6411 0.6213 1.0266
Combined torque MSE=9.657692e-01     RMSE=9.827356e-01
  per-joint RMSE: 1.0657 1.4416 0.8542 0.6411 0.6213 1.0266
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (29478, 25, 18)  Y_train: (29478, 6)
X_test : (6332, 25, 18)  Y_test : (6332, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:23:34.122609: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:23:34.146342: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (29478, 25, 18), Y_train = (29478, 6)
  X_test  = (6332, 25, 18),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:23:35.163426: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:35.167936: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:35.168806: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:35.170558: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:35.171351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:35.172179: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:35.258778: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:35.259625: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:35.260374: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:35.261115: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:23:36.190824: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.3635 - val_loss: 0.4986
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.2154 - val_loss: 0.4541
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.1795 - val_loss: 0.4545
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.1616 - val_loss: 0.4398
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1491 - val_loss: 0.4397
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1424 - val_loss: 0.4344
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1354 - val_loss: 0.4402
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1313 - val_loss: 0.4357
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1266 - val_loss: 0.4402
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1221 - val_loss: 0.4308
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1183 - val_loss: 0.4402
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1153 - val_loss: 0.4291
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1127 - val_loss: 0.4350
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1102 - val_loss: 0.4280
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.1072 - val_loss: 0.4496
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.1050 - val_loss: 0.4413
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.1042 - val_loss: 0.4489
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.1024 - val_loss: 0.4344
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.1000 - val_loss: 0.4329
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.0982 - val_loss: 0.4254
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.0972 - val_loss: 0.4368
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.0972 - val_loss: 0.4287
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.0947 - val_loss: 0.4207
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.0960 - val_loss: 0.4320
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.0924 - val_loss: 0.4211
Epoch 26/60
93/93 - 0s - 3ms/step - loss: 0.0916 - val_loss: 0.4258
Epoch 27/60
93/93 - 0s - 3ms/step - loss: 0.0914 - val_loss: 0.4338
Epoch 28/60
93/93 - 0s - 3ms/step - loss: 0.0900 - val_loss: 0.4271
Epoch 29/60
93/93 - 0s - 3ms/step - loss: 0.0896 - val_loss: 0.4263
Epoch 30/60
93/93 - 0s - 3ms/step - loss: 0.0897 - val_loss: 0.4200
Epoch 31/60
93/93 - 0s - 3ms/step - loss: 0.0889 - val_loss: 0.4251
Epoch 32/60
93/93 - 0s - 3ms/step - loss: 0.0889 - val_loss: 0.4241
Epoch 33/60
93/93 - 0s - 3ms/step - loss: 0.0869 - val_loss: 0.4238
Epoch 34/60
93/93 - 0s - 3ms/step - loss: 0.0872 - val_loss: 0.4222
Epoch 35/60
93/93 - 0s - 3ms/step - loss: 0.0856 - val_loss: 0.4003
Epoch 36/60
93/93 - 0s - 3ms/step - loss: 0.0851 - val_loss: 0.3957
Epoch 37/60
93/93 - 0s - 3ms/step - loss: 0.0843 - val_loss: 0.3902
Epoch 38/60
93/93 - 0s - 3ms/step - loss: 0.0836 - val_loss: 0.4167
Epoch 39/60
93/93 - 0s - 3ms/step - loss: 0.0832 - val_loss: 0.4091
Epoch 40/60
93/93 - 0s - 3ms/step - loss: 0.0829 - val_loss: 0.4211
Epoch 41/60
93/93 - 0s - 3ms/step - loss: 0.0827 - val_loss: 0.4133
Epoch 42/60
93/93 - 0s - 3ms/step - loss: 0.0818 - val_loss: 0.4175
Epoch 43/60
93/93 - 0s - 3ms/step - loss: 0.0819 - val_loss: 0.3994
Epoch 44/60
93/93 - 0s - 3ms/step - loss: 0.0803 - val_loss: 0.4148
Epoch 45/60
93/93 - 0s - 3ms/step - loss: 0.0798 - val_loss: 0.4101
Epoch 46/60
93/93 - 0s - 3ms/step - loss: 0.0797 - val_loss: 0.4025
Epoch 47/60
93/93 - 0s - 3ms/step - loss: 0.0801 - val_loss: 0.4026
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9599
Per-joint RMSE: 1.0371 1.3623 0.8161 0.6419 0.6275 1.0607
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:23:49.656610: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:23:49.681126: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:23:50.529895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:50.534543: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:50.535335: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:50.537055: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:50.537843: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:50.538584: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:50.618126: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:50.619047: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:50.619788: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:50.620528: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8949 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:23:50.923680: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.005330e+00  RMSE=1.002662e+00
  per-joint RMSE: 1.0936 1.4500 0.8742 0.6591 0.6460 1.0572
Residual LSTM:  MSE=9.213817e-01      RMSE=9.598863e-01
  per-joint RMSE: 1.0371 1.3623 0.8161 0.6419 0.6275 1.0607
Combined torque MSE=9.213817e-01     RMSE=9.598863e-01
  per-joint RMSE: 1.0371 1.3623 0.8161 0.6419 0.6275 1.0607
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (29478, 25, 18)  Y_train: (29478, 6)
X_test : (6332, 25, 18)  Y_test : (6332, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:23:52.909354: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:23:52.933068: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (29478, 25, 18), Y_train = (29478, 6)
  X_test  = (6332, 25, 18),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:23:53.959652: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:53.964221: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:53.965023: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:53.966667: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:53.967470: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:53.968225: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:54.055390: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:54.056232: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:54.056976: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:23:54.057794: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:23:55.030157: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 18ms/step - loss: 0.3360 - val_loss: 0.3964
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.1873 - val_loss: 0.3515
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.1600 - val_loss: 0.3405
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.1460 - val_loss: 0.3400
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1353 - val_loss: 0.3393
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1283 - val_loss: 0.3371
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1220 - val_loss: 0.3401
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1179 - val_loss: 0.3394
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1152 - val_loss: 0.3396
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1114 - val_loss: 0.3304
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1084 - val_loss: 0.3393
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1064 - val_loss: 0.3350
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1038 - val_loss: 0.3276
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1022 - val_loss: 0.3239
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.1003 - val_loss: 0.3270
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.0990 - val_loss: 0.3219
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.0972 - val_loss: 0.3203
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.0950 - val_loss: 0.3200
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.0945 - val_loss: 0.3170
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.0930 - val_loss: 0.3163
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.0919 - val_loss: 0.3196
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.0907 - val_loss: 0.3171
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.0903 - val_loss: 0.3133
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.0884 - val_loss: 0.3138
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.0876 - val_loss: 0.3174
Epoch 26/60
93/93 - 0s - 3ms/step - loss: 0.0880 - val_loss: 0.3122
Epoch 27/60
93/93 - 0s - 3ms/step - loss: 0.0869 - val_loss: 0.3120
Epoch 28/60
93/93 - 0s - 3ms/step - loss: 0.0848 - val_loss: 0.3081
Epoch 29/60
93/93 - 0s - 3ms/step - loss: 0.0830 - val_loss: 0.3078
Epoch 30/60
93/93 - 0s - 3ms/step - loss: 0.0836 - val_loss: 0.3126
Epoch 31/60
93/93 - 0s - 3ms/step - loss: 0.0832 - val_loss: 0.3091
Epoch 32/60
93/93 - 0s - 3ms/step - loss: 0.0829 - val_loss: 0.3110
Epoch 33/60
93/93 - 0s - 3ms/step - loss: 0.0819 - val_loss: 0.3037
Epoch 34/60
93/93 - 0s - 3ms/step - loss: 0.0806 - val_loss: 0.3131
Epoch 35/60
93/93 - 0s - 3ms/step - loss: 0.0812 - val_loss: 0.3125
Epoch 36/60
93/93 - 0s - 3ms/step - loss: 0.0804 - val_loss: 0.3073
Epoch 37/60
93/93 - 0s - 3ms/step - loss: 0.0790 - val_loss: 0.3107
Epoch 38/60
93/93 - 0s - 3ms/step - loss: 0.0790 - val_loss: 0.3110
Epoch 39/60
93/93 - 0s - 3ms/step - loss: 0.0790 - val_loss: 0.3057
Epoch 40/60
93/93 - 0s - 3ms/step - loss: 0.0786 - val_loss: 0.3014
Epoch 41/60
93/93 - 0s - 3ms/step - loss: 0.0768 - val_loss: 0.3029
Epoch 42/60
93/93 - 0s - 3ms/step - loss: 0.0767 - val_loss: 0.3077
Epoch 43/60
93/93 - 0s - 3ms/step - loss: 0.0767 - val_loss: 0.3019
Epoch 44/60
93/93 - 0s - 3ms/step - loss: 0.0755 - val_loss: 0.3127
Epoch 45/60
93/93 - 0s - 3ms/step - loss: 0.0754 - val_loss: 0.3121
Epoch 46/60
93/93 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.3121
Epoch 47/60
93/93 - 0s - 3ms/step - loss: 0.0748 - val_loss: 0.3140
Epoch 48/60
93/93 - 0s - 3ms/step - loss: 0.0751 - val_loss: 0.3112
Epoch 49/60
93/93 - 0s - 3ms/step - loss: 0.0744 - val_loss: 0.3086
Epoch 50/60
93/93 - 0s - 3ms/step - loss: 0.0741 - val_loss: 0.3116
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9313
Per-joint RMSE: 0.9889 1.4059 0.8024 0.6024 0.5612 0.9631
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:24:09.554625: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:24:09.579133: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:24:10.439180: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:10.443813: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:10.444751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:10.446455: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:10.447249: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:10.447989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:10.525897: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:10.526745: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:10.527554: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:10.528359: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:24:10.822372: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.005330e+00  RMSE=1.002662e+00
  per-joint RMSE: 1.0936 1.4500 0.8742 0.6591 0.6460 1.0572
Residual LSTM:  MSE=8.672915e-01      RMSE=9.312848e-01
  per-joint RMSE: 0.9889 1.4059 0.8024 0.6024 0.5612 0.9631
Combined torque MSE=8.672915e-01     RMSE=9.312848e-01
  per-joint RMSE: 0.9889 1.4059 0.8024 0.6024 0.5612 0.9631
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (28728, 50, 24)  Y_train: (28728, 6)
X_test : (6157, 50, 24)  Y_test : (6157, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:24:12.921666: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:24:12.945343: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (28728, 50, 24), Y_train = (28728, 6)
  X_test  = (6157, 50, 24),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:24:14.125726: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:14.130629: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:14.131536: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:14.133298: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:14.134193: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:14.135052: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:14.212910: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:14.213797: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:14.214693: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:14.215478: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:24:15.218894: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.3251 - val_loss: 0.3485
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.1835 - val_loss: 0.3221
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.1601 - val_loss: 0.3083
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1467 - val_loss: 0.3036
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1374 - val_loss: 0.3015
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1316 - val_loss: 0.3011
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1248 - val_loss: 0.2832
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1200 - val_loss: 0.2826
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1163 - val_loss: 0.2785
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1131 - val_loss: 0.2747
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1103 - val_loss: 0.2749
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1078 - val_loss: 0.2734
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1056 - val_loss: 0.2669
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1041 - val_loss: 0.2687
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1011 - val_loss: 0.2709
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.1003 - val_loss: 0.2670
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.0985 - val_loss: 0.2654
Epoch 18/60
90/90 - 0s - 4ms/step - loss: 0.0966 - val_loss: 0.2634
Epoch 19/60
90/90 - 0s - 4ms/step - loss: 0.0953 - val_loss: 0.2637
Epoch 20/60
90/90 - 0s - 4ms/step - loss: 0.0939 - val_loss: 0.2618
Epoch 21/60
90/90 - 0s - 4ms/step - loss: 0.0928 - val_loss: 0.2636
Epoch 22/60
90/90 - 0s - 4ms/step - loss: 0.0909 - val_loss: 0.2582
Epoch 23/60
90/90 - 0s - 4ms/step - loss: 0.0900 - val_loss: 0.2585
Epoch 24/60
90/90 - 0s - 4ms/step - loss: 0.0894 - val_loss: 0.2575
Epoch 25/60
90/90 - 0s - 4ms/step - loss: 0.0887 - val_loss: 0.2546
Epoch 26/60
90/90 - 0s - 4ms/step - loss: 0.0870 - val_loss: 0.2595
Epoch 27/60
90/90 - 0s - 4ms/step - loss: 0.0860 - val_loss: 0.2546
Epoch 28/60
90/90 - 0s - 4ms/step - loss: 0.0859 - val_loss: 0.2552
Epoch 29/60
90/90 - 0s - 4ms/step - loss: 0.0844 - val_loss: 0.2540
Epoch 30/60
90/90 - 0s - 4ms/step - loss: 0.0839 - val_loss: 0.2525
Epoch 31/60
90/90 - 0s - 4ms/step - loss: 0.0839 - val_loss: 0.2542
Epoch 32/60
90/90 - 0s - 4ms/step - loss: 0.0828 - val_loss: 0.2490
Epoch 33/60
90/90 - 0s - 4ms/step - loss: 0.0822 - val_loss: 0.2522
Epoch 34/60
90/90 - 0s - 4ms/step - loss: 0.0810 - val_loss: 0.2526
Epoch 35/60
90/90 - 0s - 4ms/step - loss: 0.0815 - val_loss: 0.2519
Epoch 36/60
90/90 - 0s - 4ms/step - loss: 0.0815 - val_loss: 0.2481
Epoch 37/60
90/90 - 0s - 4ms/step - loss: 0.0803 - val_loss: 0.2488
Epoch 38/60
90/90 - 0s - 4ms/step - loss: 0.0794 - val_loss: 0.2525
Epoch 39/60
90/90 - 0s - 4ms/step - loss: 0.0787 - val_loss: 0.2504
Epoch 40/60
90/90 - 0s - 4ms/step - loss: 0.0781 - val_loss: 0.2493
Epoch 41/60
90/90 - 0s - 4ms/step - loss: 0.0793 - val_loss: 0.2447
Epoch 42/60
90/90 - 0s - 4ms/step - loss: 0.0780 - val_loss: 0.2482
Epoch 43/60
90/90 - 0s - 4ms/step - loss: 0.0779 - val_loss: 0.2454
Epoch 44/60
90/90 - 0s - 4ms/step - loss: 0.0781 - val_loss: 0.2462
Epoch 45/60
90/90 - 0s - 4ms/step - loss: 0.0769 - val_loss: 0.2530
Epoch 46/60
90/90 - 0s - 4ms/step - loss: 0.0763 - val_loss: 0.2500
Epoch 47/60
90/90 - 0s - 4ms/step - loss: 0.0759 - val_loss: 0.2509
Epoch 48/60
90/90 - 0s - 4ms/step - loss: 0.0754 - val_loss: 0.2502
Epoch 49/60
90/90 - 0s - 4ms/step - loss: 0.0750 - val_loss: 0.2482
Epoch 50/60
90/90 - 0s - 4ms/step - loss: 0.0749 - val_loss: 0.2427
Epoch 51/60
90/90 - 0s - 4ms/step - loss: 0.0743 - val_loss: 0.2472
Epoch 52/60
90/90 - 0s - 4ms/step - loss: 0.0736 - val_loss: 0.2478
Epoch 53/60
90/90 - 0s - 4ms/step - loss: 0.0739 - val_loss: 0.2469
Epoch 54/60
90/90 - 0s - 4ms/step - loss: 0.0724 - val_loss: 0.2477
Epoch 55/60
90/90 - 0s - 4ms/step - loss: 0.0723 - val_loss: 0.2469
Epoch 56/60
90/90 - 0s - 4ms/step - loss: 0.0719 - val_loss: 0.2482
Epoch 57/60
90/90 - 0s - 4ms/step - loss: 0.0723 - val_loss: 0.2455
Epoch 58/60
90/90 - 0s - 4ms/step - loss: 0.0718 - val_loss: 0.2456
Epoch 59/60
90/90 - 0s - 4ms/step - loss: 0.0720 - val_loss: 0.2391
Epoch 60/60
90/90 - 0s - 4ms/step - loss: 0.0703 - val_loss: 0.2452
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9100
Per-joint RMSE: 1.0028 1.2978 0.7790 0.6184 0.5834 0.9738
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:24:39.228172: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:24:39.252718: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:24:40.101675: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:40.106452: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:40.107332: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:40.109073: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:40.109945: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:40.110743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:40.187237: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:40.188083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:40.188835: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:40.189573: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:24:40.497958: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.017995e+00  RMSE=1.008957e+00
  per-joint RMSE: 1.0997 1.4626 0.8784 0.6624 0.6522 1.0600
Residual LSTM:  MSE=8.280113e-01      RMSE=9.099513e-01
  per-joint RMSE: 1.0028 1.2978 0.7790 0.6184 0.5834 0.9738
Combined torque MSE=8.280113e-01     RMSE=9.099513e-01
  per-joint RMSE: 1.0028 1.2978 0.7790 0.6184 0.5834 0.9738
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (28728, 50, 6)  Y_train: (28728, 6)
X_test : (6157, 50, 6)  Y_test : (6157, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:24:42.505016: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:24:42.528807: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (28728, 50, 6), Y_train = (28728, 6)
  X_test  = (6157, 50, 6),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:24:43.546432: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:43.550919: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:43.551787: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:43.553380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:43.554168: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:43.554908: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:43.642721: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:43.643644: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:43.644386: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:43.645213: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:24:44.562509: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.5386 - val_loss: 0.6266
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.2931 - val_loss: 0.5489
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.2226 - val_loss: 0.5535
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1894 - val_loss: 0.5684
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1708 - val_loss: 0.5217
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1613 - val_loss: 0.5099
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1525 - val_loss: 0.5212
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1562 - val_loss: 0.5258
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1419 - val_loss: 0.5164
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1386 - val_loss: 0.5121
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1327 - val_loss: 0.5024
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1301 - val_loss: 0.5036
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1257 - val_loss: 0.5025
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1243 - val_loss: 0.5013
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1210 - val_loss: 0.5703
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.1195 - val_loss: 0.5145
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.1196 - val_loss: 0.5167
Epoch 18/60
90/90 - 0s - 4ms/step - loss: 0.1176 - val_loss: 0.5699
Epoch 19/60
90/90 - 0s - 4ms/step - loss: 0.1156 - val_loss: 0.5393
Epoch 20/60
90/90 - 0s - 4ms/step - loss: 0.1160 - val_loss: 0.5496
Epoch 21/60
90/90 - 0s - 4ms/step - loss: 0.1154 - val_loss: 0.5505
Epoch 22/60
90/90 - 0s - 4ms/step - loss: 0.1115 - val_loss: 0.5464
Epoch 23/60
90/90 - 0s - 4ms/step - loss: 0.1117 - val_loss: 0.5406
Epoch 24/60
90/90 - 0s - 4ms/step - loss: 0.1093 - val_loss: 0.5393
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9973
Per-joint RMSE: 1.0792 1.4951 0.8316 0.6538 0.6269 1.0272
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:24:54.888742: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:24:54.913691: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:24:55.760467: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:55.765004: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:55.765800: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:55.767600: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:55.768474: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:55.769228: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:55.853492: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:55.854319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:55.855066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:55.855797: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:24:56.154655: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.017995e+00  RMSE=1.008957e+00
  per-joint RMSE: 1.0997 1.4626 0.8784 0.6624 0.6522 1.0600
Residual LSTM:  MSE=9.945505e-01      RMSE=9.972715e-01
  per-joint RMSE: 1.0792 1.4951 0.8316 0.6538 0.6269 1.0272
Combined torque MSE=9.945506e-01     RMSE=9.972716e-01
  per-joint RMSE: 1.0792 1.4951 0.8316 0.6538 0.6269 1.0272
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (28728, 50, 18)  Y_train: (28728, 6)
X_test : (6157, 50, 18)  Y_test : (6157, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:24:58.219767: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:24:58.244363: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (28728, 50, 18), Y_train = (28728, 6)
  X_test  = (6157, 50, 18),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:24:59.373743: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:59.378310: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:59.379103: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:59.380722: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:59.381507: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:59.382247: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:59.459378: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:59.460353: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:59.461143: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:24:59.461935: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:25:00.454896: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.3756 - val_loss: 0.4056
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.2106 - val_loss: 0.3886
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.1811 - val_loss: 0.3681
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1668 - val_loss: 0.3746
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1536 - val_loss: 0.3667
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1456 - val_loss: 0.3647
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1388 - val_loss: 0.3698
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1353 - val_loss: 0.3672
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1294 - val_loss: 0.3702
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1243 - val_loss: 0.3715
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1202 - val_loss: 0.3788
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1172 - val_loss: 0.3835
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1154 - val_loss: 0.3804
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1139 - val_loss: 0.3822
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1104 - val_loss: 0.3907
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.1082 - val_loss: 0.3875
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9837
Per-joint RMSE: 1.0885 1.4176 0.8137 0.6569 0.6380 1.0537
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:25:08.030633: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:25:08.054587: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:25:08.907221: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:08.911884: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:08.912681: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:08.914420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:08.915209: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:08.915946: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:08.996686: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:08.997610: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:08.998347: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:08.999083: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:25:09.302738: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.017995e+00  RMSE=1.008957e+00
  per-joint RMSE: 1.0997 1.4626 0.8784 0.6624 0.6522 1.0600
Residual LSTM:  MSE=9.675861e-01      RMSE=9.836596e-01
  per-joint RMSE: 1.0885 1.4176 0.8137 0.6569 0.6380 1.0537
Combined torque MSE=9.675861e-01     RMSE=9.836596e-01
  per-joint RMSE: 1.0885 1.4176 0.8137 0.6569 0.6380 1.0537
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (28728, 50, 18)  Y_train: (28728, 6)
X_test : (6157, 50, 18)  Y_test : (6157, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:25:11.331267: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:25:11.355021: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s0_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (28728, 50, 18), Y_train = (28728, 6)
  X_test  = (6157, 50, 18),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:25:12.493232: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:12.497851: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:12.498728: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:12.500354: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:12.501145: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:12.501884: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:12.577009: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:12.577842: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:12.578594: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:12.579321: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:25:13.569616: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.3318 - val_loss: 0.3559
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.1878 - val_loss: 0.3149
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.1595 - val_loss: 0.3040
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1467 - val_loss: 0.2964
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1380 - val_loss: 0.2928
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1311 - val_loss: 0.2941
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1255 - val_loss: 0.2868
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1207 - val_loss: 0.2856
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1175 - val_loss: 0.2809
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1142 - val_loss: 0.2790
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1114 - val_loss: 0.2792
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1089 - val_loss: 0.2771
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1073 - val_loss: 0.2827
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1061 - val_loss: 0.2747
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1034 - val_loss: 0.2714
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.1017 - val_loss: 0.2701
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.0997 - val_loss: 0.2758
Epoch 18/60
90/90 - 0s - 4ms/step - loss: 0.0978 - val_loss: 0.2735
Epoch 19/60
90/90 - 0s - 4ms/step - loss: 0.0960 - val_loss: 0.2719
Epoch 20/60
90/90 - 0s - 4ms/step - loss: 0.0945 - val_loss: 0.2709
Epoch 21/60
90/90 - 0s - 4ms/step - loss: 0.0929 - val_loss: 0.2722
Epoch 22/60
90/90 - 0s - 4ms/step - loss: 0.0919 - val_loss: 0.2737
Epoch 23/60
90/90 - 0s - 4ms/step - loss: 0.0911 - val_loss: 0.2710
Epoch 24/60
90/90 - 0s - 4ms/step - loss: 0.0894 - val_loss: 0.2696
Epoch 25/60
90/90 - 0s - 4ms/step - loss: 0.0887 - val_loss: 0.2679
Epoch 26/60
90/90 - 0s - 4ms/step - loss: 0.0879 - val_loss: 0.2758
Epoch 27/60
90/90 - 0s - 4ms/step - loss: 0.0872 - val_loss: 0.2713
Epoch 28/60
90/90 - 0s - 4ms/step - loss: 0.0861 - val_loss: 0.2715
Epoch 29/60
90/90 - 0s - 4ms/step - loss: 0.0848 - val_loss: 0.2714
Epoch 30/60
90/90 - 0s - 4ms/step - loss: 0.0847 - val_loss: 0.2718
Epoch 31/60
90/90 - 0s - 4ms/step - loss: 0.0838 - val_loss: 0.2667
Epoch 32/60
90/90 - 0s - 4ms/step - loss: 0.0836 - val_loss: 0.2665
Epoch 33/60
90/90 - 0s - 5ms/step - loss: 0.0833 - val_loss: 0.2625
Epoch 34/60
90/90 - 0s - 4ms/step - loss: 0.0829 - val_loss: 0.2646
Epoch 35/60
90/90 - 0s - 4ms/step - loss: 0.0817 - val_loss: 0.2635
Epoch 36/60
90/90 - 0s - 4ms/step - loss: 0.0805 - val_loss: 0.2626
Epoch 37/60
90/90 - 0s - 4ms/step - loss: 0.0803 - val_loss: 0.2673
Epoch 38/60
90/90 - 0s - 4ms/step - loss: 0.0803 - val_loss: 0.2700
Epoch 39/60
90/90 - 0s - 4ms/step - loss: 0.0797 - val_loss: 0.2667
Epoch 40/60
90/90 - 0s - 4ms/step - loss: 0.0793 - val_loss: 0.2691
Epoch 41/60
90/90 - 0s - 4ms/step - loss: 0.0781 - val_loss: 0.2744
Epoch 42/60
90/90 - 0s - 4ms/step - loss: 0.0782 - val_loss: 0.2648
Epoch 43/60
90/90 - 0s - 4ms/step - loss: 0.0782 - val_loss: 0.2713
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.9435
Per-joint RMSE: 1.0076 1.4156 0.8250 0.5939 0.5842 0.9731
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:25:31.270504: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:25:31.294451: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s0_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:25:32.151988: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:32.156623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:32.157500: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:32.159173: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:32.159969: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:32.160705: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:32.241300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:32.242148: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:32.242951: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:25:32.243734: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:25:32.563933: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=1.017995e+00  RMSE=1.008957e+00
  per-joint RMSE: 1.0997 1.4626 0.8784 0.6624 0.6522 1.0600
Residual LSTM:  MSE=8.901436e-01      RMSE=9.434742e-01
  per-joint RMSE: 1.0076 1.4156 0.8250 0.5939 0.5842 0.9731
Combined torque MSE=8.901436e-01     RMSE=9.434742e-01
  per-joint RMSE: 1.0076 1.4156 0.8250 0.5939 0.5842 0.9731
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s0_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=1                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz -t structured -s 1 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7a4db47241f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
   dt ≈ 0.027237226774096998
  dof = 6
  Train trajectories = 60
  Test trajectories  = 15
  Train samples = 30288
  Test samples  = 6524
################################################

2026-01-22 06:25:36.864514: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250 | type=structured | dof=6
################################################
2026-01-22 06:25:40.023217: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:25:40.023252: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:25:40.023258: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:25:40.023285: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:25:40.023291: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:25:40.023305: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:25:40.023342: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:25:40.023347: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:25:40.023363: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:25:40.023367: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.0s, Loss=1.75e+01, Inv=1.75e+01, For=1.42e+02, Power=2.97e+00
  [eval] test_mse=2.997e+00  (n=6524)
Epoch 00050: Time=  10.0s, Loss=2.30e+00, Inv=2.30e+00, For=4.33e+01, Power=1.51e+00
Epoch 00100: Time=  14.1s, Loss=2.00e+00, Inv=2.00e+00, For=5.34e+01, Power=1.34e+00
Epoch 00150: Time=  18.1s, Loss=1.85e+00, Inv=1.85e+00, For=8.13e+01, Power=1.23e+00
Epoch 00200: Time=  21.9s, Loss=1.76e+00, Inv=1.76e+00, For=1.19e+02, Power=1.18e+00
  [eval] test_mse=3.982e+00  (n=6524)
Epoch 00250: Time=  26.2s, Loss=1.70e+00, Inv=1.70e+00, For=1.50e+02, Power=1.16e+00
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250
Torque MSE  = 7.343e-01
Torque RMSE = 8.569e-01
Per-joint MSE : 7.420e-01 1.146e+00 5.858e-01 5.144e-01 4.800e-01 9.372e-01
Per-joint RMSE: 8.614e-01 1.071e+00 7.653e-01 7.172e-01 6.928e-01 9.681e-01
Comp Time per Sample = 4.215e-08s / 23727260.0Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s1_ep250.jax
Detected n_dof=6 (seed=1)
2026-01-22 06:26:08.349086: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 60 trajectories
2026-01-22 06:26:09.679216: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:26:09.679230: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:26:11.156694: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:26:11.156706: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:26:12.737850: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/60
2026-01-22 06:26:14.003068: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/60
2026-01-22 06:26:15.171893: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:26:15.171927: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:26:15.171933: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 60/60

Exporting split=test: 15 trajectories
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (29478, 25, 24)  Y_train: (29478, 6)
X_test : (6332, 25, 24)  Y_test : (6332, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:26:17.778284: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:26:17.802098: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (29478, 25, 24), Y_train = (29478, 6)
  X_test  = (6332, 25, 24),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:26:18.843205: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:18.848022: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:18.848947: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:18.850630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:18.851546: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:18.852421: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:18.943239: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:18.944213: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:18.945013: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:18.945795: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8951 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:26:19.928902: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.3226 - val_loss: 0.3697
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.1795 - val_loss: 0.3452
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.1542 - val_loss: 0.3359
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.1412 - val_loss: 0.3228
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1327 - val_loss: 0.3191
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1266 - val_loss: 0.3177
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1196 - val_loss: 0.3182
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1160 - val_loss: 0.3097
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1127 - val_loss: 0.2987
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1094 - val_loss: 0.3019
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1059 - val_loss: 0.3028
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1041 - val_loss: 0.3030
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1026 - val_loss: 0.3053
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1014 - val_loss: 0.3063
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.0994 - val_loss: 0.3005
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.0966 - val_loss: 0.3034
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.0956 - val_loss: 0.3035
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.0948 - val_loss: 0.3021
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.0937 - val_loss: 0.3010
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7728
Per-joint RMSE: 0.7920 0.9277 0.6739 0.6642 0.6366 0.8918
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:26:26.462431: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:26:26.487296: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:26:27.344759: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:27.349767: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:27.350634: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:27.352494: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:27.353367: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:27.354107: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:27.431086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:27.431999: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:27.432824: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:27.433605: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:26:27.741116: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.447824e-01  RMSE=8.630078e-01
  per-joint RMSE: 0.8722 1.0807 0.7730 0.7203 0.7013 0.9653
Residual LSTM:  MSE=5.972882e-01      RMSE=7.728442e-01
  per-joint RMSE: 0.7920 0.9277 0.6739 0.6642 0.6366 0.8918
Combined torque MSE=5.972882e-01     RMSE=7.728442e-01
  per-joint RMSE: 0.7920 0.9277 0.6739 0.6642 0.6366 0.8918
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (29478, 25, 6)  Y_train: (29478, 6)
X_test : (6332, 25, 6)  Y_test : (6332, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:26:29.707748: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:26:29.731462: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (29478, 25, 6), Y_train = (29478, 6)
  X_test  = (6332, 25, 6),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:26:30.708567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:30.713105: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:30.713895: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:30.715456: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:30.716322: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:30.717141: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:30.791584: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:30.792424: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:30.793168: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:30.793898: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:26:31.723289: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.5982 - val_loss: 0.7545
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.3586 - val_loss: 0.6230
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.2707 - val_loss: 0.5662
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.2218 - val_loss: 0.5610
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1933 - val_loss: 0.5400
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1723 - val_loss: 0.5252
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1585 - val_loss: 0.5238
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1498 - val_loss: 0.5286
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1410 - val_loss: 0.5368
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1342 - val_loss: 0.5297
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1363 - val_loss: 0.5570
Epoch 12/60
93/93 - 0s - 4ms/step - loss: 0.1404 - val_loss: 0.5233
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1265 - val_loss: 0.5250
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1208 - val_loss: 0.5481
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.1195 - val_loss: 0.5327
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.1180 - val_loss: 0.5163
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.1150 - val_loss: 0.5185
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.1158 - val_loss: 0.5158
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.1145 - val_loss: 0.5216
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.1112 - val_loss: 0.5046
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.1191 - val_loss: 0.5212
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.1091 - val_loss: 0.5132
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.1067 - val_loss: 0.4839
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.1078 - val_loss: 0.5024
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.1069 - val_loss: 0.4804
Epoch 26/60
93/93 - 0s - 3ms/step - loss: 0.1101 - val_loss: 0.4812
Epoch 27/60
93/93 - 0s - 3ms/step - loss: 0.1060 - val_loss: 0.4681
Epoch 28/60
93/93 - 0s - 3ms/step - loss: 0.1036 - val_loss: 0.4800
Epoch 29/60
93/93 - 0s - 3ms/step - loss: 0.1111 - val_loss: 0.4778
Epoch 30/60
93/93 - 0s - 3ms/step - loss: 0.1048 - val_loss: 0.4826
Epoch 31/60
93/93 - 0s - 3ms/step - loss: 0.1032 - val_loss: 0.5056
Epoch 32/60
93/93 - 0s - 3ms/step - loss: 0.1010 - val_loss: 0.4766
Epoch 33/60
93/93 - 0s - 3ms/step - loss: 0.1013 - val_loss: 0.5012
Epoch 34/60
93/93 - 0s - 3ms/step - loss: 0.0993 - val_loss: 0.5052
Epoch 35/60
93/93 - 0s - 3ms/step - loss: 0.1011 - val_loss: 0.4720
Epoch 36/60
93/93 - 0s - 3ms/step - loss: 0.1029 - val_loss: 0.4752
Epoch 37/60
93/93 - 0s - 3ms/step - loss: 0.0984 - val_loss: 0.4999
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8311
Per-joint RMSE: 0.8480 1.0287 0.7534 0.7033 0.6711 0.9241
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:26:42.733746: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:26:42.758332: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:26:43.623164: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:43.628150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:43.628997: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:43.630783: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:43.631626: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:43.632417: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:43.716324: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:43.717212: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:43.718008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:43.718793: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8950 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:26:44.018761: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.447824e-01  RMSE=8.630078e-01
  per-joint RMSE: 0.8722 1.0807 0.7730 0.7203 0.7013 0.9653
Residual LSTM:  MSE=6.906738e-01      RMSE=8.310679e-01
  per-joint RMSE: 0.8480 1.0287 0.7534 0.7033 0.6711 0.9241
Combined torque MSE=6.906738e-01     RMSE=8.310679e-01
  per-joint RMSE: 0.8480 1.0287 0.7534 0.7033 0.6711 0.9241
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (29478, 25, 18)  Y_train: (29478, 6)
X_test : (6332, 25, 18)  Y_test : (6332, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:26:46.058071: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:26:46.081761: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (29478, 25, 18), Y_train = (29478, 6)
  X_test  = (6332, 25, 18),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:26:47.115696: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:47.120242: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:47.121084: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:47.122711: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:47.123500: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:47.124237: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:47.204592: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:47.205424: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:47.206171: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:26:47.206908: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:26:48.174613: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 18ms/step - loss: 0.3589 - val_loss: 0.4578
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.2115 - val_loss: 0.4015
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.1757 - val_loss: 0.3949
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.1589 - val_loss: 0.4059
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1467 - val_loss: 0.4187
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1379 - val_loss: 0.4059
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1316 - val_loss: 0.4027
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1257 - val_loss: 0.4007
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1222 - val_loss: 0.4090
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1184 - val_loss: 0.3931
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1156 - val_loss: 0.3894
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1126 - val_loss: 0.3856
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1111 - val_loss: 0.3832
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1091 - val_loss: 0.3796
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.1060 - val_loss: 0.3813
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.1048 - val_loss: 0.3846
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.1041 - val_loss: 0.3669
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.1009 - val_loss: 0.3673
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.0990 - val_loss: 0.3706
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.0989 - val_loss: 0.3654
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.0972 - val_loss: 0.3703
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.0951 - val_loss: 0.3670
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.0950 - val_loss: 0.3683
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.0937 - val_loss: 0.3625
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.0926 - val_loss: 0.3643
Epoch 26/60
93/93 - 0s - 3ms/step - loss: 0.0916 - val_loss: 0.3687
Epoch 27/60
93/93 - 0s - 3ms/step - loss: 0.0909 - val_loss: 0.3679
Epoch 28/60
93/93 - 0s - 3ms/step - loss: 0.0899 - val_loss: 0.3496
Epoch 29/60
93/93 - 0s - 3ms/step - loss: 0.0877 - val_loss: 0.3610
Epoch 30/60
93/93 - 0s - 3ms/step - loss: 0.0873 - val_loss: 0.3718
Epoch 31/60
93/93 - 0s - 3ms/step - loss: 0.0877 - val_loss: 0.3678
Epoch 32/60
93/93 - 0s - 3ms/step - loss: 0.0860 - val_loss: 0.3583
Epoch 33/60
93/93 - 0s - 3ms/step - loss: 0.0854 - val_loss: 0.3527
Epoch 34/60
93/93 - 0s - 3ms/step - loss: 0.0841 - val_loss: 0.3623
Epoch 35/60
93/93 - 0s - 3ms/step - loss: 0.0838 - val_loss: 0.3537
Epoch 36/60
93/93 - 0s - 3ms/step - loss: 0.0829 - val_loss: 0.3608
Epoch 37/60
93/93 - 0s - 3ms/step - loss: 0.0842 - val_loss: 0.3607
Epoch 38/60
93/93 - 0s - 3ms/step - loss: 0.0830 - val_loss: 0.3532
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8098
Per-joint RMSE: 0.8636 0.9406 0.6795 0.6783 0.6737 0.9635
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:26:59.609097: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:26:59.633332: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:27:00.484216: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:00.488836: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:00.489630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:00.491288: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:00.492076: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:00.492809: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:00.574835: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:00.575679: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:00.576555: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:00.577294: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:27:00.875769: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.447824e-01  RMSE=8.630078e-01
  per-joint RMSE: 0.8722 1.0807 0.7730 0.7203 0.7013 0.9653
Residual LSTM:  MSE=6.557772e-01      RMSE=8.098007e-01
  per-joint RMSE: 0.8636 0.9406 0.6795 0.6783 0.6737 0.9635
Combined torque MSE=6.557772e-01     RMSE=8.098007e-01
  per-joint RMSE: 0.8636 0.9406 0.6795 0.6783 0.6737 0.9635
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (29478, 25, 18)  Y_train: (29478, 6)
X_test : (6332, 25, 18)  Y_test : (6332, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:27:02.903709: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:27:02.929566: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (29478, 25, 18), Y_train = (29478, 6)
  X_test  = (6332, 25, 18),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:27:03.974433: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:03.978970: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:03.979762: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:03.981334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:03.982205: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:03.982937: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:04.059753: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:04.060588: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:04.061327: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:04.062147: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:27:05.019616: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.3336 - val_loss: 0.3822
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.1873 - val_loss: 0.3284
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.1566 - val_loss: 0.3186
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.1422 - val_loss: 0.3106
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1328 - val_loss: 0.3086
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1258 - val_loss: 0.2997
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1203 - val_loss: 0.3041
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1164 - val_loss: 0.3027
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1128 - val_loss: 0.3010
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1108 - val_loss: 0.3030
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1075 - val_loss: 0.3034
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1059 - val_loss: 0.2959
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1029 - val_loss: 0.3016
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1015 - val_loss: 0.3004
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.0992 - val_loss: 0.2965
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.0976 - val_loss: 0.3015
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.0960 - val_loss: 0.2971
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.0959 - val_loss: 0.2973
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.0934 - val_loss: 0.3001
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.0916 - val_loss: 0.2948
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.0902 - val_loss: 0.3012
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.0904 - val_loss: 0.2885
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.0896 - val_loss: 0.2924
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.0877 - val_loss: 0.2879
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.0865 - val_loss: 0.2834
Epoch 26/60
93/93 - 0s - 3ms/step - loss: 0.0864 - val_loss: 0.2872
Epoch 27/60
93/93 - 0s - 3ms/step - loss: 0.0855 - val_loss: 0.2844
Epoch 28/60
93/93 - 0s - 3ms/step - loss: 0.0845 - val_loss: 0.2778
Epoch 29/60
93/93 - 0s - 3ms/step - loss: 0.0820 - val_loss: 0.2836
Epoch 30/60
93/93 - 0s - 3ms/step - loss: 0.0830 - val_loss: 0.2825
Epoch 31/60
93/93 - 0s - 3ms/step - loss: 0.0821 - val_loss: 0.2798
Epoch 32/60
93/93 - 0s - 3ms/step - loss: 0.0811 - val_loss: 0.2806
Epoch 33/60
93/93 - 0s - 3ms/step - loss: 0.0803 - val_loss: 0.2904
Epoch 34/60
93/93 - 0s - 3ms/step - loss: 0.0813 - val_loss: 0.2797
Epoch 35/60
93/93 - 0s - 3ms/step - loss: 0.0810 - val_loss: 0.2725
Epoch 36/60
93/93 - 0s - 3ms/step - loss: 0.0785 - val_loss: 0.2745
Epoch 37/60
93/93 - 0s - 3ms/step - loss: 0.0776 - val_loss: 0.2674
Epoch 38/60
93/93 - 0s - 3ms/step - loss: 0.0773 - val_loss: 0.2703
Epoch 39/60
93/93 - 0s - 3ms/step - loss: 0.0768 - val_loss: 0.2694
Epoch 40/60
93/93 - 0s - 3ms/step - loss: 0.0766 - val_loss: 0.2696
Epoch 41/60
93/93 - 0s - 3ms/step - loss: 0.0762 - val_loss: 0.2741
Epoch 42/60
93/93 - 0s - 3ms/step - loss: 0.0764 - val_loss: 0.2639
Epoch 43/60
93/93 - 0s - 3ms/step - loss: 0.0752 - val_loss: 0.2693
Epoch 44/60
93/93 - 0s - 3ms/step - loss: 0.0744 - val_loss: 0.2658
Epoch 45/60
93/93 - 0s - 3ms/step - loss: 0.0738 - val_loss: 0.2714
Epoch 46/60
93/93 - 0s - 3ms/step - loss: 0.0743 - val_loss: 0.2681
Epoch 47/60
93/93 - 0s - 3ms/step - loss: 0.0740 - val_loss: 0.2658
Epoch 48/60
93/93 - 0s - 3ms/step - loss: 0.0737 - val_loss: 0.2652
Epoch 49/60
93/93 - 0s - 3ms/step - loss: 0.0726 - val_loss: 0.2677
Epoch 50/60
93/93 - 0s - 3ms/step - loss: 0.0738 - val_loss: 0.2685
Epoch 51/60
93/93 - 0s - 3ms/step - loss: 0.0720 - val_loss: 0.2676
Epoch 52/60
93/93 - 0s - 3ms/step - loss: 0.0721 - val_loss: 0.2719
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7814
Per-joint RMSE: 0.8029 0.9791 0.6990 0.6548 0.5982 0.8858
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:27:20.002286: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:27:20.026459: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:27:20.884420: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:20.889043: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:20.889840: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:20.891579: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:20.892377: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:20.893209: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:20.976473: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:20.977316: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:20.978150: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:20.978880: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:27:21.281825: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.447824e-01  RMSE=8.630078e-01
  per-joint RMSE: 0.8722 1.0807 0.7730 0.7203 0.7013 0.9653
Residual LSTM:  MSE=6.105411e-01      RMSE=7.813713e-01
  per-joint RMSE: 0.8029 0.9791 0.6990 0.6548 0.5982 0.8858
Combined torque MSE=6.105412e-01     RMSE=7.813714e-01
  per-joint RMSE: 0.8029 0.9791 0.6990 0.6548 0.5982 0.8858
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (28728, 50, 24)  Y_train: (28728, 6)
X_test : (6157, 50, 24)  Y_test : (6157, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:27:23.426011: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:27:23.449712: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (28728, 50, 24), Y_train = (28728, 6)
  X_test  = (6157, 50, 24),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:27:24.630656: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:24.635960: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:24.636888: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:24.638624: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:24.639542: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:24.640412: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:24.724185: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:24.725083: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:24.725956: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:24.726793: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:27:25.717967: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.3271 - val_loss: 0.3304
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.1799 - val_loss: 0.2955
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.1546 - val_loss: 0.2880
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1450 - val_loss: 0.2741
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1351 - val_loss: 0.2687
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1296 - val_loss: 0.2705
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1234 - val_loss: 0.2646
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1200 - val_loss: 0.2617
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1176 - val_loss: 0.2647
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1138 - val_loss: 0.2601
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1115 - val_loss: 0.2553
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1077 - val_loss: 0.2565
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1055 - val_loss: 0.2536
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1034 - val_loss: 0.2543
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1010 - val_loss: 0.2545
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.0987 - val_loss: 0.2579
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.0973 - val_loss: 0.2568
Epoch 18/60
90/90 - 0s - 4ms/step - loss: 0.0957 - val_loss: 0.2604
Epoch 19/60
90/90 - 0s - 4ms/step - loss: 0.0952 - val_loss: 0.2532
Epoch 20/60
90/90 - 0s - 4ms/step - loss: 0.0938 - val_loss: 0.2529
Epoch 21/60
90/90 - 0s - 4ms/step - loss: 0.0922 - val_loss: 0.2625
Epoch 22/60
90/90 - 0s - 4ms/step - loss: 0.0906 - val_loss: 0.2516
Epoch 23/60
90/90 - 0s - 4ms/step - loss: 0.0894 - val_loss: 0.2512
Epoch 24/60
90/90 - 0s - 4ms/step - loss: 0.0895 - val_loss: 0.2532
Epoch 25/60
90/90 - 0s - 4ms/step - loss: 0.0876 - val_loss: 0.2587
Epoch 26/60
90/90 - 0s - 4ms/step - loss: 0.0864 - val_loss: 0.2555
Epoch 27/60
90/90 - 0s - 4ms/step - loss: 0.0858 - val_loss: 0.2571
Epoch 28/60
90/90 - 0s - 4ms/step - loss: 0.0852 - val_loss: 0.2610
Epoch 29/60
90/90 - 0s - 4ms/step - loss: 0.0836 - val_loss: 0.2584
Epoch 30/60
90/90 - 0s - 4ms/step - loss: 0.0846 - val_loss: 0.2598
Epoch 31/60
90/90 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.2532
Epoch 32/60
90/90 - 0s - 4ms/step - loss: 0.0820 - val_loss: 0.2523
Epoch 33/60
90/90 - 0s - 4ms/step - loss: 0.0813 - val_loss: 0.2528
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7854
Per-joint RMSE: 0.7752 0.9733 0.7001 0.6674 0.6093 0.9198
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:27:39.377708: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:27:39.403661: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:27:40.256015: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:40.260607: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:40.261396: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:40.263164: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:40.264035: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:40.264780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:40.346089: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:40.347008: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:40.347836: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:40.348561: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:27:40.652701: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.538069e-01  RMSE=8.682205e-01
  per-joint RMSE: 0.8819 1.0901 0.7687 0.7268 0.6993 0.9739
Residual LSTM:  MSE=6.168543e-01      RMSE=7.854007e-01
  per-joint RMSE: 0.7752 0.9733 0.7001 0.6674 0.6093 0.9198
Combined torque MSE=6.168542e-01     RMSE=7.854006e-01
  per-joint RMSE: 0.7752 0.9733 0.7001 0.6674 0.6093 0.9198
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (28728, 50, 6)  Y_train: (28728, 6)
X_test : (6157, 50, 6)  Y_test : (6157, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:27:42.623517: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:27:42.648946: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (28728, 50, 6), Y_train = (28728, 6)
  X_test  = (6157, 50, 6),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:27:43.698189: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:43.702691: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:43.703484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:43.705064: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:43.705935: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:43.706738: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:43.785794: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:43.786630: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:43.787380: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:27:43.788206: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:27:44.755108: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.5265 - val_loss: 0.4891
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.2852 - val_loss: 0.4547
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.2092 - val_loss: 0.4283
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1779 - val_loss: 0.4431
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1609 - val_loss: 0.4463
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1552 - val_loss: 0.4383
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1447 - val_loss: 0.4400
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1398 - val_loss: 0.4423
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1362 - val_loss: 0.4386
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1326 - val_loss: 0.4149
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1280 - val_loss: 0.4075
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1269 - val_loss: 0.4119
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1235 - val_loss: 0.4271
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1230 - val_loss: 0.4082
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1219 - val_loss: 0.4259
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.1176 - val_loss: 0.4233
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.1171 - val_loss: 0.4080
Epoch 18/60
90/90 - 0s - 4ms/step - loss: 0.1149 - val_loss: 0.4039
Epoch 19/60
90/90 - 0s - 4ms/step - loss: 0.1144 - val_loss: 0.4070
Epoch 20/60
90/90 - 0s - 4ms/step - loss: 0.1130 - val_loss: 0.4209
Epoch 21/60
90/90 - 0s - 4ms/step - loss: 0.1110 - val_loss: 0.4025
Epoch 22/60
90/90 - 0s - 4ms/step - loss: 0.1101 - val_loss: 0.4055
Epoch 23/60
90/90 - 0s - 4ms/step - loss: 0.1114 - val_loss: 0.4154
Epoch 24/60
90/90 - 0s - 4ms/step - loss: 0.1106 - val_loss: 0.4075
Epoch 25/60
90/90 - 0s - 4ms/step - loss: 0.1070 - val_loss: 0.3989
Epoch 26/60
90/90 - 0s - 4ms/step - loss: 0.1059 - val_loss: 0.4024
Epoch 27/60
90/90 - 0s - 4ms/step - loss: 0.1152 - val_loss: 0.4084
Epoch 28/60
90/90 - 0s - 4ms/step - loss: 0.1090 - val_loss: 0.4074
Epoch 29/60
90/90 - 0s - 4ms/step - loss: 0.1050 - val_loss: 0.4147
Epoch 30/60
90/90 - 0s - 4ms/step - loss: 0.1019 - val_loss: 0.4184
Epoch 31/60
90/90 - 0s - 4ms/step - loss: 0.1015 - val_loss: 0.4220
Epoch 32/60
90/90 - 0s - 4ms/step - loss: 0.1022 - val_loss: 0.4154
Epoch 33/60
90/90 - 0s - 4ms/step - loss: 0.1003 - val_loss: 0.4205
Epoch 34/60
90/90 - 0s - 4ms/step - loss: 0.0981 - val_loss: 0.4234
Epoch 35/60
90/90 - 0s - 4ms/step - loss: 0.0979 - val_loss: 0.4148
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8488
Per-joint RMSE: 0.8778 1.0610 0.7726 0.7162 0.6618 0.9377
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:27:59.180077: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:27:59.204780: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:28:00.076210: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:00.080776: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:00.081568: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:00.083296: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:00.084088: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:00.084825: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:00.175635: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:00.176559: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:00.177306: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:00.178042: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:28:00.473404: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.538069e-01  RMSE=8.682205e-01
  per-joint RMSE: 0.8819 1.0901 0.7687 0.7268 0.6993 0.9739
Residual LSTM:  MSE=7.205153e-01      RMSE=8.488317e-01
  per-joint RMSE: 0.8778 1.0610 0.7726 0.7162 0.6618 0.9377
Combined torque MSE=7.205153e-01     RMSE=8.488317e-01
  per-joint RMSE: 0.8778 1.0610 0.7726 0.7162 0.6618 0.9377
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (28728, 50, 18)  Y_train: (28728, 6)
X_test : (6157, 50, 18)  Y_test : (6157, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:28:02.564389: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:28:02.588229: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (28728, 50, 18), Y_train = (28728, 6)
  X_test  = (6157, 50, 18),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:28:03.719281: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:03.723910: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:03.724780: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:03.726651: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:03.727458: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:03.728248: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:03.809802: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:03.810690: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:03.811487: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:03.812274: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:28:04.769182: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.3671 - val_loss: 0.4123
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.2081 - val_loss: 0.3940
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.1778 - val_loss: 0.3714
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1625 - val_loss: 0.3619
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1494 - val_loss: 0.3578
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1421 - val_loss: 0.3537
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1358 - val_loss: 0.3435
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1317 - val_loss: 0.3608
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1278 - val_loss: 0.3607
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1233 - val_loss: 0.3488
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1189 - val_loss: 0.3595
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1167 - val_loss: 0.3570
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1144 - val_loss: 0.3609
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1118 - val_loss: 0.3614
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1100 - val_loss: 0.3511
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.1087 - val_loss: 0.3564
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.1055 - val_loss: 0.3520
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8129
Per-joint RMSE: 0.8774 0.9290 0.6854 0.7143 0.6742 0.9473
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:28:12.650295: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:28:12.674911: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:28:13.517677: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:13.522349: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:13.523223: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:13.524908: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:13.525760: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:13.526620: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:13.610055: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:13.611020: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:13.611954: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:13.612817: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:28:13.917624: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.538069e-01  RMSE=8.682205e-01
  per-joint RMSE: 0.8819 1.0901 0.7687 0.7268 0.6993 0.9739
Residual LSTM:  MSE=6.608121e-01      RMSE=8.129035e-01
  per-joint RMSE: 0.8774 0.9290 0.6854 0.7143 0.6742 0.9473
Combined torque MSE=6.608121e-01     RMSE=8.129035e-01
  per-joint RMSE: 0.8774 0.9290 0.6854 0.7143 0.6742 0.9473
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (28728, 50, 18)  Y_train: (28728, 6)
X_test : (6157, 50, 18)  Y_test : (6157, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:28:16.021519: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:28:16.045307: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s1_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (28728, 50, 18), Y_train = (28728, 6)
  X_test  = (6157, 50, 18),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:28:17.190329: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:17.195001: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:17.195910: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:17.197672: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:17.198593: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:17.199447: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:17.277952: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:17.278862: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:17.279662: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:17.280441: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:28:18.276540: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.3286 - val_loss: 0.3179
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.1837 - val_loss: 0.2917
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.1589 - val_loss: 0.2827
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1453 - val_loss: 0.2741
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1369 - val_loss: 0.2667
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1289 - val_loss: 0.2640
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1232 - val_loss: 0.2606
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1197 - val_loss: 0.2541
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1166 - val_loss: 0.2517
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1122 - val_loss: 0.2519
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1107 - val_loss: 0.2504
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1084 - val_loss: 0.2492
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1055 - val_loss: 0.2472
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1032 - val_loss: 0.2497
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1025 - val_loss: 0.2451
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.1000 - val_loss: 0.2419
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.0985 - val_loss: 0.2483
Epoch 18/60
90/90 - 0s - 4ms/step - loss: 0.0976 - val_loss: 0.2479
Epoch 19/60
90/90 - 0s - 4ms/step - loss: 0.0961 - val_loss: 0.2464
Epoch 20/60
90/90 - 0s - 4ms/step - loss: 0.0945 - val_loss: 0.2456
Epoch 21/60
90/90 - 0s - 4ms/step - loss: 0.0927 - val_loss: 0.2447
Epoch 22/60
90/90 - 0s - 4ms/step - loss: 0.0917 - val_loss: 0.2442
Epoch 23/60
90/90 - 0s - 4ms/step - loss: 0.0904 - val_loss: 0.2441
Epoch 24/60
90/90 - 0s - 4ms/step - loss: 0.0897 - val_loss: 0.2423
Epoch 25/60
90/90 - 0s - 4ms/step - loss: 0.0891 - val_loss: 0.2421
Epoch 26/60
90/90 - 0s - 4ms/step - loss: 0.0877 - val_loss: 0.2444
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7943
Per-joint RMSE: 0.8005 0.9743 0.7203 0.6752 0.6204 0.9140
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:28:29.696756: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:28:29.721260: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s1_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:28:30.573351: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:30.578090: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:30.578968: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:30.580671: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:30.581466: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:30.582446: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:30.665478: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:30.666319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:30.667068: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:28:30.667793: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:28:30.973707: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.538069e-01  RMSE=8.682205e-01
  per-joint RMSE: 0.8819 1.0901 0.7687 0.7268 0.6993 0.9739
Residual LSTM:  MSE=6.308402e-01      RMSE=7.942545e-01
  per-joint RMSE: 0.8005 0.9743 0.7203 0.6752 0.6204 0.9140
Combined torque MSE=6.308402e-01     RMSE=7.942545e-01
  per-joint RMSE: 0.8005 0.9743 0.7203 0.6752 0.6204 0.9140
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s1_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

###################################################################################################################################################################
### DELAN VARIANT: delan_seed=2                                                                                                                                 ###
### ckpt=/workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax ###
### res_out=/workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz                                 ###
###################################################################################################################################################################

######################
### 2) DELAN TRAIN ###
######################

===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/rbyt_train_delan_jax.py --npz /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz -t structured -s 2 -r 0 --hp_preset fast_debug --epochs 250 --save_path /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax' ===
===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Final hyper: {'dataset': 'delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250', 'n_width': 64, 'n_depth': 2, 'n_minibatch': 256, 'diagonal_epsilon': 0.1, 'diagonal_shift': 2.0, 'activation': 'tanh', 'learning_rate': 0.0003, 'weight_decay': 1e-05, 'max_epoch': 250, 'lagrangian_type': <function structured_lagrangian_fn at 0x7d34a0c2c1f0>}


################################################
DeLaN run: delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  model_dir = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
  ckpt_path = /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
  type = structured
  hp_preset = fast_debug
################################################


################################################
Dataset: delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
  npz = /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
   dt ≈ 0.027237226774096998
  dof = 6
  Train trajectories = 60
  Test trajectories  = 15
  Train samples = 30288
  Test samples  = 6524
################################################

2026-01-22 06:28:35.298728: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
################################################
Training DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250 | type=structured | dof=6
################################################
2026-01-22 06:28:38.441222: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:28:38.441258: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:28:38.441264: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:28:38.441290: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:28:38.441296: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:28:38.441310: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:28:38.441346: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:28:38.441352: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:28:38.441367: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:28:38.441371: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
Epoch 00001: Time=   5.1s, Loss=1.32e+01, Inv=1.32e+01, For=1.10e+02, Power=3.82e+00
  [eval] test_mse=3.200e+00  (n=6524)
Epoch 00050: Time=  10.5s, Loss=2.29e+00, Inv=2.29e+00, For=4.93e+01, Power=1.55e+00
Epoch 00100: Time=  14.2s, Loss=1.99e+00, Inv=1.99e+00, For=5.43e+01, Power=1.34e+00
Epoch 00150: Time=  18.0s, Loss=1.86e+00, Inv=1.86e+00, For=6.47e+01, Power=1.26e+00
Epoch 00200: Time=  21.8s, Loss=1.77e+00, Inv=1.77e+00, For=7.88e+01, Power=1.21e+00
  [eval] test_mse=3.759e+00  (n=6524)
Epoch 00250: Time=  25.7s, Loss=1.71e+00, Inv=1.71e+00, For=9.79e+01, Power=1.17e+00
Saved DeLaN checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Saved training history: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250__train_history.csv

################################################
Evaluating DeLaN | run=delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250
Torque MSE  = 7.602e-01
Torque RMSE = 8.719e-01
Per-joint MSE : 9.905e-01 1.001e+00 6.369e-01 3.768e-01 3.528e-01 1.204e+00
Per-joint RMSE: 9.952e-01 1.000e+00 7.980e-01 6.139e-01 5.940e-01 1.097e+00
Comp Time per Sample = 4.928e-08s / 20293768.1Hz
Saved metrics TXT: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics_test.txt
Saved metrics JSON: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/metrics.json


###########################
### 3) EXPORT RESIDUALS ###
###########################

=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T delan_jax bash -lc 'python3 /workspace/delan_jax/scripts/export_delan_residuals_jax.py --npz_in /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz --ckpt /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax --out /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz' ===
=================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Loading dataset: /workspace/shared/data/preprocessed/delan_delan_UR3_Load0_combined_26_K75_tf0p2_seed2_dataset.npz
Loading checkpoint: /workspace/shared/models/delan/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__delan_jax_struct_s2_ep250.jax
Detected n_dof=6 (seed=2)
2026-01-22 06:29:06.276189: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.

Exporting split=train: 60 trajectories
2026-01-22 06:29:07.578146: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:29:07.578160: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:29:09.093433: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:29:09.093446: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:29:10.709788: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 25/60
2026-01-22 06:29:11.917600: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 50/60
2026-01-22 06:29:13.179484: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:29:13.179519: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
2026-01-22 06:29:13.179525: W external/xla/xla/service/gpu/autotuning/dot_search_space.cc:200] All configs were filtered out because none of them sufficiently match the hints. Maybe the hints set does not contain a good representative set of valid configs?Working around this by using the full hints set instead.
  done 60/60

Exporting split=test: 15 trajectories
  done 15/15

Saved residual trajectory dataset: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
Keys: ['test_labels', 'test_q', 'test_qd', 'test_qdd', 'test_r_tau', 'test_t', 'test_tau', 'test_tau_hat', 'train_labels', 'train_q', 'train_qd', 'train_qdd', 'train_r_tau', 'train_t', 'train_tau', 'train_tau_hat']
Saved export JSON: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.json


#############################
### BLOCK: H=25 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --H 25 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=24
X_train: (29478, 25, 24)  Y_train: (29478, 6)
X_test : (6332, 25, 24)  Y_test : (6332, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:29:15.644222: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:29:15.668389: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 24
 dout = 6
  X_train = (29478, 25, 24), Y_train = (29478, 6)
  X_test  = (6332, 25, 24),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:29:16.716482: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:16.721516: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:16.722367: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:16.724086: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:16.724926: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:16.725714: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:16.799054: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:16.799952: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:16.800761: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:16.801558: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8951 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:29:17.769189: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.3290 - val_loss: 0.3746
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.1826 - val_loss: 0.3424
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.1566 - val_loss: 0.3238
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.1421 - val_loss: 0.3123
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1346 - val_loss: 0.3084
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1251 - val_loss: 0.3054
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1214 - val_loss: 0.3038
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1163 - val_loss: 0.3008
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1131 - val_loss: 0.2913
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1088 - val_loss: 0.2879
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1070 - val_loss: 0.2974
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1053 - val_loss: 0.2871
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1031 - val_loss: 0.2888
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1014 - val_loss: 0.2845
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.0994 - val_loss: 0.2902
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.0978 - val_loss: 0.2925
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.0964 - val_loss: 0.2896
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.0950 - val_loss: 0.2879
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.0934 - val_loss: 0.2835
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.0921 - val_loss: 0.2875
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.0911 - val_loss: 0.2805
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.0898 - val_loss: 0.2823
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.0887 - val_loss: 0.2838
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.0879 - val_loss: 0.2745
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.0873 - val_loss: 0.2764
Epoch 26/60
93/93 - 0s - 3ms/step - loss: 0.0861 - val_loss: 0.2687
Epoch 27/60
93/93 - 0s - 3ms/step - loss: 0.0847 - val_loss: 0.2736
Epoch 28/60
93/93 - 0s - 3ms/step - loss: 0.0852 - val_loss: 0.2698
Epoch 29/60
93/93 - 0s - 3ms/step - loss: 0.0833 - val_loss: 0.2773
Epoch 30/60
93/93 - 0s - 3ms/step - loss: 0.0829 - val_loss: 0.2732
Epoch 31/60
93/93 - 0s - 3ms/step - loss: 0.0825 - val_loss: 0.2631
Epoch 32/60
93/93 - 0s - 3ms/step - loss: 0.0814 - val_loss: 0.2644
Epoch 33/60
93/93 - 0s - 3ms/step - loss: 0.0805 - val_loss: 0.2618
Epoch 34/60
93/93 - 0s - 3ms/step - loss: 0.0808 - val_loss: 0.2606
Epoch 35/60
93/93 - 0s - 3ms/step - loss: 0.0800 - val_loss: 0.2745
Epoch 36/60
93/93 - 0s - 3ms/step - loss: 0.0802 - val_loss: 0.2629
Epoch 37/60
93/93 - 0s - 3ms/step - loss: 0.0791 - val_loss: 0.2593
Epoch 38/60
93/93 - 0s - 3ms/step - loss: 0.0778 - val_loss: 0.2654
Epoch 39/60
93/93 - 0s - 3ms/step - loss: 0.0778 - val_loss: 0.2616
Epoch 40/60
93/93 - 0s - 3ms/step - loss: 0.0770 - val_loss: 0.2648
Epoch 41/60
93/93 - 0s - 3ms/step - loss: 0.0769 - val_loss: 0.2567
Epoch 42/60
93/93 - 0s - 3ms/step - loss: 0.0757 - val_loss: 0.2582
Epoch 43/60
93/93 - 0s - 3ms/step - loss: 0.0754 - val_loss: 0.2526
Epoch 44/60
93/93 - 0s - 3ms/step - loss: 0.0754 - val_loss: 0.2570
Epoch 45/60
93/93 - 0s - 3ms/step - loss: 0.0751 - val_loss: 0.2523
Epoch 46/60
93/93 - 0s - 3ms/step - loss: 0.0743 - val_loss: 0.2529
Epoch 47/60
93/93 - 0s - 3ms/step - loss: 0.0747 - val_loss: 0.2552
Epoch 48/60
93/93 - 0s - 3ms/step - loss: 0.0741 - val_loss: 0.2490
Epoch 49/60
93/93 - 0s - 3ms/step - loss: 0.0735 - val_loss: 0.2671
Epoch 50/60
93/93 - 0s - 3ms/step - loss: 0.0743 - val_loss: 0.2507
Epoch 51/60
93/93 - 0s - 3ms/step - loss: 0.0720 - val_loss: 0.2536
Epoch 52/60
93/93 - 0s - 3ms/step - loss: 0.0734 - val_loss: 0.2578
Epoch 53/60
93/93 - 0s - 3ms/step - loss: 0.0725 - val_loss: 0.2478
Epoch 54/60
93/93 - 0s - 3ms/step - loss: 0.0718 - val_loss: 0.2555
Epoch 55/60
93/93 - 0s - 3ms/step - loss: 0.0724 - val_loss: 0.2596
Epoch 56/60
93/93 - 0s - 3ms/step - loss: 0.0726 - val_loss: 0.2504
Epoch 57/60
93/93 - 0s - 3ms/step - loss: 0.0717 - val_loss: 0.2492
Epoch 58/60
93/93 - 0s - 3ms/step - loss: 0.0718 - val_loss: 0.2471
Epoch 59/60
93/93 - 0s - 3ms/step - loss: 0.0713 - val_loss: 0.2521
Epoch 60/60
93/93 - 0s - 3ms/step - loss: 0.0707 - val_loss: 0.2454
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8022
Per-joint RMSE: 0.8825 0.8965 0.7212 0.5910 0.5609 1.0463
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:29:34.832237: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:29:34.856869: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:29:35.711323: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:35.716065: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:35.716856: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:35.718623: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:35.719404: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:35.720149: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:35.802272: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:35.803104: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:35.803843: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:35.804571: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8948 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:29:36.102691: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.726462e-01  RMSE=8.790030e-01
  per-joint RMSE: 1.0059 1.0091 0.8011 0.6178 0.6020 1.1046
Residual LSTM:  MSE=6.435395e-01      RMSE=8.022091e-01
  per-joint RMSE: 0.8825 0.8965 0.7212 0.5910 0.5609 1.0463
Combined torque MSE=6.435395e-01     RMSE=8.022091e-01
  per-joint RMSE: 0.8825 0.8965 0.7212 0.5910 0.5609 1.0463
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


################################
### BLOCK: H=25 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 25 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=6
X_train: (29478, 25, 6)  Y_train: (29478, 6)
X_test : (6332, 25, 6)  Y_test : (6332, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:29:38.059230: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:29:38.083448: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 6
 dout = 6
  X_train = (29478, 25, 6), Y_train = (29478, 6)
  X_test  = (6332, 25, 6),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:29:39.057657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:39.062173: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:39.063041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:39.064549: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:39.065334: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:39.066072: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:39.150448: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:39.151450: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:39.152286: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:39.153027: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:29:40.054685: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.5973 - val_loss: 0.6993
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.3682 - val_loss: 0.5727
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.2703 - val_loss: 0.5384
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.2223 - val_loss: 0.5275
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1920 - val_loss: 0.4926
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1757 - val_loss: 0.4949
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1611 - val_loss: 0.4976
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1504 - val_loss: 0.5000
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1438 - val_loss: 0.5034
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1427 - val_loss: 0.4924
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1326 - val_loss: 0.4848
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1306 - val_loss: 0.4987
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1267 - val_loss: 0.4918
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1444 - val_loss: 0.4925
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.1235 - val_loss: 0.5104
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.1187 - val_loss: 0.4973
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.1161 - val_loss: 0.4845
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.1153 - val_loss: 0.5130
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.1134 - val_loss: 0.4962
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.1127 - val_loss: 0.4948
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.1101 - val_loss: 0.4957
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.1089 - val_loss: 0.4935
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.1075 - val_loss: 0.4901
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.1074 - val_loss: 0.4935
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.1076 - val_loss: 0.4857
Epoch 26/60
93/93 - 0s - 3ms/step - loss: 0.1041 - val_loss: 0.4740
Epoch 27/60
93/93 - 0s - 3ms/step - loss: 0.1085 - val_loss: 0.4688
Epoch 28/60
93/93 - 0s - 3ms/step - loss: 0.1068 - val_loss: 0.4877
Epoch 29/60
93/93 - 0s - 3ms/step - loss: 0.1033 - val_loss: 0.4698
Epoch 30/60
93/93 - 0s - 3ms/step - loss: 0.1014 - val_loss: 0.4892
Epoch 31/60
93/93 - 0s - 3ms/step - loss: 0.1015 - val_loss: 0.4775
Epoch 32/60
93/93 - 0s - 3ms/step - loss: 0.1013 - val_loss: 0.4689
Epoch 33/60
93/93 - 0s - 3ms/step - loss: 0.1063 - val_loss: 0.4684
Epoch 34/60
93/93 - 0s - 3ms/step - loss: 0.1019 - val_loss: 0.4659
Epoch 35/60
93/93 - 0s - 3ms/step - loss: 0.0984 - val_loss: 0.4702
Epoch 36/60
93/93 - 0s - 3ms/step - loss: 0.1019 - val_loss: 0.4772
Epoch 37/60
93/93 - 0s - 3ms/step - loss: 0.0980 - val_loss: 0.4578
Epoch 38/60
93/93 - 0s - 3ms/step - loss: 0.0947 - val_loss: 0.4710
Epoch 39/60
93/93 - 0s - 3ms/step - loss: 0.0956 - val_loss: 0.4600
Epoch 40/60
93/93 - 0s - 3ms/step - loss: 0.0946 - val_loss: 0.4647
Epoch 41/60
93/93 - 0s - 3ms/step - loss: 0.0954 - val_loss: 0.4809
Epoch 42/60
93/93 - 0s - 3ms/step - loss: 0.0980 - val_loss: 0.4592
Epoch 43/60
93/93 - 0s - 3ms/step - loss: 0.0953 - val_loss: 0.4747
Epoch 44/60
93/93 - 0s - 3ms/step - loss: 0.0936 - val_loss: 0.4709
Epoch 45/60
93/93 - 0s - 3ms/step - loss: 0.0903 - val_loss: 0.4681
Epoch 46/60
93/93 - 0s - 3ms/step - loss: 0.0913 - val_loss: 0.4589
Epoch 47/60
93/93 - 0s - 3ms/step - loss: 0.0913 - val_loss: 0.4582
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8440
Per-joint RMSE: 0.9251 0.9847 0.7882 0.6089 0.5795 1.0586
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:29:53.460751: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:29:53.486350: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:29:54.335041: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:54.339908: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:54.340708: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:54.342353: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:54.343152: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:54.343900: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:54.425053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:54.425896: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:54.426723: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:54.427447: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:29:54.722839: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.726462e-01  RMSE=8.790030e-01
  per-joint RMSE: 1.0059 1.0091 0.8011 0.6178 0.6020 1.1046
Residual LSTM:  MSE=7.123128e-01      RMSE=8.439863e-01
  per-joint RMSE: 0.9251 0.9847 0.7882 0.6089 0.5795 1.0586
Combined torque MSE=7.123128e-01     RMSE=8.439863e-01
  per-joint RMSE: 0.9251 0.9847 0.7882 0.6089 0.5795 1.0586
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


##############################
### BLOCK: H=25 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --H 25 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (29478, 25, 18)  Y_train: (29478, 6)
X_test : (6332, 25, 18)  Y_test : (6332, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:29:56.771354: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:29:56.795105: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (29478, 25, 18), Y_train = (29478, 6)
  X_test  = (6332, 25, 18),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:29:57.827148: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:57.831698: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:57.834468: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:57.836094: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:57.836905: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:57.837657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:57.917666: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:57.918518: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:57.919275: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:29:57.920015: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:29:58.878237: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.3624 - val_loss: 0.4497
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.2139 - val_loss: 0.3973
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.1790 - val_loss: 0.3849
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.1603 - val_loss: 0.3845
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1499 - val_loss: 0.3888
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1413 - val_loss: 0.3793
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1352 - val_loss: 0.3679
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1301 - val_loss: 0.3796
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1247 - val_loss: 0.3812
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1221 - val_loss: 0.3823
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1179 - val_loss: 0.3691
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1150 - val_loss: 0.3689
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1115 - val_loss: 0.3787
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1087 - val_loss: 0.3630
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.1077 - val_loss: 0.3574
Epoch 16/60
93/93 - 0s - 3ms/step - loss: 0.1043 - val_loss: 0.3605
Epoch 17/60
93/93 - 0s - 3ms/step - loss: 0.1025 - val_loss: 0.3668
Epoch 18/60
93/93 - 0s - 3ms/step - loss: 0.1013 - val_loss: 0.3673
Epoch 19/60
93/93 - 0s - 3ms/step - loss: 0.0990 - val_loss: 0.3621
Epoch 20/60
93/93 - 0s - 3ms/step - loss: 0.0976 - val_loss: 0.3789
Epoch 21/60
93/93 - 0s - 3ms/step - loss: 0.0968 - val_loss: 0.3673
Epoch 22/60
93/93 - 0s - 3ms/step - loss: 0.0951 - val_loss: 0.3662
Epoch 23/60
93/93 - 0s - 3ms/step - loss: 0.0944 - val_loss: 0.3586
Epoch 24/60
93/93 - 0s - 3ms/step - loss: 0.0935 - val_loss: 0.3691
Epoch 25/60
93/93 - 0s - 3ms/step - loss: 0.0912 - val_loss: 0.3660
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8481
Per-joint RMSE: 0.9799 0.9488 0.7511 0.6097 0.5725 1.0915
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:30:06.947852: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:30:06.972798: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:30:07.832586: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:07.838637: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:07.839518: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:07.841291: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:07.842184: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:07.842989: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:07.922472: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:07.923310: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:07.924059: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:07.924783: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:30:08.231067: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.726462e-01  RMSE=8.790030e-01
  per-joint RMSE: 1.0059 1.0091 0.8011 0.6178 0.6020 1.1046
Residual LSTM:  MSE=7.192396e-01      RMSE=8.480799e-01
  per-joint RMSE: 0.9799 0.9488 0.7511 0.6097 0.5725 1.0915
Combined torque MSE=7.192396e-01     RMSE=8.480799e-01
  per-joint RMSE: 0.9799 0.9488 0.7511 0.6097 0.5725 1.0915
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#####################################
### BLOCK: H=25 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 25 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 25
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=25, n_dof=6, feature_dim=18
X_train: (29478, 25, 18)  Y_train: (29478, 6)
X_test : (6332, 25, 18)  Y_test : (6332, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:30:10.236233: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:30:10.260173: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H25__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 25
  din = 18
 dout = 6
  X_train = (29478, 25, 18), Y_train = (29478, 6)
  X_test  = (6332, 25, 18),  Y_test  = (6332, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:30:11.281316: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:11.285858: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:11.286657: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:11.288350: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:11.289140: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:11.289883: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:11.371885: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:11.372724: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:11.373461: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:11.374194: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8945 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 25, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 25, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:30:12.336894: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
93/93 - 2s - 17ms/step - loss: 0.3309 - val_loss: 0.3693
Epoch 2/60
93/93 - 0s - 3ms/step - loss: 0.1917 - val_loss: 0.3324
Epoch 3/60
93/93 - 0s - 3ms/step - loss: 0.1625 - val_loss: 0.3130
Epoch 4/60
93/93 - 0s - 3ms/step - loss: 0.1463 - val_loss: 0.3047
Epoch 5/60
93/93 - 0s - 3ms/step - loss: 0.1357 - val_loss: 0.3034
Epoch 6/60
93/93 - 0s - 3ms/step - loss: 0.1283 - val_loss: 0.3046
Epoch 7/60
93/93 - 0s - 3ms/step - loss: 0.1226 - val_loss: 0.3052
Epoch 8/60
93/93 - 0s - 3ms/step - loss: 0.1170 - val_loss: 0.3070
Epoch 9/60
93/93 - 0s - 3ms/step - loss: 0.1136 - val_loss: 0.3070
Epoch 10/60
93/93 - 0s - 3ms/step - loss: 0.1103 - val_loss: 0.3047
Epoch 11/60
93/93 - 0s - 3ms/step - loss: 0.1070 - val_loss: 0.3065
Epoch 12/60
93/93 - 0s - 3ms/step - loss: 0.1042 - val_loss: 0.3108
Epoch 13/60
93/93 - 0s - 3ms/step - loss: 0.1027 - val_loss: 0.3066
Epoch 14/60
93/93 - 0s - 3ms/step - loss: 0.1008 - val_loss: 0.3069
Epoch 15/60
93/93 - 0s - 3ms/step - loss: 0.0992 - val_loss: 0.3044
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_train_test_H25.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.7868
Per-joint RMSE: 0.8648 0.8949 0.7032 0.5737 0.5311 1.0297
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/scalers_H25.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1 --H 25 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:30:17.885961: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:30:17.910824: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 25
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:30:18.774814: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:18.779588: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:18.780439: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:18.782265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:18.783114: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:18.783910: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:18.868771: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:18.869764: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:18.870704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:18.871481: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:30:19.184863: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.726462e-01  RMSE=8.790030e-01
  per-joint RMSE: 1.0059 1.0091 0.8011 0.6178 0.6020 1.1046
Residual LSTM:  MSE=6.191119e-01      RMSE=7.868366e-01
  per-joint RMSE: 0.8648 0.8949 0.7032 0.5737 0.5311 1.0297
Combined torque MSE=6.191119e-01     RMSE=7.868366e-01
  per-joint RMSE: 0.8648 0.8949 0.7032 0.5737 0.5311 1.0297
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/metrics_test_H25.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/combined_predictions_test_H25.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H25.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H25_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H25.png


#############################
### BLOCK: H=50 feat=full ###
#############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --H 50 --features full' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= full
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=24
X_train: (28728, 50, 24)  Y_train: (28728, 6)
X_test : (6157, 50, 24)  Y_test : (6157, 6)
feature_mode=full


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:30:21.289278: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:30:21.313625: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_full__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 24
 dout = 6
  X_train = (28728, 50, 24), Y_train = (28728, 6)
  X_test  = (6157, 50, 24),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (24,)/(24,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:30:22.484751: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:22.489327: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:22.490208: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:22.491804: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:22.492596: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:22.493332: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:22.575481: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:22.576370: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:22.577174: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:22.577954: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        78,336 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 210,694 (823.02 KB)
 Trainable params: 210,694 (823.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:30:23.567254: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.3296 - val_loss: 0.3295
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.1813 - val_loss: 0.2951
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.1586 - val_loss: 0.2811
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1458 - val_loss: 0.2774
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1376 - val_loss: 0.2675
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1300 - val_loss: 0.2625
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1242 - val_loss: 0.2620
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1205 - val_loss: 0.2613
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1166 - val_loss: 0.2632
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1131 - val_loss: 0.2547
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1108 - val_loss: 0.2535
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1076 - val_loss: 0.2560
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1053 - val_loss: 0.2593
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1041 - val_loss: 0.2548
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1015 - val_loss: 0.2562
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.0990 - val_loss: 0.2550
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.0973 - val_loss: 0.2559
Epoch 18/60
90/90 - 0s - 4ms/step - loss: 0.0958 - val_loss: 0.2525
Epoch 19/60
90/90 - 0s - 4ms/step - loss: 0.0940 - val_loss: 0.2494
Epoch 20/60
90/90 - 0s - 4ms/step - loss: 0.0937 - val_loss: 0.2548
Epoch 21/60
90/90 - 0s - 4ms/step - loss: 0.0925 - val_loss: 0.2486
Epoch 22/60
90/90 - 0s - 4ms/step - loss: 0.0894 - val_loss: 0.2511
Epoch 23/60
90/90 - 0s - 4ms/step - loss: 0.0901 - val_loss: 0.2488
Epoch 24/60
90/90 - 0s - 4ms/step - loss: 0.0900 - val_loss: 0.2451
Epoch 25/60
90/90 - 0s - 4ms/step - loss: 0.0875 - val_loss: 0.2437
Epoch 26/60
90/90 - 0s - 4ms/step - loss: 0.0867 - val_loss: 0.2502
Epoch 27/60
90/90 - 0s - 4ms/step - loss: 0.0845 - val_loss: 0.2522
Epoch 28/60
90/90 - 0s - 4ms/step - loss: 0.0847 - val_loss: 0.2474
Epoch 29/60
90/90 - 0s - 4ms/step - loss: 0.0837 - val_loss: 0.2460
Epoch 30/60
90/90 - 0s - 4ms/step - loss: 0.0829 - val_loss: 0.2457
Epoch 31/60
90/90 - 0s - 4ms/step - loss: 0.0818 - val_loss: 0.2482
Epoch 32/60
90/90 - 0s - 4ms/step - loss: 0.0815 - val_loss: 0.2430
Epoch 33/60
90/90 - 0s - 4ms/step - loss: 0.0815 - val_loss: 0.2458
Epoch 34/60
90/90 - 0s - 4ms/step - loss: 0.0811 - val_loss: 0.2410
Epoch 35/60
90/90 - 0s - 4ms/step - loss: 0.0808 - val_loss: 0.2475
Epoch 36/60
90/90 - 0s - 4ms/step - loss: 0.0800 - val_loss: 0.2466
Epoch 37/60
90/90 - 0s - 4ms/step - loss: 0.0783 - val_loss: 0.2442
Epoch 38/60
90/90 - 0s - 4ms/step - loss: 0.0800 - val_loss: 0.2453
Epoch 39/60
90/90 - 0s - 4ms/step - loss: 0.0793 - val_loss: 0.2442
Epoch 40/60
90/90 - 0s - 4ms/step - loss: 0.0781 - val_loss: 0.2425
Epoch 41/60
90/90 - 0s - 4ms/step - loss: 0.0770 - val_loss: 0.2441
Epoch 42/60
90/90 - 0s - 4ms/step - loss: 0.0782 - val_loss: 0.2415
Epoch 43/60
90/90 - 0s - 4ms/step - loss: 0.0773 - val_loss: 0.2408
Epoch 44/60
90/90 - 0s - 4ms/step - loss: 0.0763 - val_loss: 0.2416
Epoch 45/60
90/90 - 0s - 4ms/step - loss: 0.0776 - val_loss: 0.2426
Epoch 46/60
90/90 - 0s - 4ms/step - loss: 0.0759 - val_loss: 0.2464
Epoch 47/60
90/90 - 0s - 4ms/step - loss: 0.0753 - val_loss: 0.2370
Epoch 48/60
90/90 - 0s - 4ms/step - loss: 0.0747 - val_loss: 0.2415
Epoch 49/60
90/90 - 0s - 4ms/step - loss: 0.0745 - val_loss: 0.2485
Epoch 50/60
90/90 - 0s - 4ms/step - loss: 0.0747 - val_loss: 0.2405
Epoch 51/60
90/90 - 0s - 4ms/step - loss: 0.0737 - val_loss: 0.2422
Epoch 52/60
90/90 - 0s - 4ms/step - loss: 0.0740 - val_loss: 0.2399
Epoch 53/60
90/90 - 0s - 4ms/step - loss: 0.0732 - val_loss: 0.2417
Epoch 54/60
90/90 - 0s - 4ms/step - loss: 0.0726 - val_loss: 0.2438
Epoch 55/60
90/90 - 0s - 4ms/step - loss: 0.0730 - val_loss: 0.2424
Epoch 56/60
90/90 - 0s - 4ms/step - loss: 0.0720 - val_loss: 0.2418
Epoch 57/60
90/90 - 0s - 4ms/step - loss: 0.0712 - val_loss: 0.2445
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8191
Per-joint RMSE: 0.8999 0.9964 0.7301 0.5726 0.5430 1.0328
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features full --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:30:45.971745: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:30:45.996326: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 24
################################################
2026-01-22 06:30:46.865152: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:46.869735: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:46.870533: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:46.872457: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:46.873251: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:46.873988: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:46.959015: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:46.959842: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:46.960680: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:46.961401: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:30:47.275974: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.871483e-01  RMSE=8.872138e-01
  per-joint RMSE: 1.0111 1.0196 0.8083 0.6241 0.6093 1.1166
Residual LSTM:  MSE=6.708490e-01      RMSE=8.190537e-01
  per-joint RMSE: 0.8999 0.9964 0.7301 0.5726 0.5430 1.0328
Combined torque MSE=6.708490e-01     RMSE=8.190537e-01
  per-joint RMSE: 0.8999 0.9964 0.7301 0.5726 0.5430 1.0328
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_full__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


################################
### BLOCK: H=50 feat=tau_hat ###
################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --H 50 --features tau_hat' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= tau_hat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=6
X_train: (28728, 50, 6)  Y_train: (28728, 6)
X_test : (6157, 50, 6)  Y_test : (6157, 6)
feature_mode=tau_hat


#####################
### 5) TRAIN LSTM ###
#####################

===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
===========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:30:49.334792: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:30:49.358437: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_tau_hat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 6
 dout = 6
  X_train = (28728, 50, 6), Y_train = (28728, 6)
  X_test  = (6157, 50, 6),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (6,)/(6,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:30:50.391552: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:50.396056: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:50.396843: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:50.398374: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:50.399236: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:50.399962: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:50.480262: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:50.481173: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:50.481924: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:30:50.482653: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        69,120 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 201,478 (787.02 KB)
 Trainable params: 201,478 (787.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:30:51.399153: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.5376 - val_loss: 0.5329
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.2908 - val_loss: 0.4984
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.2157 - val_loss: 0.4753
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1841 - val_loss: 0.4582
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1725 - val_loss: 0.4695
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1565 - val_loss: 0.4430
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1512 - val_loss: 0.4447
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1446 - val_loss: 0.4505
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1431 - val_loss: 0.4458
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1346 - val_loss: 0.4339
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1315 - val_loss: 0.4428
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1276 - val_loss: 0.4358
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1295 - val_loss: 0.4420
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1229 - val_loss: 0.4301
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1202 - val_loss: 0.4508
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.1182 - val_loss: 0.4392
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.1156 - val_loss: 0.4380
Epoch 18/60
90/90 - 0s - 4ms/step - loss: 0.1147 - val_loss: 0.4400
Epoch 19/60
90/90 - 0s - 4ms/step - loss: 0.1147 - val_loss: 0.4265
Epoch 20/60
90/90 - 0s - 4ms/step - loss: 0.1116 - val_loss: 0.4393
Epoch 21/60
90/90 - 0s - 4ms/step - loss: 0.1100 - val_loss: 0.4508
Epoch 22/60
90/90 - 0s - 4ms/step - loss: 0.1135 - val_loss: 0.4524
Epoch 23/60
90/90 - 0s - 4ms/step - loss: 0.1075 - val_loss: 0.4656
Epoch 24/60
90/90 - 0s - 4ms/step - loss: 0.1071 - val_loss: 0.4291
Epoch 25/60
90/90 - 0s - 4ms/step - loss: 0.1061 - val_loss: 0.4349
Epoch 26/60
90/90 - 0s - 4ms/step - loss: 0.1043 - val_loss: 0.4420
Epoch 27/60
90/90 - 0s - 4ms/step - loss: 0.1040 - val_loss: 0.4326
Epoch 28/60
90/90 - 0s - 4ms/step - loss: 0.1024 - val_loss: 0.4338
Epoch 29/60
90/90 - 0s - 4ms/step - loss: 0.1011 - val_loss: 0.4391
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8676
Per-joint RMSE: 1.0565 0.9449 0.8157 0.6098 0.5936 1.0573
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features tau_hat --save_pred_npz' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:31:03.456358: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:31:03.481122: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 6
################################################
2026-01-22 06:31:04.338511: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:04.343181: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:04.343972: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:04.345704: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:04.346496: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:04.347241: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:04.424726: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:04.425633: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:04.426379: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:04.427116: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:31:04.724594: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.871483e-01  RMSE=8.872138e-01
  per-joint RMSE: 1.0111 1.0196 0.8083 0.6241 0.6093 1.1166
Residual LSTM:  MSE=7.527670e-01      RMSE=8.676215e-01
  per-joint RMSE: 1.0565 0.9449 0.8157 0.6098 0.5936 1.0573
Combined torque MSE=7.527670e-01     RMSE=8.676215e-01
  per-joint RMSE: 1.0565 0.9449 0.8157 0.6098 0.5936 1.0573
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_tau_hat__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


##############################
### BLOCK: H=50 feat=state ###
##############################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --H 50 --features state' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (28728, 50, 18)  Y_train: (28728, 6)
X_test : (6157, 50, 18)  Y_test : (6157, 6)
feature_mode=state


#####################
### 5) TRAIN LSTM ###
#####################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:31:06.803522: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:31:06.827726: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (28728, 50, 18), Y_train = (28728, 6)
  X_test  = (6157, 50, 18),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:31:07.957314: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:07.962066: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:07.963081: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:07.965545: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:07.966459: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:07.967319: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:08.055906: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:08.056799: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:08.057601: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:08.058379: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:31:09.039029: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.3712 - val_loss: 0.3888
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.2143 - val_loss: 0.3367
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.1796 - val_loss: 0.3482
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1653 - val_loss: 0.3463
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1527 - val_loss: 0.3512
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1445 - val_loss: 0.3520
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1381 - val_loss: 0.3487
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1327 - val_loss: 0.3441
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1288 - val_loss: 0.3395
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1250 - val_loss: 0.3491
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1210 - val_loss: 0.3466
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1185 - val_loss: 0.3397
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8637
Per-joint RMSE: 0.9771 1.0043 0.7298 0.6297 0.5839 1.1148
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state --save_pred_npz' ===
=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:31:15.129996: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:31:15.155069: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:31:15.998260: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:16.002995: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:16.003789: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:16.005438: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:16.006300: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:16.007035: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:16.090678: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:16.091603: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:16.092344: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:16.093075: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:31:16.402907: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.871483e-01  RMSE=8.872138e-01
  per-joint RMSE: 1.0111 1.0196 0.8083 0.6241 0.6093 1.1166
Residual LSTM:  MSE=7.460308e-01      RMSE=8.637307e-01
  per-joint RMSE: 0.9771 1.0043 0.7298 0.6297 0.5839 1.1148
Combined torque MSE=7.460307e-01     RMSE=8.637307e-01
  per-joint RMSE: 0.9771 1.0043 0.7298 0.6297 0.5839 1.1148
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png


#####################################
### BLOCK: H=50 feat=state_tauhat ###
#####################################

#############################
### 4) BUILD LSTM WINDOWS ###
#############################

=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T preprocess bash -lc 'python3 scripts/build_lstm_windows.py --in_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --out_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --H 50 --features state_tauhat' ===
=======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
Building LSTM windows
  in_npz      = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
  out_npz     = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
  H           = 50
  feature_mode= state_tauhat
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
Saved: /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.json
H=50, n_dof=6, feature_dim=18
X_train: (28728, 50, 18)  Y_train: (28728, 6)
X_test : (6157, 50, 18)  Y_test : (6157, 6)
feature_mode=state_tauhat


#####################
### 5) TRAIN LSTM ###
#####################

=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T lstm bash -lc 'python3 -c '"'"'import runpy
import keras.callbacks as cb
_Orig = cb.ModelCheckpoint

class PatchedModelCheckpoint(_Orig):
    def __init__(self, filepath, *args, **kwargs):
        if isinstance(filepath, str) and (not filepath.endswith('"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"')) and (not filepath.endswith('"'"'"'"'"'"'"'"'.h5'"'"'"'"'"'"'"'"')):
            filepath = filepath + '"'"'"'"'"'"'"'"'.keras'"'"'"'"'"'"'"'"'
        super().__init__(filepath, *args, **kwargs)

cb.ModelCheckpoint = PatchedModelCheckpoint
runpy.run_path('"'"'"'"'"'"'"'"'scripts/train_residual_lstm.py'"'"'"'"'"'"'"'"', run_name='"'"'"'"'"'"'"'"'__main__'"'"'"'"'"'"'"'"')
'"'"' --npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz --out_dir /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1 --model_name residual_lstm.keras --epochs 60 --batch 256 --val_split 0.2 --seed 4 --units 128 --dropout 0.1 --eps 1e-08 --no_plots' ===
=====================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:31:18.485943: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:31:18.510173: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
LSTM Residual Dataset:
  npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__lstm_windows_H50__feat_state_tauhat__delan_jax_struct_s2_ep250.npz
   H  = 50
  din = 18
 dout = 6
  X_train = (28728, 50, 18), Y_train = (28728, 6)
  X_test  = (6157, 50, 18),  Y_test  = (6157, 6)
################################################

Saved scalers: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz
X mean/std shapes: (18,)/(18,)
Y mean/std shapes: (6,)/(6,)
2026-01-22 06:31:19.658276: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:19.663068: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:19.663942: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:19.665697: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:19.667155: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:19.667898: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:19.751567: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:19.752475: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:19.753284: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:19.754082: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
/usr/local/lib/python3.11/dist-packages/keras/src/layers/rnn/rnn.py:205: UserWarning: Do not pass an `input_shape`/`input_dim` argument to a layer. When using Sequential models, prefer using an `Input(shape)` object as the first layer in the model instead.
  super().__init__(**kwargs)
Model: "sequential"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃ Layer (type)                    ┃ Output Shape           ┃       Param # ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ lstm (LSTM)                     │ (None, 50, 128)        │        75,264 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout (Dropout)               │ (None, 50, 128)        │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_1 (LSTM)                   │ (None, 128)            │       131,584 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (Dropout)             │ (None, 128)            │             0 │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense (Dense)                   │ (None, 6)              │           774 │
└─────────────────────────────────┴────────────────────────┴───────────────┘
 Total params: 207,622 (811.02 KB)
 Trainable params: 207,622 (811.02 KB)
 Non-trainable params: 0 (0.00 B)


Epoch 1/60
2026-01-22 06:31:20.724809: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
90/90 - 2s - 19ms/step - loss: 0.3299 - val_loss: 0.3295
Epoch 2/60
90/90 - 0s - 4ms/step - loss: 0.1870 - val_loss: 0.2948
Epoch 3/60
90/90 - 0s - 4ms/step - loss: 0.1611 - val_loss: 0.2886
Epoch 4/60
90/90 - 0s - 4ms/step - loss: 0.1480 - val_loss: 0.2761
Epoch 5/60
90/90 - 0s - 4ms/step - loss: 0.1388 - val_loss: 0.2724
Epoch 6/60
90/90 - 0s - 4ms/step - loss: 0.1320 - val_loss: 0.2677
Epoch 7/60
90/90 - 0s - 4ms/step - loss: 0.1256 - val_loss: 0.2636
Epoch 8/60
90/90 - 0s - 4ms/step - loss: 0.1215 - val_loss: 0.2627
Epoch 9/60
90/90 - 0s - 4ms/step - loss: 0.1168 - val_loss: 0.2641
Epoch 10/60
90/90 - 0s - 4ms/step - loss: 0.1144 - val_loss: 0.2620
Epoch 11/60
90/90 - 0s - 4ms/step - loss: 0.1111 - val_loss: 0.2638
Epoch 12/60
90/90 - 0s - 5ms/step - loss: 0.1081 - val_loss: 0.2615
Epoch 13/60
90/90 - 0s - 4ms/step - loss: 0.1059 - val_loss: 0.2655
Epoch 14/60
90/90 - 0s - 4ms/step - loss: 0.1035 - val_loss: 0.2635
Epoch 15/60
90/90 - 0s - 4ms/step - loss: 0.1018 - val_loss: 0.2606
Epoch 16/60
90/90 - 0s - 4ms/step - loss: 0.0993 - val_loss: 0.2605
Epoch 17/60
90/90 - 0s - 4ms/step - loss: 0.0978 - val_loss: 0.2615
Epoch 18/60
90/90 - 0s - 4ms/step - loss: 0.0958 - val_loss: 0.2571
Epoch 19/60
90/90 - 0s - 4ms/step - loss: 0.0943 - val_loss: 0.2579
Epoch 20/60
90/90 - 0s - 4ms/step - loss: 0.0937 - val_loss: 0.2548
Epoch 21/60
90/90 - 0s - 4ms/step - loss: 0.0927 - val_loss: 0.2584
Epoch 22/60
90/90 - 0s - 4ms/step - loss: 0.0903 - val_loss: 0.2579
Epoch 23/60
90/90 - 0s - 4ms/step - loss: 0.0897 - val_loss: 0.2578
Epoch 24/60
90/90 - 0s - 4ms/step - loss: 0.0883 - val_loss: 0.2499
Epoch 25/60
90/90 - 0s - 4ms/step - loss: 0.0879 - val_loss: 0.2519
Epoch 26/60
90/90 - 0s - 4ms/step - loss: 0.0865 - val_loss: 0.2544
Epoch 27/60
90/90 - 0s - 4ms/step - loss: 0.0857 - val_loss: 0.2500
Epoch 28/60
90/90 - 0s - 4ms/step - loss: 0.0854 - val_loss: 0.2484
Epoch 29/60
90/90 - 0s - 4ms/step - loss: 0.0836 - val_loss: 0.2514
Epoch 30/60
90/90 - 0s - 4ms/step - loss: 0.0834 - val_loss: 0.2502
Epoch 31/60
90/90 - 0s - 4ms/step - loss: 0.0830 - val_loss: 0.2503
Epoch 32/60
90/90 - 0s - 4ms/step - loss: 0.0823 - val_loss: 0.2524
Epoch 33/60
90/90 - 0s - 4ms/step - loss: 0.0819 - val_loss: 0.2555
Epoch 34/60
90/90 - 0s - 4ms/step - loss: 0.0818 - val_loss: 0.2529
Epoch 35/60
90/90 - 0s - 4ms/step - loss: 0.0812 - val_loss: 0.2519
Epoch 36/60
90/90 - 0s - 4ms/step - loss: 0.0803 - val_loss: 0.2530
Epoch 37/60
90/90 - 0s - 4ms/step - loss: 0.0789 - val_loss: 0.2518
Epoch 38/60
90/90 - 0s - 4ms/step - loss: 0.0795 - val_loss: 0.2519
Saved metrics JSON: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_train_test_H50.json

################################################
LSTM Residual Evaluation (test, unscaled units):
Total RMSE: 0.8177
Per-joint RMSE: 0.8937 0.9735 0.7138 0.5808 0.5462 1.0584
################################################

Saved predictions: /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/predictions_test.npz
Saved best model:  /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras


##############################
### 6) COMBINED EVALUATION ###
##############################

=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
=== docker compose -p payload_estimation --project-directory /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation --env-file /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/.env -f /home/robat/.localgit/algorithmic_payload_estimation/payload_estimation/docker-compose.yml exec -T evaluation bash -lc 'python3 scripts/combined_evaluation.py --residual_npz /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz --model /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras --scalers /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/scalers_H50.npz --out_dir /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1 --H 50 --split test --features state_tauhat --save_pred_npz' ===
=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================
2026-01-22 06:31:36.260464: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2026-01-22 06:31:36.285178: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI AVX512_BF16 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
################################################
Evaluate & Combine
 residual_npz = /workspace/shared/data/processed/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250/delan_UR3_Load0_combined_26__A__K75_tf0p2__residual__delan_jax_struct_s2_ep250.npz
 model        = /workspace/shared/models/lstm/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_lstm.keras
 split        = test
 H            = 50
 n_traj       = 15
 n_dof        = 6
 feature_dim  = 18
################################################
2026-01-22 06:31:37.136991: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:37.141612: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:37.142484: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:37.144265: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:37.145053: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:37.145795: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:37.225855: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:37.226772: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:37.227504: I external/local_xla/xla/stream_executor/cuda/cuda_executor.cc:998] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero. See more at https://github.com/torvalds/linux/blob/v6.0/Documentation/ABI/testing/sysfs-bus-pci#L344-L355
2026-01-22 06:31:37.228237: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1928] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 8946 MB memory:  -> device: 0, name: NVIDIA GeForce RTX 4070 Ti, pci bus id: 0000:01:00.0, compute capability: 8.9
2026-01-22 06:31:37.534159: I external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:465] Loaded cuDNN version 8906
  done 15/15

################################################
Stage-2 Evaluation (test, valid k>=H-1):
DeLaN torque:   MSE=7.871483e-01  RMSE=8.872138e-01
  per-joint RMSE: 1.0111 1.0196 0.8083 0.6241 0.6093 1.1166
Residual LSTM:  MSE=6.686079e-01      RMSE=8.176845e-01
  per-joint RMSE: 0.8937 0.9735 0.7138 0.5808 0.5462 1.0584
Combined torque MSE=6.686080e-01     RMSE=8.176845e-01
  per-joint RMSE: 0.8937 0.9735 0.7138 0.5808 0.5462 1.0584
################################################

Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.txt
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/metrics_test_H50.json
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/combined_predictions_test_H50.npz
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/residual_gt_vs_pred_test_H50.png
Saved: /workspace/shared/evaluation/delan_UR3_Load0_combined_26__A__K75_tf0p2__delan_jax_struct_s2_ep250__feat_state_tauhat__lstm_s2_H50_ep60_b256_u128_do0p1/torque_gt_vs_delan_vs_combined_test_H50.png

